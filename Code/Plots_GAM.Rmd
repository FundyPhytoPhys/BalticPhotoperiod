---
title: "Plots_GAM"
author:
- Max Berthold
- Mireille Savoie
output:
bookdown::html_document2:
    code_folding: show
    keep_md: yes
    toc: TRUE
    toc_float: TRUE
    toc_depth: 6
    fig_caption: yes
bibliography: [Manuscript_O2, RPackages.bib]
csl: plos-one.csl
editor_options: 
  markdown: 
    wrap: 72
---

# Introduction
This .Rmd produces a Generalized Additive Model (GAM) to examine the relationship between the chlorophyll proxy (ΔOD) growth rate across the blue and red spectral wavebands, photoperiod and PAR levels for each P.marinus ecotype in this study. The GAM function from the R package mgcv (Wood, 2022) was used to model the growth rate with smoothing terms to indicate the 90, 50 and 10% quantiles. "PICO_Merged_GrowthFitsPURPAR.Rds" is called in from \Data\CleanData folder and generated GAM plots are saved in \Output\Figures folder as .png.


# Set variables for project
```{r project data}
FP1 <- ".."
Project <- "BalticPhotoperiod"
FileID <- "GAM"
Expert <- "SySl"
GamFit <- "PICO_Cleaned_MCData.Rds"

#"..", takes up a level in the directory path
DataIn <- file.path("..","Data", "CleanedData", "CleanedMCData")
DataOut <- file.path("..","Data", "CleanedData")
# PlotsOut <- file.path("..","Output", "Figures")
FigPath <- file.path("..", "Output", "Figures")
FigRdsPath <- file.path("..", "Output", "FiguresRds")
TableRdsPath <- file.path("..", "Output", "TablesRDS")

is_all_numeric <- function(x) { 
  !any(is.na(suppressWarnings(as.numeric(na.omit(x))))) & is.character(x) 
}
#https://stackoverflow.com/questions/22772279/converting-multiple-columns-from-character-to-numeric-format-in-r

GamPara <- "Lmu" # Stabds for growth estimates determined by logistic model

```



```{r load libraries, message=FALSE}
library(tidyverse)
library(lubridate)
library(broom)
library(knitr)
library(minpack.lm)
library(nlstools)
library(nlsMicrobio)
#library(plotly)
library(mgcv)
library(tidymv)
library(CCA)
library(vegan)
library(cowplot)
library(glue)
library(gtable)
library(car)
library(MASS) # estimating linear models through generalized least squares (GLS), fitting negative binomial linear models, the robust fitting of linear models, and Kruskal's non-metric multidimensional scaling.
library(faraway) # LM package
library(grid)
library(gridExtra)
library(ggh4x)
library(ggspectra) 
library(photobiologyWavebands) 
# library(photobiology)
library(metR)
library(Rcpp) #'Rcpp' package provides R functions as well as C++ classes which offer a seamless integration of R and C++. 
library("patchwork") # merging plots
```


# Read data nad select relevant columns
```{r read data and select relevant columns}

MultiCultiGrowth <- readRDS(file = file.path(DataIn, GamFit))  

MultiCultiGrowth <- MultiCultiGrowth %>% 
  dplyr::select(c(Filename, PrimaryOperator, Tube, SampleID, Run, Photoperiod, Strain, WL, O2_Category, O2_uM, LightShape, Par_ue, PARPhotonDose_day, OD720_Lmu_corr, OD720_Lmax, OD720_Lintercept, OD720_Lmu_se, OD720_Lmax_se, OD720_Lintercept_se, deltaOD_Lmu_corr, deltaOD_Lmax, deltaOD_Lintercept,  deltaOD_Lmu_se, deltaOD_Lmax_se, deltaOD_Lintercept_se))

MultiCultiGrowth1<- MultiCultiGrowth %>%
  filter(Run==77) %>%
  filter(Strain =="BA77G")
MultiCultiGrowth2<-MultiCultiGrowth %>%
  filter(Run==121) %>%
  filter(Strain !="BA77G")
MultiCultiGrowth3<-MultiCultiGrowth %>%
  filter(Run!=121 & Run!= 77)
MCGrowthRate<-rbind(MultiCultiGrowth1, MultiCultiGrowth2, MultiCultiGrowth3)
  rm(MultiCultiGrowth, MultiCultiGrowth1, MultiCultiGrowth2, MultiCultiGrowth3)
  

ReplNo <- MCGrowthRate %>%
  distinct(Photoperiod, Strain, O2_uM, WL, Par_ue)  
    # mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
    #      Strain=="BA48R"~"PE-rich_048",
    #     Strain=="BA56G"~"PC-rich_056",
    #      Strain=="BA77G"~"PC-rich_077")) 

```

# make df longer for GAM
```{r set up df for GAM, warning=FALSE}
 Pivot_Longer_OD720_est <- MCGrowthRate %>% 
  dplyr::select(-c(OD720_Lmu_se, OD720_Lmax_se, OD720_Lintercept_se, deltaOD_Lmu_corr, deltaOD_Lmax, deltaOD_Lintercept,  deltaOD_Lmu_se, deltaOD_Lmax_se, deltaOD_Lintercept_se)) %>%
   pivot_longer(c(OD720_Lmu_corr, OD720_Lmax, OD720_Lintercept), names_to = c("Wavelength", "term"), values_to = c("estimate"), names_sep = '\\_')


# OD720 pivot longer Gmax, Gmu, Glag , Lmu, Lmax and Lintercept standard error
Pivot_Longer_OD720_se <- MCGrowthRate %>%
  dplyr::select(-c(OD720_Lmu_corr, OD720_Lmax, OD720_Lintercept, deltaOD_Lmu_corr, deltaOD_Lmax, deltaOD_Lintercept,  deltaOD_Lmu_se, deltaOD_Lmax_se, deltaOD_Lintercept_se)) %>%
   pivot_longer(c(OD720_Lmu_se, OD720_Lmax_se, OD720_Lintercept_se), names_to = c("Wavelength", "term"), values_to = c("se"), names_sep = '\\_') 

# Join OD720 estimate and se DF 
Longer_OD720_Joined <- full_join(Pivot_Longer_OD720_est, Pivot_Longer_OD720_se)

remove(Pivot_Longer_OD720_est, Pivot_Longer_OD720_se)



# deltaOD pivot longer Gmax, Gmu, Glag, Lmu, Lmax and Lintercept estimates
Pivot_Longer_deltaOD_est <- MCGrowthRate %>%
  dplyr::select(-c(OD720_Lmu_corr, OD720_Lmax, OD720_Lintercept, OD720_Lmu_se, OD720_Lmax_se, OD720_Lintercept_se,  deltaOD_Lmu_se, deltaOD_Lmax_se, deltaOD_Lintercept_se)) %>%
   pivot_longer(c(deltaOD_Lmu_corr, deltaOD_Lmax, deltaOD_Lintercept), names_to = c("Wavelength", "term"), values_to = c("estimate"), names_sep = '\\_') 

# deltaOD pivot longer Gmax, Gmu, Glag , Lmu, Lmax and Lintercept standard error
Pivot_Longer_deltaOD_se <- MCGrowthRate %>%
  dplyr::select(-c(OD720_Lmu_corr, OD720_Lmax, OD720_Lintercept, OD720_Lmu_se, OD720_Lmax_se, OD720_Lintercept_se, deltaOD_Lmu_corr, deltaOD_Lmax, deltaOD_Lintercept)) %>%
   pivot_longer(c(deltaOD_Lmu_se, deltaOD_Lmax_se, deltaOD_Lintercept_se), names_to = c("Wavelength", "term"), values_to = c("se"), names_sep = '\\_') 

# Join deltaOD estimate and se DF 
Longer_deltaOD_Joined <- full_join(Pivot_Longer_deltaOD_est, Pivot_Longer_deltaOD_se)

remove(Pivot_Longer_deltaOD_est, Pivot_Longer_deltaOD_se)



#Join OD720 and deltaOD fits data
ComGrowthFits <- rbind(Longer_OD720_Joined, Longer_deltaOD_Joined) %>%
  mutate_if(is.numeric, round, digits = 3) %>% 
  filter(Strain %in% c("BA48R", "BA127R", "BA56G", "BA77G"),
         WL %in% c("WW"))

remove(Longer_OD720_Joined, Longer_deltaOD_Joined)
  
#glimpse(ComGrowthFits)

```



```{r DF preparation}
GamWL = "deltaOD"
GamVar = "WW"

# "BA48R"  "BA127R" "BA56G"  "BA77G" 


#DummyDF for BA48R; 

Strain <- c("BA48R")
Photoperiod <- c(8, 12, 16, 24)
Par_ue <- c(0)
O2_uM <- c(250)
WL <- c("WW")
estimate <- c(0)
term <- GamPara
Wavelength <- c("deltaOD", "OD720")
Tube <- c(9)

DummyDF_BA48R <- expand_grid(
  Strain, Photoperiod, Par_ue, O2_uM, WL, estimate, Wavelength, term, Tube
  ) %>%
  mutate(Lmu_seFlag = 1) 

DummyDF_Expand_BA48R <- rbind(DummyDF_BA48R, DummyDF_BA48R, DummyDF_BA48R)

#DummyDF for BA127R; 

Strain <- c("BA127R")
Photoperiod <- c(8, 12, 16, 24)
Par_ue <- c(0)
O2_uM <- c(250)
WL <- c("WW")
estimate <- c(0)
term <- GamPara
Wavelength <- c("deltaOD", "OD720")
Tube <- c(9)

DummyDF_BA127R <- expand_grid(
  Strain, Photoperiod, Par_ue, O2_uM, WL, estimate, Wavelength, term, Tube
  ) %>%
  mutate(Lmu_seFlag = 1) 

DummyDF_Expand_BA127R <- rbind(DummyDF_BA127R, DummyDF_BA127R, DummyDF_BA127R)


#DummyDF for BA56G;

Strain <- c("BA056G")
Photoperiod <- c(8, 12, 16, 24)
Par_ue <- c(0)
O2_uM <- c(250)
WL <- c("WW")
estimate <- c(0)
term <- GamPara
Wavelength <- c("deltaOD", "OD720")
Tube <- c(9)

DummyDF_BA56G <- expand_grid(
  Strain, Photoperiod, Par_ue, O2_uM, WL, estimate, Wavelength, term, Tube
  ) %>%
  mutate(Lmu_seFlag = 1) 

DummyDF_Expand_BA56G <- rbind(DummyDF_BA56G, DummyDF_BA56G, DummyDF_BA56G)

#DummyDF for "BA77G" 

Strain <- c("BA077G")
Photoperiod <- c(8, 12, 16, 24)
Par_ue <- c(0)
O2_uM <- c(250)
WL <- c("WW")
estimate <- c(0)
term <- GamPara
Wavelength <- c("deltaOD", "OD720")
Tube <- c(9)

DummyDF_BA77G <- expand_grid(
  Strain, Photoperiod, Par_ue, O2_uM, WL, estimate, Wavelength, term, Tube
  ) %>%
  mutate(Lmu_seFlag = 1) 

DummyDF_Expand_BA77G <- rbind(DummyDF_BA77G, DummyDF_BA77G, DummyDF_BA77G)


DummyDF_Expand <- rbind(DummyDF_Expand_BA48R, DummyDF_Expand_BA127R, DummyDF_Expand_BA56G, DummyDF_Expand_BA77G)

PicoGrowthFits <-  ComGrowthFits # full_join(ComGrowthFits, DummyDF_Expand) 

PicoLmuAb <- PicoGrowthFits %>%
  filter(term %in% GamPara) %>%
  filter(Wavelength %in% GamWL) %>%
  filter(WL %in% GamVar) %>%
  mutate(Strain = as.factor(Strain))

PicoLogGamAb <-  gam(estimate ~ s(Par_ue,  by = Strain, k = 3) + s(Photoperiod,  by = Strain, k = 3) + ti(Photoperiod, Par_ue, by = Strain, k = 3), data = PicoLmuAb, method = "REML")

summary(PicoLogGamAb)


PicoLogPar <- gam(estimate ~ s(Par_ue,  by = Strain, k = 3), data = PicoLmuAb, method = "REML")

PicoLogPhotPer <- gam(estimate ~ s(Photoperiod,  by = Strain, k = 3), data = PicoLmuAb, method = "REML")


AIC(PicoLogPar, PicoLogPhotPer, PicoLogGamAb)

ModelResid <- resid(PicoLogGamAb)
gam.check(PicoLogGamAb)
concurvity(PicoLogGamAb)
plot(PicoLogGamAb, residuals = TRUE, pch = 1, all.terms = TRUE)


#AIC of Gompertz-fitted model comparably low as to only-par and only-light model. 
#Next step, fitting Strain-specific models. 
#MED4 model to Par_ue-response falsely fits, due to badly fitted µ-rates -> cultures died, but model tried to fit anyway. Maybe filter everything below a certain R^2 in the fit? 

```

# Generate GAM for WL conditions for all strains using chlorophyll proxy logistic growth rate. 
```{r GAM separate niches hypervolume for WL}
GamWL = c("deltaOD", "OD720") #deltaOD OD720
Proxy= "[~Chl]" #~Chl ~Cells 
GamParaMod = "Lmu"
GamVar = c("WW")
ErrorTolGrowth = 100 # defined for the growth estimates
ErrorTol = 100 # defined for the GAM fit
# OxyLev = 25

#https://stackoverflow.com/questions/49570452/is-it-possible-to-specify-lower-bound-in-response-variable-during-smooth-with-ga 
possibGAM = possibly(.f = mgcv::gam, otherwise = NULL)
possibPRED = possibly(.f = mgcv::predict.gam, otherwise = NULL)

PAR_Photoperiod_Model_predi <- expand_grid(
  Par_ue = seq(from=min(10), 
              to=max(900), 
              length.out = 100),
  Photoperiod = seq(from=min(2), 
              to=max(24), 
              length.out = 100)
)

PicoGAM <- PicoGrowthFits %>%
  ungroup() %>%
  dplyr::mutate(Lmu_seFlag = case_when(se/estimate*100 < ErrorTolGrowth ~ 1, #filters faulty data where Standarderror larger +/- Errortolerance
                         FALSE ~ 0)) %>%
  dplyr::filter(estimate == 0 |
                estimate != 0 & Lmu_seFlag == 1,
                term %in% GamParaMod, 
                Wavelength %in% GamWL
                ) %>%
  mutate(estimate = estimate*24, #to convert growth from per hour to per day
         se = se*24) %>%
  group_by(Strain, Wavelength, WL, O2_uM) %>%
  nest() %>%
  dplyr::arrange(Strain, Wavelength, WL, O2_uM) %>%
  mutate(GamModel = map(data, ~possibGAM(estimate ~ s(Par_ue, k = 3) + s(Photoperiod, k = 3) + ti(Photoperiod, Par_ue, k = 3),  data = .x,
                                    family = "gaussian"(link = "log"), 
                                    method = "REML")),
         predicted = map(GamModel, ~possibPRED(.x, newdata = PAR_Photoperiod_Model_predi, type = 'response', se.fit=TRUE)),
         augmented = map(GamModel, ~augment(.x))
         )

PicoGAM_Pred <- PicoGAM %>%
  dplyr::select(Strain, Wavelength, WL, O2_uM, predicted) %>%
  dplyr::filter(predicted != "NULL") %>%
  rowwise() %>%
  mutate(db = list(cbind(predicted, PAR_Photoperiod_Model_predi))) %>%
  dplyr::select(-predicted) %>%
  unnest(col = db) %>%
  group_by(Strain, Wavelength, WL, O2_uM) %>%
  dplyr::filter(fit < 5.5) %>% #GAM model creates some unrealistic high growth rates due to low data availability
  mutate(
    IsFitGood = case_when(se.fit/fit*100 < ErrorTol ~ 1, #flags faulty data where Standarderror larger +/- Errortolerance
                         se.fit/fit*100 > ErrorTol ~ 0
                    )
    #se_erro_per = se.fit/fit*100
  # ,fit = case_when(fit >= quantile(fit, 0.75, na.rm = TRUE) ~ fit*1, #leaves only top-10%, that means fastest growth rates in the dataframe
  #                 FALSE ~ fit)
  ) %>% 
  dplyr::filter(IsFitGood == 1) 

```


# "BA48R"  "BA127R" "BA56G"  "BA77G" 
# Plot WL light GAM
#Think about maximum value for mu Z axis;  maybe 2?

``` {r GAM Plot WW WL}
GamStrain = "BA77G" 
WL_nm = "WW" 
PlotWL <- "deltaOD"
  

maxMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.max(fit)) #base::max does not work with package photobiology loaded simultaneously 
maxMu <- maxMu$fit

minMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.min(fit)) #base::max does not work with package photobiology loaded simultaneously 
  #        fit == min(fit, na.rm = TRUE)) %>%
  # distinct(fit)
minMu <- minMu$fit

PicoGAM_Plot_Prep <- PicoGAM_Pred %>%
  filter(Wavelength %in% PlotWL,
         Strain %in% GamStrain,
         WL %in% WL_nm) %>%
  mutate(Color_name = case_when(WL == "WW" ~ 'white'))


ContourLines <- PicoGAM_Plot_Prep %>%
  filter(
         Strain %in% GamStrain,
         Wavelength %in% PlotWL
  ) %>%
  group_by(O2_uM) %>% #not needed
  mutate(upper10 = quantile(fit, 0.9, na.rm = TRUE),
         median50 = quantile(fit, 0.5, na.rm = TRUE),
         lower10 = quantile(fit, 0.1, na.rm = TRUE)) %>%
  ungroup() %>%
  dplyr::select(O2_uM, upper10, median50, lower10) %>%
  distinct() %>%
  pivot_longer(cols = c(upper10, median50, lower10), names_to = 'quantile', values_to = 'quantileValue') %>%
  mutate(quantileValue = round(quantileValue, digits = 2))


##############
###plot
#https://stackoverflow.com/questions/28775036/ggplot-line-graph-with-na-values
#https://stackoverflow.com/questions/6906661/ggplot2-make-missing-value-in-geom-tile-not-blank
#https://stackoverflow.com/questions/24822621/multiple-legends-in-a-plot-with-geom-tile
#https://stackoverflow.com/questions/43395219/plotting-multiple-layers-with-geom-raster-or-geom-tile-or-geom-rect
#https://stackoverflow.com/questions/59949635/ggplot-align-grid-lines-with-end-of-geom-tile
#https://stackoverflow.com/questions/22945651/remove-space-between-plotted-data-and-the-axes
#https://stackoverflow.com/questions/5293715/how-to-use-greek-symbols-in-ggplot2


HyperChlPlotHigh <- PicoGAM_Plot_Prep %>%
  filter(
         Strain %in% GamStrain,
         Wavelength %in% PlotWL,
         O2_uM == "250"
  )


(ContourGAM_BA77G <- ggplot(data = na.omit(HyperChlPlotHigh)) + 
    geom_tile(aes(Photoperiod, Par_ue, z = fit, fill = fit)) +
    scale_fill_gradientn(name = bquote("µ ("~ d^-1~")"), colours=c("white", "black"), limits  = range(minMu, maxMu)) +
    metR::geom_contour2(aes(Photoperiod, Par_ue, z = fit, fill = fit, label = stat(level)),
                        breaks = ContourLines$quantileValue,
                        skip = 0) +
    metR::geom_contour2(data = PicoGrowthFits, aes(x = Photoperiod, y = Par_ue, z = PARPhotonDose_day), breaks = c(100000,500000,1000000,2000000,4000000,8000000,16000000, 32000000), linetype = "dashed") + 
    scale_x_continuous(limits = c(8, 28), breaks = c(8, 12, 16, 24)) +
    scale_y_continuous(limits = c(10, 900), breaks = c(30, 90, 180, 300, 600, 900)) +
       #https://stackoverflow.com/questions/15074127/use-expression-with-a-variable-r
   theme_classic() +
    theme(axis.text=element_text(size=15),
          axis.title.x = element_text(size=20),
          axis.title.y = element_text(size=35)))

```
SySl

``` {r GAM Plot WW WL, warning = FALSE, fig.height = 5, fig.width = 5}
data_textA <- data.frame(label = c('A'))
GamStrain = "BA56G" 
WL_nm = "WW" 
PlotWL <- "deltaOD"
  

maxMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.max(fit)) #base::max does not work with package photobiology loaded simultaneously 
maxMu <- maxMu$fit

minMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.min(fit)) #base::max does not work with package photobiology loaded simultaneously 
  #        fit == min(fit, na.rm = TRUE)) %>%
  # distinct(fit)
minMu <- minMu$fit

PicoGAM_Plot_Prep <- PicoGAM_Pred %>%
  filter(Wavelength %in% PlotWL,
         Strain %in% GamStrain,
         WL %in% WL_nm) %>%
  mutate(Color_name = case_when(WL == "WW" ~ 'white'))


ContourLines <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL) %>%
  mutate(upper10 = quantile(fit, 0.9, na.rm = TRUE),
         median50 = quantile(fit, 0.5, na.rm = TRUE),
         lower10 = quantile(fit, 0.1, na.rm = TRUE)) %>%
  ungroup() %>%
  dplyr::select(O2_uM, upper10, median50, lower10) %>%
  distinct() %>%
  pivot_longer(cols = c(upper10, median50, lower10), names_to = 'quantile', values_to = 'quantileValue') %>%
  mutate(quantileValue = round(quantileValue, digits = 2))


HyperChlPlotHigh <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL)

(ContourGAM_BA56G <- ggplot(data = na.omit(HyperChlPlotHigh)) + 
    geom_tile(aes(Photoperiod, Par_ue, z = fit, fill = fit)) +
    scale_fill_gradientn(name = bquote("µ ("~ d^-1~")"), colours=c("white", "black"), limits  = range(minMu, maxMu)) +
    metR::geom_contour2(aes(Photoperiod, Par_ue, z = fit, fill = fit, label = stat(level)),
                        breaks = ContourLines$quantileValue,
                        skip = 0) +
    metR::geom_contour2(data = PicoGrowthFits, aes(x = Photoperiod, y = Par_ue, z = PARPhotonDose_day), breaks = c(100000,500000,1000000,2000000,4000000,8000000,16000000, 32000000), linetype = "dashed") + 
    scale_x_continuous(limits = c(8, 24), breaks = c(8, 12, 16, 24)) +
    scale_y_continuous(limits = c(10, 900), breaks = c(30, 90, 180, 300, 600, 900)) +
    geom_text(data=data_textA, aes(x=9, y=860, label=label), size=5) +
    labs(x = "Photoperiod (h)", y = "PAR ( µmol photons "~m^-2~""~s^-1~")") +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=14),
        axis.title.y = element_text(margin=margin(r=10)),
        # axis.title.x = element_text(margin=margin(t=10)),
        axis.title.x = element_blank(),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.15,0.65),
        legend.text = element_text(size=11)))

```

``` {r GAM Plot WW WL, warning = FALSE, fig.height = 5, fig.width = 5}
data_textB <- data.frame(label = c('B'))
GamStrain = "BA77G" 
WL_nm = "WW" 
PlotWL <- "deltaOD"
  

maxMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.max(fit)) #base::max does not work with package photobiology loaded simultaneously 
maxMu <- maxMu$fit

minMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.min(fit)) #base::max does not work with package photobiology loaded simultaneously 
  #        fit == min(fit, na.rm = TRUE)) %>%
  # distinct(fit)
minMu <- minMu$fit

PicoGAM_Plot_Prep <- PicoGAM_Pred %>%
  filter(Wavelength %in% PlotWL,
         Strain %in% GamStrain,
         WL %in% WL_nm) %>%
  mutate(Color_name = case_when(WL == "WW" ~ 'white'))


ContourLines <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL) %>%
  mutate(upper10 = quantile(fit, 0.9, na.rm = TRUE),
         median50 = quantile(fit, 0.5, na.rm = TRUE),
         lower10 = quantile(fit, 0.1, na.rm = TRUE)) %>%
  ungroup() %>%
  dplyr::select(O2_uM, upper10, median50, lower10) %>%
  distinct() %>%
  pivot_longer(cols = c(upper10, median50, lower10), names_to = 'quantile', values_to = 'quantileValue') %>%
  mutate(quantileValue = round(quantileValue, digits = 2))


HyperChlPlotHigh <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL)

(ContourGAM_BA77G <- ggplot(data = na.omit(HyperChlPlotHigh)) + 
    geom_tile(aes(Photoperiod, Par_ue, z = fit, fill = fit)) +
    scale_fill_gradientn(name = bquote("µ ("~ d^-1~")"), colours=c("white", "black"), limits  = range(minMu, maxMu)) +
    metR::geom_contour2(aes(Photoperiod, Par_ue, z = fit, fill = fit, label = stat(level)),
                        breaks = ContourLines$quantileValue,
                        skip = 0) +
    metR::geom_contour2(data = PicoGrowthFits, aes(x = Photoperiod, y = Par_ue, z = PARPhotonDose_day), breaks = c(100000,500000,1000000,2000000,4000000,8000000,16000000, 32000000), linetype = "dashed") + 
    scale_x_continuous(limits = c(8, 24), breaks = c(8, 12, 16, 24)) +
    scale_y_continuous(limits = c(10, 900), breaks = c(30, 90, 180, 300, 600, 900)) +
    geom_text(data=data_textB, aes(x=9, y=860, label=label), size=5) +
    labs(x = "Photoperiod (h)", y = "PAR ( µmol photons "~m^-2~""~s^-1~")") +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=14),
        # axis.title.y = element_text(margin=margin(r=10)),
        axis.title.y = element_blank(),
        # axis.title.x = element_text(margin=margin(t=10)),
        axis.title.x = element_blank(),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.15,0.65),
        legend.text = element_text(size=11)))

```

``` {r GAM Plot WW WL, warning = FALSE, fig.height = 5, fig.width = 5}
data_textC <- data.frame(label = c('C'))
GamStrain = "BA48R" 
WL_nm = "WW" 
PlotWL <- "deltaOD"
  

maxMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.max(fit)) #base::max does not work with package photobiology loaded simultaneously 
maxMu <- maxMu$fit

minMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.min(fit)) #base::max does not work with package photobiology loaded simultaneously 
  #        fit == min(fit, na.rm = TRUE)) %>%
  # distinct(fit)
minMu <- minMu$fit

PicoGAM_Plot_Prep <- PicoGAM_Pred %>%
  filter(Wavelength %in% PlotWL,
         Strain %in% GamStrain,
         WL %in% WL_nm) %>%
  mutate(Color_name = case_when(WL == "WW" ~ 'white'))


ContourLines <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL) %>%
  mutate(upper10 = quantile(fit, 0.9, na.rm = TRUE),
         median50 = quantile(fit, 0.5, na.rm = TRUE),
         lower10 = quantile(fit, 0.1, na.rm = TRUE)) %>%
  ungroup() %>%
  dplyr::select(O2_uM, upper10, median50, lower10) %>%
  distinct() %>%
  pivot_longer(cols = c(upper10, median50, lower10), names_to = 'quantile', values_to = 'quantileValue') %>%
  mutate(quantileValue = round(quantileValue, digits = 2))


HyperChlPlotHigh <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL)

(ContourGAM_BA48R <- ggplot(data = na.omit(HyperChlPlotHigh)) + 
    geom_tile(aes(Photoperiod, Par_ue, z = fit, fill = fit)) +
    scale_fill_gradientn(name = bquote("µ ("~ d^-1~")"), colours=c("white", "black"), limits  = range(minMu, maxMu)) +
    metR::geom_contour2(aes(Photoperiod, Par_ue, z = fit, fill = fit, label = stat(level)),
                        breaks = ContourLines$quantileValue,
                        skip = 0) +
    metR::geom_contour2(data = PicoGrowthFits, aes(x = Photoperiod, y = Par_ue, z = PARPhotonDose_day), breaks = c(100000,500000,1000000,2000000,4000000,8000000,16000000, 32000000), linetype = "dashed") + 
    scale_x_continuous(limits = c(8, 24), breaks = c(8, 12, 16, 24)) +
    scale_y_continuous(limits = c(10, 900), breaks = c(30, 90, 180, 300, 600, 900)) +
    geom_text(data=data_textC, aes(x=9, y=860, label=label), size=5) +
    labs(x = "Photoperiod (h)", y = "PAR ( µmol photons "~m^-2~""~s^-1~")") +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=14),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.15,0.65),
        legend.text = element_text(size=11)))

```

``` {r GAM Plot WW WL, warning = FALSE, fig.height = 5, fig.width = 5}
data_textD <- data.frame(label = c('D'))
GamStrain = "BA127R" 
WL_nm = "WW" 
PlotWL <- "deltaOD"
 

maxMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.max(fit)) #base::max does not work with package photobiology loaded simultaneously 
maxMu <- maxMu$fit

minMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.min(fit)) #base::max does not work with package photobiology loaded simultaneously 
  #        fit == min(fit, na.rm = TRUE)) %>%
  # distinct(fit)
minMu <- minMu$fit

PicoGAM_Plot_Prep <- PicoGAM_Pred %>%
  filter(Wavelength %in% PlotWL,
         Strain %in% GamStrain,
         WL %in% WL_nm) %>%
  mutate(Color_name = case_when(WL == "WW" ~ 'white'))


ContourLines <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL) %>%
  mutate(upper10 = quantile(fit, 0.9, na.rm = TRUE),
         median50 = quantile(fit, 0.5, na.rm = TRUE),
         lower10 = quantile(fit, 0.1, na.rm = TRUE)) %>%
  ungroup() %>%
  dplyr::select(O2_uM, upper10, median50, lower10) %>%
  distinct() %>%
  pivot_longer(cols = c(upper10, median50, lower10), names_to = 'quantile', values_to = 'quantileValue') %>%
  mutate(quantileValue = round(quantileValue, digits = 2))


HyperChlPlotHigh <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL)

(ContourGAM_BA127R <- ggplot(data = na.omit(HyperChlPlotHigh)) + 
    geom_tile(aes(Photoperiod, Par_ue, z = fit, fill = fit)) +
    scale_fill_gradientn(name = bquote("µ ("~ d^-1~")"), colours=c("white", "black"), limits  = range(minMu, maxMu)) +
    metR::geom_contour2(aes(Photoperiod, Par_ue, z = fit, fill = fit, label = stat(level)),
                        breaks = ContourLines$quantileValue,
                        skip = 0) +
    metR::geom_contour2(data = PicoGrowthFits, aes(x = Photoperiod, y = Par_ue, z = PARPhotonDose_day), breaks = c(100000,500000,1000000,2000000,4000000,8000000,16000000, 32000000), linetype = "dashed") + 
    scale_x_continuous(limits = c(8, 24), breaks = c(8, 12, 16, 24)) +
    scale_y_continuous(limits = c(10, 900), breaks = c(30, 90, 180, 300, 600, 900)) +
    geom_text(data=data_textD, aes(x=9, y=860, label=label), size=5) +
    labs(x = "Photoperiod (h)", y = "PAR ( µmol photons "~m^-2~""~s^-1~")") +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=14),
        # axis.title.y = element_text(margin=margin(r=10)),
        axis.title.y = element_blank(),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.15,0.65),
        legend.text = element_text(size=11)))

```


```{r, warning = FALSE, fig.height = 9, fig.width = 10}
ggp<- (ContourGAM_BA56G+ContourGAM_BA77G)/(ContourGAM_BA48R+ContourGAM_BA127R)
ggp                           
```

# Save plot 

```{r save plot}
ggsave(file = file.path(FigPath, paste("Fig_GAM",".png",sep = "")), height=9, width= 9.5, dpi = 300, limitsize = TRUE)
```

-------------------------- COLOUR ------------------------------


``` {r GAM Plot WW WL, warning = FALSE, fig.height = 5, fig.width = 5}
data_textA <- data.frame(label = c('A'))
GamStrain = "BA56G" 
WL_nm = "WW" 
PlotWL <- "deltaOD"
  

maxMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.max(fit)) #base::max does not work with package photobiology loaded simultaneously 
maxMu <- maxMu$fit

minMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.min(fit)) #base::max does not work with package photobiology loaded simultaneously 
  #        fit == min(fit, na.rm = TRUE)) %>%
  # distinct(fit)
minMu <- minMu$fit

PicoGAM_Plot_Prep <- PicoGAM_Pred %>%
  filter(Wavelength %in% PlotWL,
         Strain %in% GamStrain,
         WL %in% WL_nm) %>%
  mutate(Color_name = case_when(WL == "WW" ~ 'white'))


ContourLines <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL) %>%
  mutate(upper10 = quantile(fit, 0.9, na.rm = TRUE),
         median50 = quantile(fit, 0.5, na.rm = TRUE),
         lower10 = quantile(fit, 0.1, na.rm = TRUE)) %>%
  ungroup() %>%
  dplyr::select(O2_uM, upper10, median50, lower10) %>%
  distinct() %>%
  pivot_longer(cols = c(upper10, median50, lower10), names_to = 'quantile', values_to = 'quantileValue') %>%
  mutate(quantileValue = round(quantileValue, digits = 2))


HyperChlPlotHigh <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL)

(ContourGAM_BA56Gc <- ggplot(data = na.omit(HyperChlPlotHigh)) + 
    geom_tile(aes(Photoperiod, Par_ue, z = fit, fill = fit)) +
    scale_fill_gradientn(name = bquote("µ ("~ d^-1~")"), colours=c("white", "seagreen4"), limits  = range(minMu, maxMu)) +
    metR::geom_contour2(aes(Photoperiod, Par_ue, z = fit, fill = fit, label = stat(level)),
                        breaks = ContourLines$quantileValue,
                        skip = 0) +
    metR::geom_contour2(data = PicoGrowthFits, aes(x = Photoperiod, y = Par_ue, z = PARPhotonDose_day), breaks = c(100000,500000,1000000,2000000,4000000,8000000,16000000, 32000000), linetype = "dashed", size = 0.2, colour = "gray10") + 
    scale_x_continuous(limits = c(8, 24), breaks = c(8, 12, 16, 24)) +
    scale_y_continuous(limits = c(10, 900), breaks = c(30, 90, 180, 300, 600, 900)) +
    geom_text(data=data_textA, aes(x=9, y=860, label=label), size=5) +
    labs(x = "Photoperiod (h)", y = "PAR ( µmol photons "~m^-2~""~s^-1~")") +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=14),
        axis.title.y = element_text(margin=margin(r=10)),
        # axis.title.x = element_text(margin=margin(t=10)),
        axis.title.x = element_blank(),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.15,0.65),
        legend.text = element_text(size=11)))

```

``` {r GAM Plot WW WL, warning = FALSE, fig.height = 5, fig.width = 5}
data_textB <- data.frame(label = c('B'))
GamStrain = "BA77G" 
WL_nm = "WW" 
PlotWL <- "deltaOD"
  

maxMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.max(fit)) #base::max does not work with package photobiology loaded simultaneously 
maxMu <- maxMu$fit

minMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.min(fit)) #base::max does not work with package photobiology loaded simultaneously 
  #        fit == min(fit, na.rm = TRUE)) %>%
  # distinct(fit)
minMu <- minMu$fit

PicoGAM_Plot_Prep <- PicoGAM_Pred %>%
  filter(Wavelength %in% PlotWL,
         Strain %in% GamStrain,
         WL %in% WL_nm) %>%
  mutate(Color_name = case_when(WL == "WW" ~ 'white'))


ContourLines <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL) %>%
  mutate(upper10 = quantile(fit, 0.9, na.rm = TRUE),
         median50 = quantile(fit, 0.5, na.rm = TRUE),
         lower10 = quantile(fit, 0.1, na.rm = TRUE)) %>%
  ungroup() %>%
  dplyr::select(O2_uM, upper10, median50, lower10) %>%
  distinct() %>%
  pivot_longer(cols = c(upper10, median50, lower10), names_to = 'quantile', values_to = 'quantileValue') %>%
  mutate(quantileValue = round(quantileValue, digits = 2))


HyperChlPlotHigh <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL)

(ContourGAM_BA77Gc <- ggplot(data = na.omit(HyperChlPlotHigh)) + 
    geom_tile(aes(Photoperiod, Par_ue, z = fit, fill = fit)) +
    scale_fill_gradientn(name = bquote("µ ("~ d^-1~")"), colours=c("white", "palegreen3"), limits  = range(minMu, maxMu)) +
    metR::geom_contour2(aes(Photoperiod, Par_ue, z = fit, fill = fit, label = stat(level)),
                        breaks = ContourLines$quantileValue,
                        skip = 0) +
    metR::geom_contour2(data = PicoGrowthFits, aes(x = Photoperiod, y = Par_ue, z = PARPhotonDose_day), breaks = c(100000,500000,1000000,2000000,4000000,8000000,16000000, 32000000), linetype = "dashed", size = 0.2, colour = "gray10") + 
    scale_x_continuous(limits = c(8, 24), breaks = c(8, 12, 16, 24)) +
    scale_y_continuous(limits = c(10, 900), breaks = c(30, 90, 180, 300, 600, 900)) +
    geom_text(data=data_textB, aes(x=9, y=860, label=label), size=5) +
    labs(x = "Photoperiod (h)", y = "PAR ( µmol photons "~m^-2~""~s^-1~")") +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=14),
        # axis.title.y = element_text(margin=margin(r=10)),
        axis.title.y = element_blank(),
        # axis.title.x = element_text(margin=margin(t=10)),
        axis.title.x = element_blank(),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.15,0.65),
        legend.text = element_text(size=11)))

```

``` {r GAM Plot WW WL, warning = FALSE, fig.height = 5, fig.width = 5}
data_textC <- data.frame(label = c('C'))
GamStrain = "BA48R" 
WL_nm = "WW" 
PlotWL <- "deltaOD"
  

maxMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.max(fit)) #base::max does not work with package photobiology loaded simultaneously 
maxMu <- maxMu$fit

minMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.min(fit)) #base::max does not work with package photobiology loaded simultaneously 
  #        fit == min(fit, na.rm = TRUE)) %>%
  # distinct(fit)
minMu <- minMu$fit

PicoGAM_Plot_Prep <- PicoGAM_Pred %>%
  filter(Wavelength %in% PlotWL,
         Strain %in% GamStrain,
         WL %in% WL_nm) %>%
  mutate(Color_name = case_when(WL == "WW" ~ 'white'))


ContourLines <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL) %>%
  mutate(upper10 = quantile(fit, 0.9, na.rm = TRUE),
         median50 = quantile(fit, 0.5, na.rm = TRUE),
         lower10 = quantile(fit, 0.1, na.rm = TRUE)) %>%
  ungroup() %>%
  dplyr::select(O2_uM, upper10, median50, lower10) %>%
  distinct() %>%
  pivot_longer(cols = c(upper10, median50, lower10), names_to = 'quantile', values_to = 'quantileValue') %>%
  mutate(quantileValue = round(quantileValue, digits = 2))


HyperChlPlotHigh <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL)

(ContourGAM_BA48Rc <- ggplot(data = na.omit(HyperChlPlotHigh)) + 
    geom_tile(aes(Photoperiod, Par_ue, z = fit, fill = fit)) +
    scale_fill_gradientn(name = bquote("µ ("~ d^-1~")"), colours=c("white", "brown1"), limits  = range(minMu, maxMu)) +
    metR::geom_contour2(aes(Photoperiod, Par_ue, z = fit, fill = fit, label = stat(level)),
                        breaks = ContourLines$quantileValue,
                        skip = 0) +
    metR::geom_contour2(data = PicoGrowthFits, aes(x = Photoperiod, y = Par_ue, z = PARPhotonDose_day), breaks = c(100000,500000,1000000,2000000,4000000,8000000,16000000, 32000000), linetype = "dashed", size = 0.2, colour = "gray10") + 
    scale_x_continuous(limits = c(8, 24), breaks = c(8, 12, 16, 24)) +
    scale_y_continuous(limits = c(10, 900), breaks = c(30, 90, 180, 300, 600, 900)) +
    geom_text(data=data_textC, aes(x=9, y=860, label=label), size=5) +
    labs(x = "Photoperiod (h)", y = "PAR ( µmol photons "~m^-2~""~s^-1~")") +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=14),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.15,0.65),
        legend.text = element_text(size=11)))

```



``` {r GAM Plot WW WL, warning = FALSE, fig.height = 5, fig.width = 5}
data_textD <- data.frame(label = c('D'))
GamStrain = "BA127R" 
WL_nm = "WW" 
PlotWL <- "deltaOD"
 

maxMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.max(fit)) #base::max does not work with package photobiology loaded simultaneously 
maxMu <- maxMu$fit

minMu <- PicoGAM_Pred %>%
  ungroup() %>%
  filter(Wavelength %in% PlotWL) %>%
  slice(which.min(fit)) #base::max does not work with package photobiology loaded simultaneously 
  #        fit == min(fit, na.rm = TRUE)) %>%
  # distinct(fit)
minMu <- minMu$fit

PicoGAM_Plot_Prep <- PicoGAM_Pred %>%
  filter(Wavelength %in% PlotWL,
         Strain %in% GamStrain,
         WL %in% WL_nm) %>%
  mutate(Color_name = case_when(WL == "WW" ~ 'white'))


ContourLines <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL) %>%
  mutate(upper10 = quantile(fit, 0.9, na.rm = TRUE),
         median50 = quantile(fit, 0.5, na.rm = TRUE),
         lower10 = quantile(fit, 0.1, na.rm = TRUE)) %>%
  ungroup() %>%
  dplyr::select(O2_uM, upper10, median50, lower10) %>%
  distinct() %>%
  pivot_longer(cols = c(upper10, median50, lower10), names_to = 'quantile', values_to = 'quantileValue') %>%
  mutate(quantileValue = round(quantileValue, digits = 2))


HyperChlPlotHigh <- PicoGAM_Plot_Prep %>%
  filter(Strain %in% GamStrain,
         Wavelength %in% PlotWL)

(ContourGAM_BA127Rc <- ggplot(data = na.omit(HyperChlPlotHigh)) + 
    geom_tile(aes(Photoperiod, Par_ue, z = fit, fill = fit)) +
    scale_fill_gradientn(name = bquote("µ ("~ d^-1~")"), colours=c("white", "brown4"), limits  = range(minMu, maxMu)) +
    metR::geom_contour2(aes(Photoperiod, Par_ue, z = fit, fill = fit, label = stat(level)),
                        breaks = ContourLines$quantileValue,
                        skip = 0) +
    metR::geom_contour2(data = PicoGrowthFits, aes(x = Photoperiod, y = Par_ue, z = PARPhotonDose_day), breaks = c(100000,500000,1000000,2000000,4000000,8000000,16000000, 32000000), linetype = "dashed", size = 0.2, colour = "gray10") + 
    scale_x_continuous(limits = c(8, 24), breaks = c(8, 12, 16, 24)) +
    scale_y_continuous(limits = c(10, 900), breaks = c(30, 90, 180, 300, 600, 900)) +
    geom_text(data=data_textD, aes(x=9, y=860, label=label), size=5) +
    labs(x = "Photoperiod (h)", y = "PAR ( µmol photons "~m^-2~""~s^-1~")") +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=14),
        # axis.title.y = element_text(margin=margin(r=10)),
        axis.title.y = element_blank(),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.15,0.65),
        legend.text = element_text(size=11)))

```

```{r, warning = FALSE, fig.height = 9, fig.width = 10}
ggp<- (ContourGAM_BA56Gc+ContourGAM_BA77Gc)/(ContourGAM_BA48Rc+ContourGAM_BA127Rc)
ggp                           
```

# Save plot 

```{r save plot}
ggsave(file = file.path(FigPath, paste("Fig_GAM_Colour",".png",sep = "")), height=9, width= 9.5, dpi = 300, limitsize = TRUE)
```

```{r combine plots}

# #combine red and blue GAM plots
# CombinedGAM <- plot_grid(ContourGAM_BA56G, ContourGAM_BA77G, ContourGAM_BA127R, ContourGAM_BA48R, nrow = 2, align = "v") 
# 
# # common x-axis title
# x.grob <- textGrob("Photoperiod (h)", 
#                    gp = gpar(fontsize = 15))
# # common y-axis title
# y.grob <- textGrob("PAR (µmol photons"~ m^-2~ ~s^-1~ ")", 
#                    gp = gpar(fontface="bold", fontsize = 20), rot = 90)
# 
# # add titles to plot
# LabelledCombinedGam <- grid.arrange(arrangeGrob(CombinedGAM, left = y.grob, bottom = x.grob))

```


```{r save plots}

# # SS120GAM.png for manuscript
#  ggsave(file = file.path(paste(PlotsOut, sep = "/"), paste(GamStrain, "GAM", ".png", sep = ""), fsep = .Platform$file.sep), plot = LabelledCombinedGam,  height = 10, width = 10)
# 
# # SS120GAM is Fig6.tiff for PLOSONE submission
#  ggsave(file = file.path(PlotsOutPLOS, "Fig6.tiff", fsep = .Platform$file.sep), plot = LabelledCombinedGam, device = NULL, scale = 1,  height = 10, width = 10, compression = "lzw")
 
```

