---
title: "Process_SolisensePigmentsData"
author:
- Sylwia Sliwinska-Wilczewska
- Douglas A. Campbell
date: "`r format(Sys.Date())`"
output:
bookdown::html_document2:
    code_folding: show
    keep_md: yes
    toc: TRUE
    toc_float: TRUE
    toc_depth: 6
    fig_caption: yes
bibliography: BalticPhotoperiod.bib
csl: plos-one.csl
editor_options: 
  markdown: 
    wrap: 72
---

# Set Chunk Options

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
knitr::opts_chunk$set(fig.path='Figs/')
```

# Introduction

Process_SolisensePigmentsData.Rmd processes and combines BalticPhotoperiod_Processed_SolisenseData.Rds from Data/ProcessedData/ProcessedSolisenseData folder and BalticPhotoperiod_Processed_PigmentsAll.Rds from Data/ProcessedData/ProcessedPigmentsData folder. This .Rmd generates BalticPhotoperiod_Processed_SolisensePigmentsAll.Rds (stored in Data/ProcessedData/ProcessedSolisenseData folder) and plots stored in Output/Figures folder.

# Load Libraries and set Project Variables

```{r load libraries, warning = FALSE, echo=FALSE} 
library(tidyverse)
library(lubridate)
library(stringr)
library(broom)
library(knitr)
library(OneR)
library(zoo)
library(ggpubr)
library(caret)
library(reshape2)
library(gcookbook)
library(scales)
library(Cairo) #for greek symbols
library(googledrive)
library(googlesheets4)
library(readxl)
library(multcompView)
library("patchwork") # merging plots
library(grid) #colour facets
```

```{r set project variables}
Project <- "BalticPhotoperiod"
DataOut <- file.path("..", "Data", "ProcessedData", "ProcessedSolisensePigmentsData")
DataIn <- file.path("..", "Data", "ProcessedData", "ProcessedSolisenseData", fsep = .Platform$file.sep)

FigPath <- file.path("..", "Output", "Figures")
FigRdsPath <- file.path("..", "Output", "FiguresRds")
TableRdsPath <- file.path("..", "Output", "TablesRDS")
```

# List and read Imported_Solisense RDS

```{r Exported Rmd}
list.files(path = DataIn, pattern = Project, full.names = TRUE)
```

# This RDS contained only data from corresponding growth light and dark
# Also, conteined mean sig - mean for replica measured on the same day

```{r read ProcessFile Sol}
SolisenseFile <- "../Data/ProcessedData/ProcessedSolisenseData/BalticPhotoperiod_Processed_SolisenseData.Rds"  

SolisenseFileName <- str_split(string = SolisenseFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds")

SolFits <- readRDS(SolisenseFile)  %>%
  ungroup()
```


# Sig per phyco/chla ratio

Issue - not always pigment based on Olis correspond to Solisense data-> I choose the time (range) that pigments correspond to Sig measurements (for exp and st phase separately). Max 5 measurements for pigments. Then I made a mean for pigments to get one value.

```{r set project variables}
Project <- "BalticPhotoperiod"
DataIn <- file.path("..", "Data", "ProcessedData", "ProcessedPigmentsData", fsep = .Platform$file.sep)
```

```{r Exported Rmd}
list.files(path = DataIn, pattern = Project, full.names = TRUE)
```

```{r read pigments File}
#df ontained mean OD per day from Multiculti and Abs from Olis spectra for selected nm. Based on this I calculated pigments per mL and per cell (pg/cell)

MCPigmentAllFile <- "../Data/ProcessedData/ProcessedPigmentsData/BalticPhotoperiod_Processed_PigmentsAll.Rds"
MCPigmentAllFileName <- str_split(string = MCPigmentAllFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds")
MCPigmentAll <- readRDS(MCPigmentAllFile)  %>%
  ungroup()
```

```{r}
MCPigmentAll <- MCPigmentAll %>% 
  filter(ToD==10) # When I choose 12 (peak) then I loose a few data point from 12h and 900UE
```


# Altrough MCPigmentAll already contain Exp and St phase, I took exactly the same parameters (settings) like Sig, b/c MCPigmentAll do not contain information on 600 uE. 

# Choose only exp data

```{r choose only exp data}
O1 <- MCPigmentAll %>%
  filter(Par_ue == 300 | Par_ue == 90 | Par_ue == 180 | Par_ue == 600 | Par_ue == 900) %>%
  filter(Photoperiod == 24) %>%
  filter(E_days <= 4)

O2 <- MCPigmentAll %>%
  filter(Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
  filter(Photoperiod == 16) %>%
  filter(E_days < 9)

O3 <- MCPigmentAll %>%
  filter(Par_ue == 900 | Par_ue == 600) %>%
  filter(Photoperiod == 16) %>%
  filter(E_days <= 4)

O4 <- MCPigmentAll %>%
  filter(Par_ue == 30) %>%
  filter(Photoperiod == 16) %>%
  filter(E_days <= 14)

O5 <- MCPigmentAll %>%
  filter(Par_ue == 30) %>%
  filter(Photoperiod == 8 | Photoperiod == 12) %>%
  filter(E_days <=14)

O6 <- MCPigmentAll %>%
  filter(Par_ue == 90) %>%
  filter(Photoperiod == 8) %>%
  filter(E_days <=14)

O7 <- MCPigmentAll %>%
  filter(Par_ue == 90) %>%
  filter(Photoperiod == 12) %>%
  filter(E_days <=10)

O8 <- MCPigmentAll %>%
  filter(Par_ue == 180 | Par_ue == 300) %>%
  filter(Photoperiod == 8 | Photoperiod == 12) %>%
  filter(E_days <=10)

O9 <- MCPigmentAll %>%
  filter(Par_ue == 900 | Par_ue == 600) %>%
  filter(Photoperiod == 8 | Photoperiod == 12) %>%
  filter(E_days <=7)

O10 <- MCPigmentAll %>%
  filter(Par_ue == 30) %>%
  filter(Photoperiod == 24) %>%
  filter(E_days <= 8)

MCPigmentAllExp <-rbind(O1, O2, O3, O4, O5, O6, O7, O8, O9, O10)

rm(O1, O2, O3, O4, O5, O6, O7, O8, O9, O10)
```

# Choose only Stationary data 

```{r choose only St data}
O1 <- MCPigmentAll %>%
  filter(Par_ue == 300 | Par_ue == 90 | Par_ue == 180 | Par_ue == 600 | Par_ue == 900) %>%
  filter(Photoperiod == 24) %>%
  filter(E_days > 4)

O2 <- MCPigmentAll %>%
  filter(Par_ue == 30) %>%
  filter(Photoperiod == 12 | Photoperiod == 16) %>%
  filter(E_days >14)

O3 <- MCPigmentAll %>%
  filter(Par_ue == 90) %>%
  filter(Photoperiod == 12 | Photoperiod == 16) %>%
  filter(E_days >10)

O4 <- MCPigmentAll %>%
  filter(Par_ue == 180 | Par_ue == 300) %>%
  filter(Photoperiod == 8 | Photoperiod == 12 | Photoperiod == 16) %>%
  filter(E_days >10)

O5 <- MCPigmentAll %>%
  filter(Par_ue == 900 | Par_ue == 600) %>%
  filter(Photoperiod == 16) %>%
  filter(E_days >=6)

O6 <- MCPigmentAll %>%
  filter(Par_ue == 900 | Par_ue == 600) %>%
  filter(Photoperiod == 12) %>%
  filter(E_days >=4)

O6 <- MCPigmentAll %>%
  filter(Par_ue == 900 | Par_ue == 600) %>%
  filter(Photoperiod == 8) %>%
  filter(E_days >7)

MCPigmentAllSt <-rbind(O1, O2, O3, O4, O5, O6)

rm(O1, O2, O3, O4, O5, O6)
```

# Combine Exp and St data

```{r}
MCPigmentAllExp<-MCPigmentAllExp %>%
  select(-c(Phase)) # Removed previous Phase b/c do not contained 600uE data

MCPigmentAllSt<-MCPigmentAllSt %>%
  select(-c(Phase)) # Removed previous Phase b/c do not contained 600uE data

  MCPigmentAllExp$Phase <- 'Exponential'
  MCPigmentAllSt$Phase <- 'Pre-stationary'

  MCPigmentAllExpSt <-rbind(MCPigmentAllExp, MCPigmentAllSt)
```



# Create preliminary plot

```{r preliminary plot}
lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))
lab2=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab3=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))

MCPigmentAll %>%
  ggplot() +
  geom_point(aes(x = Time_h, y = PhycoChlaRatio, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  # geom_vline(data = tMaxAGLines_056, aes(xintercept = tMaxAG), linetype="dotdash", colour = "brown4") +
  # geom_vline(data = tMaxAGLines_077, aes(xintercept = tMaxAG), linetype="dotdash", colour = "brown1") +
  # geom_vline(data = tMaxAGLines_048, aes(xintercept = tMaxAG), linetype="dotdash", colour = "seagreen4") +
  # geom_vline(data = tMaxAGLines_127, aes(xintercept = tMaxAG), linetype="dotdash", colour = "palegreen3") +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  ggh4x::facet_nested(cols = vars(Photoperiod), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() 

MCPigmentAllExp %>%
  ggplot() +
  geom_point(aes(x = Time_h, y = PhycoChlaRatio, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  # geom_vline(data = tMaxAGLines_056, aes(xintercept = tMaxAG), linetype="dotdash", colour = "brown4") +
  # geom_vline(data = tMaxAGLines_077, aes(xintercept = tMaxAG), linetype="dotdash", colour = "brown1") +
  # geom_vline(data = tMaxAGLines_048, aes(xintercept = tMaxAG), linetype="dotdash", colour = "seagreen4") +
  # geom_vline(data = tMaxAGLines_127, aes(xintercept = tMaxAG), linetype="dotdash", colour = "palegreen3") +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  ggh4x::facet_nested(cols = vars(Photoperiod), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() 

MCPigmentAllSt %>%
  ggplot() +
  geom_point(aes(x = Time_h, y = PhycoChlaRatio, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  # geom_vline(data = tMaxAGLines_056, aes(xintercept = tMaxAG), linetype="dotdash", colour = "brown4") +
  # geom_vline(data = tMaxAGLines_077, aes(xintercept = tMaxAG), linetype="dotdash", colour = "brown1") +
  # geom_vline(data = tMaxAGLines_048, aes(xintercept = tMaxAG), linetype="dotdash", colour = "seagreen4") +
  # geom_vline(data = tMaxAGLines_127, aes(xintercept = tMaxAG), linetype="dotdash", colour = "palegreen3") +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  ggh4x::facet_nested(cols = vars(Photoperiod), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() 
```

# Not always E_days from Sig and Phyco/Chla ratio matches. Thus, I took only pigments from the range of days when Sig was measured. Later I made a mean from the pigment value taken from choosem pig value

# Choose only pigment data when Sig was measured (time range)

```{r choose pigment data when Sig was measured}
O2 <- MCPigmentAllExpSt %>%
  filter(Phase == "Exponential") %>% 
  filter(Photoperiod == 24)
O3 <- MCPigmentAllExpSt %>%
  filter(Phase == "Exponential") %>% 
  filter(Photoperiod == 8) %>% 
  filter(E_days>5)
O4 <- MCPigmentAllExpSt %>%
  filter(Phase == "Exponential") %>% 
  filter(Photoperiod == 12) %>% 
  filter(E_days>3)
O5 <- MCPigmentAllExpSt %>%
  filter(Phase == "Exponential") %>% 
  filter(Photoperiod == 16) %>% 
  filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>% 
  filter(E_days>5)
O6 <- MCPigmentAllExpSt %>%
  filter(Phase == "Exponential") %>% 
  filter(Photoperiod == 16) %>% 
  filter(Par_ue == 600 | Par_ue == 900)

MCPigmentAllExpStChoosen_1 <-rbind(O2, O3, O4, O5, O6)

O7 <- MCPigmentAllExpStChoosen_1 %>% 
  filter(Phase == "Exponential") %>% 
  filter(Par_ue == 180 | Par_ue == 300) %>% 
  filter(E_days<=8)
O8 <- MCPigmentAllExpStChoosen_1 %>% 
  filter(Phase == "Exponential") %>% 
  filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 600 | Par_ue == 900) 
  #filter(E_days<=8)
O1 <- MCPigmentAllExpSt %>%
  filter(Phase == "Pre-stationary")

MCPigmentAllExpStChoosen <-rbind(O1, O7, O8)

rm(O1, O2, O3, O4, O5, O6, O7, O8, MCPigmentAllExpStChoosen_1)
```

# Filter lag or very early exp phase and unrevelant value

```{r}
MCPigmentAllExpStChoosen<-MCPigmentAllExpStChoosen %>% 
  filter(E_days >1) 
```

# Create preliminary plot

```{r preliminary plot}
lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))
lab2=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab3=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))

MCPigmentAllExpStChoosen %>%
  filter(Phase == "Exponential") %>% 
  ggplot() +
  geom_point(aes(x = Time_h, y = PhycoChlaRatio, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  # geom_vline(data = tMaxAGLines_056, aes(xintercept = tMaxAG), linetype="dotdash", colour = "brown4") +
  # geom_vline(data = tMaxAGLines_077, aes(xintercept = tMaxAG), linetype="dotdash", colour = "brown1") +
  # geom_vline(data = tMaxAGLines_048, aes(xintercept = tMaxAG), linetype="dotdash", colour = "seagreen4") +
  # geom_vline(data = tMaxAGLines_127, aes(xintercept = tMaxAG), linetype="dotdash", colour = "palegreen3") +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  ggh4x::facet_nested(cols = vars(Photoperiod), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() 

MCPigmentAllExpStChoosen %>%
  filter(Phase == "Pre-stationary") %>% 
  ggplot() +
  geom_point(aes(x = Time_h, y = PhycoChlaRatio, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  # geom_vline(data = tMaxAGLines_056, aes(xintercept = tMaxAG), linetype="dotdash", colour = "brown4") +
  # geom_vline(data = tMaxAGLines_077, aes(xintercept = tMaxAG), linetype="dotdash", colour = "brown1") +
  # geom_vline(data = tMaxAGLines_048, aes(xintercept = tMaxAG), linetype="dotdash", colour = "seagreen4") +
  # geom_vline(data = tMaxAGLines_127, aes(xintercept = tMaxAG), linetype="dotdash", colour = "palegreen3") +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  ggh4x::facet_nested(cols = vars(Photoperiod), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() 
```

```{r}
#rm(tmaxAG, tMaxAGLines_056, tMaxAGLines_077, tMaxAGLines_048, tMaxAGLines_127, MCPigmentAllSt, MCPigmentAllExp)
```

#Create preliminary plot

```{r preliminary plot}
lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))
lab2=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab3=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))

MCPigmentAllExpSt %>%
  ggplot() +
  geom_point(aes(x = PARPhotonDose_day, y = PhycoChlaRatio, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)),  alpha = 0.8, size = 3, show.legend = T) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab2) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab3) +
  ggh4x::facet_nested(cols = vars(Phase), rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

MCPigmentAllExpStChoosen %>%
  ggplot() +
  geom_point(aes(x = PARPhotonDose_day, y = PhycoChlaRatio, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)),  alpha = 0.8, size = 3, show.legend = T) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab2) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab3) +
  ggh4x::facet_nested(cols = vars(Phase), rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 


MCPigmentAllExpSt %>%
  ggplot() +
  geom_point(aes(x = PARPhotonDose_day, y = PURPARRatio, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)),  alpha = 0.8, size = 3, show.legend = T) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab2) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab3) +
  ggh4x::facet_nested(cols = vars(Phase), rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

MCPigmentAllExpStChoosen %>%
  ggplot() +
  geom_point(aes(x = PARPhotonDose_day, y = PURPARRatio, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)),  alpha = 0.8, size = 3, show.legend = T) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab2) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab3) +
  ggh4x::facet_nested(cols = vars(Phase), rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 
```
# Make "one big - All" mean to combine all days (divided by Exp and St) and all replica when samples were measured 
(This give me only one value of Phyco/Chla ratio for sig plot)

# AllmeanPhycoChlaRatio contains 1-6 measurements (different days)

```{r calculate Sigma mean from exp phase}
#E_days, Time_h, caused problem

MCPigmentAllExpStChoosen<-MCPigmentAllExpStChoosen %>%
  drop_na(PhycoChlaRatio) %>% 
  group_by(Strain, Par_ue, Photoperiod, WL, O2, Phase) %>%

  summarize(SampleID, ToD, Run, Strain, ExpDate, FilenameMC, Tube, Par_ue, Photoperiod, O2, WL, MC, LightShape, ExpEndDate, meanActinic_par_h, meanOD680_h, meanOD720_h, meanDeltaOD_h, facetsPar_ue, facetsPhotoperiod, cellmL_OD680, PARPhotonDose_day, ObsDateOlis, PUR, PURPhotonDose_day, ChlaugmL, CarugmL, PEugmL, PCugmL, APCugmL, Chlapgcell, Carpgcell, PEpgcell, PCpgcell, APCpgcell, Phycopgcell, CarChlaRatio, PhycoChlaRatio, PEPCRatio, cellL_OD680, tMaxAG, AchivePreStationary, MaxDG, MaxAG, dayRound_tmaxAG, facetsStrain, facetsPARPhotonDose_day, PURPARRatio, Phase,

            AllmeanPhycoChlaRatio = mean(PhycoChlaRatio),
            AllsdPhycoChlaRatio = sd(PhycoChlaRatio),
            AllmeanPURPARRatio = mean(PURPARRatio),
            AllsdPURPARRatio = sd(PURPARRatio), 
            AllmeancellL_OD680 = mean(cellL_OD680),
            AllsdcellL_OD680 = sd(cellL_OD680)) %>%
  ungroup()
```


----------------------------# Merge Solisense data with Pigment data---------------------------------------------------

```{r Joining Solisense and pig data}
SolFitsPigmentExp <- SolFits %>% 
  left_join(., MCPigmentAllExpStChoosen, by = c("SampleID" = "SampleID", "Strain"="Strain", "Par_ue"="Par_ue", "Photoperiod"="Photoperiod", "Run"="Run", "WL"="WL", "O2"="O2", "Phase"="Phase", "PARPhotonDose_day"="PARPhotonDose_day", "ExpDate"="ExpDate", "facetsStrain" = "facetsStrain")) 
 SolFitsPigmentExp$facetsPhase <- "Phase~of~growth"

# SolFitsPigmentExp1s <- SolFitsExpSt1s %>% 
#   left_join(., MCPigmentAllExpStChoosen, by = c("SampleID" = "SampleID", "Strain"="Strain", "Par_ue"="Par_ue", "Photoperiod"="Photoperiod", "Run"="Run", "WL"="WL", "O2"="O2", "Phase"="Phase", "PARPhotonDose_day"="PARPhotonDose_day", "ExpDate"="ExpDate", "facetsStrain" = "facetsStrain")) 
# SolFitsPigmentExp1s$facetsPhase <- "Phase~of~growth"

 
rm(SolFitsExpSt, MCPigmentAllExpStChoosen)
#rm(SolFitsExpSt, SolFitsExpSt1s, MCPigmentExp)
```

```{r Joining Solisense and pig exp data}
# SolFitsPigmentExp <- SolFitsExpSt %>% 
#   left_join(., MCPigmentAllExpSt, by = c("Strain"="Strain","Par_ue"="Par_ue","Photoperiod"="Photoperiod")) 
# 
# SolFitsPigmentExp1s <- SolFitsExpSt1s %>% 
#   left_join(., MCPigmentAllExpSt, by = c("Strain"="Strain","Par_ue"="Par_ue","Photoperiod"="Photoperiod")) 

#rm(SolFitsExpSt, SolFitsExpSt1s, MCPigmentExp)
```

# Filter unrevelant data

```{r}
# SolFitsPigmentExp <- SolFitsPigmentExp %>% 
#   filter(AllmeanPhycoChlaRatio>0)
# 
# SolFitsPigmentExp1s <- SolFitsPigmentExp1s %>% 
#   filter(AllmeanPhycoChlaRatio>0)
```


# Create preliminary plots

```{r preliminary plots}
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))

SolFitsPigmentExp %>% 
  ggplot() +
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = AllmeanSig_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, show.legend = T) +
  # geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = AllmeanSig_nm2psii - AllsdSig_nm2psii, ymax = AllmeanSig_nm2psii + AllsdSig_nm2psii, colour=as.factor(Par_ue))) +
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3","goldenrod2", "khaki2"), name="", labels = lab2) +
  ggh4x::facet_nested(cols = vars(Phase, Ex_WL), rows = vars(Strain), labeller = label_parsed) +
  theme_bw()

SolFitsPigmentExp %>% 
  ggplot() +
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = AllmeanSigdark_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, show.legend = T) +
  geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = AllmeanSigdark_nm2psii - AllsdSigdark_nm2psii, ymax = AllmeanSigdark_nm2psii + AllsdSigdark_nm2psii, colour=as.factor(Par_ue))) +
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3","goldenrod2", "khaki2"), name="", labels = lab2) +
  ggh4x::facet_nested(cols = vars(Phase, Ex_WL), rows = vars(Strain), labeller = label_parsed) +
  theme_bw()

SolFitsPigmentExp %>% 
  ggplot() +
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = AllmeanSig_nm2psii, colour = as.factor(Strain)), size = 3.5, show.legend = T) +
  geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = AllmeanSig_nm2psii - AllsdSig_nm2psii, ymax = AllmeanSig_nm2psii + AllsdSig_nm2psii, colour=as.factor(Strain))) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  ggh4x::facet_nested(cols = vars(Phase, Ex_WL), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() 

SolFitsPigmentExp %>% 
  ggplot() +
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = AllmeanSigdark_nm2psii, colour = as.factor(Strain)), size = 3.5, show.legend = T) +
  geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = AllmeanSigdark_nm2psii - AllsdSigdark_nm2psii, ymax = AllmeanSigdark_nm2psii + AllsdSigdark_nm2psii, colour=as.factor(Strain))) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  ggh4x::facet_nested(cols = vars(Phase, Ex_WL), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() 


# SolFitsPigmentExp1s %>% 
#   ggplot() +
#   geom_point(aes(x = AllmeanPhycoChlaRatio, y = Sig1s_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, show.legend = T) +
#   # geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = meanSig1s_nm2psii - sdSig1s_nm2psii, ymax = meanSig1s_nm2psii + sdSig1s_nm2psii, colour=as.factor(Par_ue))) +
#   scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab1) +
#   scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3","goldenrod2", "khaki2"), name="", labels = lab2) +
#   ggh4x::facet_nested(cols = vars(Ex_WL), rows = vars(Strain), labeller = label_parsed) +
#   theme_bw() 
# 
# 
# SolFitsPigmentExp1s %>% 
#   ggplot() +
#   geom_point(aes(x = AllmeanPhycoChlaRatio, y = Sig1s_nm2psii, colour = as.factor(Strain)), size = 3.5, show.legend = T) +
#     # geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = meanSig1s_nm2psii - sdSig1s_nm2psii, ymax = meanSig1s_nm2psii + sdSig1s_nm2psii, colour=as.factor(Strain))) +
#   scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
#   ggh4x::facet_nested(cols = vars(Ex_WL), rows = vars(Par_ue), labeller = label_parsed) +
#   theme_bw()
```

# Combine PC and PE-rich strains together

```{r combine PC and PE-rich strains}
SolFitsAllPigmentPC<-SolFitsPigmentExp %>% 
  filter(Strain == "PC-rich_056" | Strain == "PC-rich_077") 
SolFitsAllPigmentPC$StrainGroup = "PC-rich"
SolFitsAllPigmentPE<-SolFitsPigmentExp %>% 
  filter(Strain == "PE-rich_048" | Strain == "PE-rich_127")  
SolFitsAllPigmentPE$StrainGroup = "PE-rich"

SolFitsAllPigmentPCPE<-rbind(SolFitsAllPigmentPC, SolFitsAllPigmentPE)
rm(SolFitsAllPigmentPC, SolFitsAllPigmentPE)


# SolFitsAllPigmentPC1s<-SolFitsPigmentExp1s %>% 
#   filter(Strain == "PC-rich_056" | Strain == "PC-rich_077") 
# SolFitsAllPigmentPC1s$StrainGroup = "PC-rich"
# SolFitsAllPigmentPE1s<-SolFitsPigmentExp1s %>% 
#   filter(Strain == "PE-rich_048" | Strain == "PE-rich_127")  
# SolFitsAllPigmentPE1s$StrainGroup = "PE-rich"
#   
# SolFitsAllPigmentPCPE1s<-rbind(SolFitsAllPigmentPC1s, SolFitsAllPigmentPE1s)

#rm(SolFitsAllPigmentPC1s, SolFitsAllPigmentPE1s)
```

# Filtering data measured from log and very early exponential phase of growth

```{r filtering data from log phase}
SolFitsAllPigmentPCPE<-SolFitsAllPigmentPCPE %>%
  filter(E_days>=2) 

# SolFitsAllPigmentPCPE1s<-SolFitsAllPigmentPCPE1s %>%
#   filter(E_days>=2) 
```



# Linear fit per par_ue

```{r linear fit}

SolFitsAllPigmentfitPhycoChlalinear <- SolFitsAllPigmentPCPE %>%   
  drop_na(Par_ue, Ex_WL, Phase, meanSig_nm2psii, AllmeanPhycoChlaRatio) %>% 
  select(c(Strain, Par_ue, Photoperiod, Ex_WL, meanSig_nm2psii, AllmeanPhycoChlaRatio, O2, WL, Phase)) %>%  
  nest(data = -c("Par_ue", "Ex_WL", "Phase")) %>%   
  mutate(Linear_Model = map(data, ~lm(meanSig_nm2psii ~ AllmeanPhycoChlaRatio, data = .x))) %>%     
  mutate(Linear_Model_Param = map(Linear_Model, tidy),          
         Linear_Model_Predict = map(Linear_Model, possibly(augment)),          
         Linear_Model_Glance = map(Linear_Model, possibly(glance)))


SolFitsAllPigmentfitPhycoChlalineardark <- SolFitsAllPigmentPCPE %>%  
    drop_na(Par_ue, Ex_WL, Phase, meanSig_nm2psii, AllmeanPhycoChlaRatio) %>% 
  select(c(Strain, Par_ue, Photoperiod, Ex_WL, meanSigdark_nm2psii, AllmeanPhycoChlaRatio, O2, WL, Phase)) %>%  
  nest(data = -c("Par_ue", "Ex_WL", "Phase")) %>%   
  mutate(Linear_Model = map(data, ~lm(meanSigdark_nm2psii ~ AllmeanPhycoChlaRatio, data = .x))) %>%     
  mutate(Linear_Model_Param = map(Linear_Model, tidy),          
         Linear_Model_Predict = map(Linear_Model, possibly(augment)),          
         Linear_Model_Glance = map(Linear_Model, possibly(glance)))


# SolFitsAllPigmentfitPhycoChlalinear1s <- SolFitsAllPigmentPCPE1s %>%  
#     drop_na(Par_ue, Ex_WL, Phase, meanSig1s_nm2psii, AllmeanPhycoChlaRatio) %>% 
#   select(c(Strain, Par_ue, Photoperiod, Ex_WL, meanSig1s_nm2psii, AllmeanPhycoChlaRatio, O2, WL, Phase)) %>% 
#   nest(data = -c("Par_ue", "Ex_WL", "Phase")) %>%   
#   mutate(Linear_Model = map(data, ~lm(meanSig1s_nm2psii ~ AllmeanPhycoChlaRatio, data = .x))) %>%     
#   mutate(Linear_Model_Param = map(Linear_Model, tidy),          
#          Linear_Model_Predict = map(Linear_Model, possibly(augment)),          
#          Linear_Model_Glance = map(Linear_Model, possibly(glance)))
# 
# 
# SolFitsAllPigmentfitPhycoChlalinearPCPE1s <- SolFitsAllPigmentPCPE1s %>%   
#     drop_na(Par_ue, Ex_WL, Phase, meanSig1s_nm2psii, AllmeanPhycoChlaRatio) %>% 
#   select(c(StrainGroup, Par_ue, Photoperiod, Ex_WL, meanSig1s_nm2psii, AllmeanPhycoChlaRatio, O2, WL, Phase)) %>%  
#   nest(data = -c("Par_ue", "Ex_WL", "StrainGroup", "Phase")) %>%  
#   mutate(Linear_Model = map(data, ~lm(meanSig1s_nm2psii ~ AllmeanPhycoChlaRatio, data = .x))) %>%    
#   mutate(Linear_Model_Param = map(Linear_Model, tidy),          
#          Linear_Model_Predict = map(Linear_Model, possibly(augment)),          
#          Linear_Model_Glance = map(Linear_Model, possibly(glance)))
```

# Create preliminary plot

```{r preliminary plot}

lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))

SolFitsAllPigmentfitPhycoChlalinear %>% 
  unnest(Linear_Model_Predict) %>% 
  ggplot() +
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = meanSig_nm2psii, colour=as.factor(Strain)), size = 3.5, show.legend = T, SolFitsAllPigmentPCPE) + 
  geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = meanSig_nm2psii - sdSig_nm2psii, ymax = meanSig_nm2psii + sdSig_nm2psii, colour=as.factor(Strain)), SolFitsAllPigmentPCPE) +
  geom_line(aes(x = AllmeanPhycoChlaRatio, y = `.fitted`), show.legend = F) +   
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  #labs(y=expression(paste(sigma,""["PSII"]*"'(nm"^"2"*")")), x = "Total phycobilins/Chl" ~italic(a)~ "ratio") +
  ggh4x::facet_nested(cols = vars(Ex_WL, Phase), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() 


SolFitsAllPigmentfitPhycoChlalineardark %>% 
  unnest(Linear_Model_Predict) %>% 
  ggplot() +
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = meanSigdark_nm2psii, colour=as.factor(Strain)), size = 3.5, show.legend = T, SolFitsAllPigmentPCPE) + 
  geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = meanSigdark_nm2psii - sdSigdark_nm2psii, ymax = meanSigdark_nm2psii + sdSigdark_nm2psii, colour=as.factor(Strain)), SolFitsAllPigmentPCPE) +
  geom_line(aes(x = AllmeanPhycoChlaRatio, y = `.fitted`), show.legend = F) + 
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  ggh4x::facet_nested(cols = vars(Ex_WL, Phase), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() 


# SolFitsAllPigmentfitPhycoChlalinear1s %>% 
#   unnest(Linear_Model_Predict) %>% 
#   ggplot() +
#   geom_point(aes(x = AllmeanPhycoChlaRatio, y = meanSig1s_nm2psii, colour=as.factor(Strain)), size = 3.5, show.legend = T, SolFitsAllPigmentPCPE1s) + 
#   geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = meanSig1s_nm2psii - sdSig1s_nm2psii, ymax = meanSig1s_nm2psii + sdSig1s_nm2psii, colour=as.factor(Strain)), SolFitsAllPigmentPCPE1s) +
#   geom_line(aes(x = AllmeanPhycoChlaRatio, y = `.fitted`), show.legend = F) + 
#   scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
#   ggh4x::facet_nested(cols = vars(Ex_WL, Phase), rows = vars(Par_ue), labeller = label_parsed) +
#   theme_bw()
```


# Linear fit per Strain

```{r linear fit}
SolFitsAllPigmentfitPhycoChlalinearStrain <- SolFitsAllPigmentPCPE %>%  
  select(c(Strain, Par_ue, Photoperiod, Ex_WL, meanSig_nm2psii, AllmeanPhycoChlaRatio, O2, WL, Phase, facetsExcitation, facetsStrain, facetsPhase)) %>%  
  nest(data = -c("Strain", "Ex_WL", "Phase", "facetsPhase", "facetsStrain")) %>%  
  mutate(Linear_Model = map(data, ~lm(meanSig_nm2psii ~ AllmeanPhycoChlaRatio, data = .x))) %>%    
  mutate(Linear_Model_Param = map(Linear_Model, tidy),          
         Linear_Model_Predict = map(Linear_Model, possibly(augment)),          
         Linear_Model_Glance = map(Linear_Model, possibly(glance)))


SolFitsAllPigmentfitPhycoChlalineardarkStrain <- SolFitsAllPigmentPCPE %>%   
  select(c(Strain, Par_ue, Photoperiod, Ex_WL, meanSigdark_nm2psii, AllmeanPhycoChlaRatio, O2, WL, Phase, facetsExcitation, facetsStrain, facetsPhase)) %>%  
  nest(data = -c("Strain", "Ex_WL", "Phase", "facetsPhase", "facetsStrain")) %>% 
  mutate(Linear_Model = map(data, ~lm(meanSigdark_nm2psii ~ AllmeanPhycoChlaRatio, data = .x))) %>%     
  mutate(Linear_Model_Param = map(Linear_Model, tidy),          
         Linear_Model_Predict = map(Linear_Model, possibly(augment)),          
         Linear_Model_Glance = map(Linear_Model, possibly(glance)))


# SolFitsAllPigmentfitPhycoChlalinearStrain1s <- SolFitsAllPigmentPCPE1s %>%  
#   select(c(Strain, Par_ue, Photoperiod, Ex_WL, meanSig1s_nm2psii, AllmeanPhycoChlaRatio, O2, WL, Phase)) %>%  
#   nest(data = -c("Strain", "Ex_WL", "Phase")) %>% 
#   mutate(Linear_Model = map(data, ~lm(meanSig1s_nm2psii ~ AllmeanPhycoChlaRatio, data = .x))) %>%    
#   mutate(Linear_Model_Param = map(Linear_Model, tidy),          
#          Linear_Model_Predict = map(Linear_Model, possibly(augment)),          
#          Linear_Model_Glance = map(Linear_Model, possibly(glance)))

```



# Create preliminary plot

```{r preliminary plot}
lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))

SolFitsAllPigmentfitPhycoChlalinearStrain %>% 
  unnest(Linear_Model_Predict) %>% 
  ggplot() +
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = meanSig_nm2psii, colour=as.factor(Strain)), size = 3.5, show.legend = T, SolFitsAllPigmentPCPE) + 
  geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = meanSig_nm2psii - sdSig_nm2psii, ymax = meanSig_nm2psii + sdSig_nm2psii, colour=as.factor(Strain)), SolFitsAllPigmentPCPE) +
  geom_line(aes(x = AllmeanPhycoChlaRatio, y = `.fitted`), show.legend = F) +   
  # scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab1) +
  # scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1"), name="", labels = lab2) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  ggh4x::facet_nested(cols = vars(Ex_WL, Phase), rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 


SolFitsAllPigmentfitPhycoChlalineardarkStrain %>% 
  unnest(Linear_Model_Predict) %>% 
  ggplot() +
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = meanSigdark_nm2psii, colour=as.factor(Strain)), size = 3.5, show.legend = T, SolFitsAllPigmentPCPE) + 
  geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = meanSigdark_nm2psii - sdSigdark_nm2psii, ymax = meanSigdark_nm2psii + sdSigdark_nm2psii, colour=as.factor(Strain)), SolFitsAllPigmentPCPE) +
  geom_line(aes(x = AllmeanPhycoChlaRatio, y = `.fitted`), show.legend = F) + 
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  ggh4x::facet_nested(cols = vars(Ex_WL, facetsPhase, Phase), rows = vars(facetsStrain, Strain),labeller = label_parsed) +
  theme_bw() 
  
  
# SolFitsAllPigmentfitPhycoChlalinearStrain1s %>% 
#   unnest(Linear_Model_Predict) %>% 
#   ggplot() +
#   geom_point(aes(x = AllmeanPhycoChlaRatio, y = meanSig1s_nm2psii, colour=as.factor(Strain)), size = 3.5, show.legend = T, SolFitsAllPigmentPCPE1s) + 
#   geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = meanSig1s_nm2psii - sdSig1s_nm2psii, ymax = meanSig1s_nm2psii + sdSig1s_nm2psii, colour=as.factor(Strain)), SolFitsAllPigmentPCPE1s) +
#   geom_line(aes(x = AllmeanPhycoChlaRatio, y = `.fitted`), show.legend = F) +   
#   scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
#   ggh4x::facet_nested(cols = vars(Ex_WL, Phase), rows = vars(Strain), labeller = label_parsed) +
#   theme_bw() 
```


```{r unnest, preparing df to preparing final plot, echo=FALSE, warning = FALSE}
augmented590pigment<-SolFitsAllPigmentfitPhycoChlalinearStrain  %>%
  unnest(Linear_Model_Predict) %>%
  select(c(Strain, Ex_WL, meanSig_nm2psii, AllmeanPhycoChlaRatio, Phase, .fitted, facetsPhase, facetsStrain)) %>% 
  filter(Ex_WL == 590)

SolFitsAllPigmentPCPE590<-SolFitsAllPigmentPCPE %>% 
filter(Ex_WL == 590) 
#SolFitsAllPigmentPCPE590$facetsStrain <- 'Strain'
# SolFitsAllPigmentPCPE590$facetsPhase <- "Phase~of~growth"
```


```{r fig.height = 8, fig.width = 8, warning = FALSE}
# WL.labs <- c("Excitation (nm)")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Strain")
# names(O2.labs) <- c(21)
# data_text_AnovaExp<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"),  label = c(' ANOVA, \u03B1 = 0.05, ab', 'ANOVA, \u03B1 = 0.05, a', 'ANOVA, \u03B1 = 0.05, b', 'ANOVA, \u03B1 = 0.05, c'))
# data_text_AnovaSt<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"),  label = c('ANOVA, \u03B1 = 0.05, a', 'ANOVA, \u03B1 = 0.05, a', 'ANOVA, \u03B1 = 0.05, b', ' ANOVA, \u03B1 = 0.05, ab'))

data_text_AnovaExp56<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('ab'))
data_text_AnovaExp77<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("a"))
data_text_AnovaExp48<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("b"))
data_text_AnovaExp127<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("c"))

data_text_AnovaSt56<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('a'))
data_text_AnovaSt77<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("a"))
data_text_AnovaSt48<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("b"))
data_text_AnovaSt127<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("ab"))


data_text_AnovaExp56P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('A'))
data_text_AnovaExp77P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("A"))
data_text_AnovaExp48P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("A"))
data_text_AnovaExp127P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("A"))

data_text_AnovaSt56P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('B'))
data_text_AnovaSt77P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("B"))
data_text_AnovaSt48P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("A"))
data_text_AnovaSt127P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("A"))

data_text_AnovaPhase<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"),  label = c(' , \u03B1 = 0.05', ' , \u03B1 = 0.05', ' , \u03B1 = 0.05', ' , \u03B1 = 0.05'))
data_text_AnovaPhase2<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"),  label = c('italic(t)~-test', 'italic(t)~-test', 'italic(t)~-test', 'italic(t)~-test'))

scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))

  
SolFitsAllPigmentPCPE590 %>% 
  ggplot() +
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = AllmeanSig_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.8, show.legend = T, SolFitsAllPigmentPCPE590) + 
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = Sig_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 1, show.legend = F, SolFitsAllPigmentPCPE590) + 
  # geom_point(aes(x = PhycoChlaRatio, y = AllmeanSig_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 1, show.legend = F, SolFitsAllPigmentPCPE590) + 
  geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = AllmeanSig_nm2psii - AllsdSig_nm2psii, ymax = AllmeanSig_nm2psii + AllsdSig_nm2psii, colour = as.factor(Par_ue)), show.legend = F, width=0, size=0.3, SolFitsAllPigmentPCPE590) +
  # geom_errorbar(aes(y = AllmeanSig_nm2psii, xmin = AllmeanPhycoChlaRatio - AllsdPhycoChlaRatio, xmax = AllmeanPhycoChlaRatio + AllsdPhycoChlaRatio, colour = as.factor(Par_ue)), show.legend = F, width=0, size=0.3, SolFitsAllPigmentPCPE590) +
  geom_line(aes(x = AllmeanPhycoChlaRatio, y = `.fitted`), colour = "blue", linetype = "solid", size = 0.3, show.legend = F, augmented590pigment) +   
  
  geom_text(data=data_text_AnovaExp56, aes(x=3, y=8, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp77, aes(x=3.8, y=7.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp48, aes(x=4.8, y=9.3, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp127, aes(x=4.5, y=9, label=label), colour = "blue", size=4) +
    
  geom_text(data=data_text_AnovaSt56, aes(x=2.3, y=6.0, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt77, aes(x=3.5, y=6.9, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt48, aes(x=3.1, y=7.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt127, aes(x=3.7, y=7, label=label), colour = "blue", size=4) +
    
  geom_text(data=data_text_AnovaExp56P, aes(x=3, y=4, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp77P, aes(x=3.8, y=2.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp48P, aes(x=4.8, y=5.3, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp127P, aes(x=4.5, y=4, label=label), colour = "blue", size=4) +
    
  geom_text(data=data_text_AnovaSt56P, aes(x=2.3, y=1.0, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt77P, aes(x=3.5, y=2.9, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt48P, aes(x=3.1, y=2.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt127P, aes(x=3.7, y=3, label=label), colour = "blue", size=4) +
  
  geom_text(data=data_text_AnovaPhase, aes(x=1.7, y=-0.2, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaPhase2, aes(x=0.5, y=-0.2, label=label), colour = "blue", size=4, parse = TRUE) +
  
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2) +
  scale_x_continuous(breaks=seq(0, 5, by = 1)) +
  scale_y_continuous(breaks=seq(0, 10, by = 2)) +
  coord_cartesian(xlim = c(0, 5.5), ylim = c(-2, 12)) +
  
  labs(y=expression(paste(sigma,""["PSII"]*"' (nm"^"2"*" quanta"^"-1"*")")), x = "Phycobiliprotein to Chl" ~italic(a)~ "ratio (µg:µg)") +
  ggh4x::facet_nested(cols = vars(facetsPhase, Phase), rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.9,0.88),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        legend.title = element_blank(),
        legend.text = element_text(size=11))

```

# Save plot 

```{r save plot}
ggsave(file = file.path(FigPath, paste("Fig_SigmaPig590",".png",sep = "")), height=9, width= 7,  dpi = 300, limitsize = TRUE)
```

# Pot B for marging

```{r fig.height = 8, fig.width = 8, warning = FALSE}
data_textB <- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain  = c("Strain"), Strain  = c("PC-rich_056"), label = c('B'))

k_data056 = data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain  = c("Strain"), Strain  = c("PC-rich_056"))
k_data077 = data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain  = c("Strain"), Strain  = c("PC-rich_077"))
k_data048 = data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain  = c("Strain"), Strain  = c("PE-rich_048"))
k_data127 = data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain  = c("Strain"), Strain  = c("PE-rich_127"))


data_text_AnovaExp56<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('ab'))
data_text_AnovaExp77<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("a"))
data_text_AnovaExp48<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("b"))
data_text_AnovaExp127<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("c"))

data_text_AnovaSt56<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('a'))
data_text_AnovaSt77<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("a"))
data_text_AnovaSt48<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("b"))
data_text_AnovaSt127<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("ab"))


data_text_AnovaExp56P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('A'))
data_text_AnovaExp77P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("A"))
data_text_AnovaExp48P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("A"))
data_text_AnovaExp127P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("A"))

data_text_AnovaSt56P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('B'))
data_text_AnovaSt77P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("B"))
data_text_AnovaSt48P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("A"))
data_text_AnovaSt127P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("A"))

data_text_AnovaPhase<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"),  label = c(' , \u03B1 = 0.05', ' , \u03B1 = 0.05', ' , \u03B1 = 0.05', ' , \u03B1 = 0.05'))
data_text_AnovaPhase2<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"),  label = c('italic(t)~-test~","~α~"="~0.05', 'italic(t)~-test~","~α~"="~0.05', 'italic(t)~-test~","~α~"="~0.05', 'italic(t)~-test~","~α~"="~0.05'))

scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))

  
Soli590B<-SolFitsAllPigmentPCPE590 %>% 
  ggplot() +
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = AllmeanSig_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.8, show.legend = T, SolFitsAllPigmentPCPE590) + 
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = Sig_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 1, show.legend = F, SolFitsAllPigmentPCPE590) + 
  # geom_point(aes(x = PhycoChlaRatio, y = AllmeanSig_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 1, show.legend = F, SolFitsAllPigmentPCPE590) + 
  geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = AllmeanSig_nm2psii - AllsdSig_nm2psii, ymax = AllmeanSig_nm2psii + AllsdSig_nm2psii, colour = as.factor(Par_ue)), show.legend = F, width=0, size=0.3, SolFitsAllPigmentPCPE590) +
  # geom_errorbar(aes(y = AllmeanSig_nm2psii, xmin = AllmeanPhycoChlaRatio - AllsdPhycoChlaRatio, xmax = AllmeanPhycoChlaRatio + AllsdPhycoChlaRatio, colour = as.factor(Par_ue)), show.legend = F, width=0, size=0.3, SolFitsAllPigmentPCPE590) +
  geom_line(aes(x = AllmeanPhycoChlaRatio, y = `.fitted`), colour = "blue", linetype = "solid", size = 0.3, show.legend = F, augmented590pigment) +   
  
  geom_text(data=data_text_AnovaExp56, aes(x=3, y=8, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp77, aes(x=3.8, y=7.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp48, aes(x=4.8, y=9.3, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp127, aes(x=4.5, y=9, label=label), colour = "blue", size=4) +
    
  geom_text(data=data_text_AnovaSt56, aes(x=2.3, y=6.0, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt77, aes(x=3.5, y=6.9, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt48, aes(x=3.1, y=7.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt127, aes(x=3.7, y=7, label=label), colour = "blue", size=4) +
    
  geom_text(data=data_text_AnovaExp56P, aes(x=3, y=4, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp77P, aes(x=3.8, y=2.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp48P, aes(x=4.8, y=5.3, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp127P, aes(x=4.5, y=4, label=label), colour = "blue", size=4) +
    
  geom_text(data=data_text_AnovaSt56P, aes(x=2.3, y=1.0, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt77P, aes(x=3.5, y=2.9, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt48P, aes(x=3.1, y=2.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt127P, aes(x=3.7, y=3, label=label), colour = "blue", size=4) +
  
  #geom_text(data=data_text_AnovaPhase, aes(x=1.8, y=-0.2, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaPhase2, aes(x=1.5, y=-0.8, label=label), colour = "blue", size=4, parse = TRUE) +
  geom_text(data=data_textB, aes(x=0.5, y=10, label=label), size=6) +
  
  geom_segment(data = k_data056, aes(x =5, y = -Inf, xend = 5, yend = Inf), color = "seagreen4", size = 6, alpha = 0.7) +
  geom_segment(data = k_data077, aes(x =5, y = -Inf, xend = 5, yend = Inf), color = "palegreen3", size = 6, alpha = 0.7) +
  geom_segment(data = k_data048, aes(x =5, y = -Inf, xend = 5, yend = Inf), color = "brown1", size = 6, alpha = 0.7) +
  geom_segment(data = k_data127, aes(x =5, y = -Inf, xend = 5, yend = Inf), color = "brown4", size = 6, alpha = 0.7) +
  
  
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2) +
  scale_x_continuous(breaks=seq(0, 5, by = 1)) +
  scale_y_continuous(breaks=seq(0, 10, by = 2)) +
  coord_cartesian(xlim = c(0, 5), ylim = c(-2, 12)) +
  
  labs(y=expression(paste(sigma,""["PSII"]*"' (nm"^"2"*" quanta"^"-1"*")")), x = "Phycobiliprotein to Chl" ~italic(a)~ "ratio (µg:µg)") +
  ggh4x::facet_nested(cols = vars(facetsPhase, Phase), rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(vjust = -1), 
        #axis.text.x = element_text(margin=margin(t = 0, r = 0, b = 20, l = 0)),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        # axis.title.y = element_text(margin=margin(r=10)),
        axis.title.y = element_blank(),
        axis.title.x = element_text(margin=margin(t = 10, r = 0, b = 0, l = 0)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.85,0.88),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        legend.title = element_blank(),
        legend.text = element_text(size=11))
Soli590B

# g <- ggplot_gtable(ggplot_build(Soli590B))
# stripr <- which(grepl('strip-r', g$layout$name))
# fills <- c("white","seagreen4","palegreen3","brown1", "brown4")
# k <- 1
# for (i in stripr) {
# j <- which(grepl('rect', g$grobs[[i]]$grobs[[1]]$childrenOrder))
# g$grobs[[i]]$grobs[[1]]$children[[j]]$gp$fill <- fills[k]
# k <- k+1
# }
# grid.draw(g)
```

```{r, warning = FALSE, fig.height = 9, fig.width = 12}
# ggp<- Soli590A+Soli590B
# ggp                           
```


```{r save plot}
# ggsave(file = file.path(FigPath, paste("Fig_Sigma590Merge",".png",sep = "")), height=9, width= 12,  dpi = 300, limitsize = TRUE)
```


















# Calculated Anova and Tukey test from data points

```{r calculated statistics}
SigFit590Stats <-SolFitsAllPigmentPCPE %>% 
  filter(Ex_WL == 590) 

SigFit590Stats$Par_ue <- factor(SigFit590Stats$Par_ue)
SigFit590Stats$Photoperiod <- factor(SigFit590Stats$Photoperiod)
SigFit590Stats$Strain <- factor(SigFit590Stats$Strain)
SigFit590Stats$Phase <- factor(SigFit590Stats$Phase)
#SigFit590Stats$AllmeanPhycoChlaRatio <- factor(SigFit590Stats$AllmeanPhycoChlaRatio)

# Three way Anova with interactions
model<-aov(Sig_nm2psii~AllmeanPhycoChlaRatio*Phase*Strain, data=SigFit590Stats)
Anova_SigPig590<-data.frame(unclass(summary(model)), check.names = FALSE, stringsAsFactors = FALSE)
#TukeyHSDTest_SigPig<-TukeyHSD(model, which = c("AllmeanPhycoChlaRatio", "Phase", "Strain"))
```

# Save RDS that create stats and tables

```{r}
saveRDS(Anova_SigPig590, file.path(TableRdsPath, paste(Project, "Anova_SigPig590.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)
```

# Anova from the linear model 
https://stackoverflow.com/questions/24527116/write-regression-summary-to-the-csv-file-in-r

t-test from the linear model Exp
```{r}
# Exp
Stats56_77Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_056" | Strain == "PC-rich_077") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=Stats56_77Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_77Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_77Exp$FitComparison <- '056_077_Exp'

SolFits56_48Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_056" | Strain == "PE-rich_048") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits56_48Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_48Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_48Exp$FitComparison <- '056_048_Exp'

SolFits56_127Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_056" | Strain == "PE-rich_127")  
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits56_127Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_127Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_127Exp$FitComparison <- '056_127_Exp'

SolFits48_127Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PE-rich_048" | Strain == "PE-rich_127")  
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits48_127Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_48_127Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_48_127Exp$FitComparison <- '048_127_Exp'

SolFits77_48Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_077" | Strain == "PE-rich_048") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits77_48Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77_48Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77_48Exp$FitComparison <- '077_048_Exp'

SolFits77_127Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_077" | Strain == "PE-rich_127") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits77_127Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77_127Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77_127Exp$FitComparison <- '077_127_Exp'

modelExp<-rbind(model_56_77Exp, model_56_48Exp, model_56_127Exp, model_48_127Exp, model_77_48Exp, model_77_127Exp)
  rm(model_56_77Exp, model_56_48Exp, model_56_127Exp, model_48_127Exp, model_77_48Exp, model_77_127Exp)
```

t-test from the linear model St
```{r}
# Exp
Stats56_77St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_056" | Strain == "PC-rich_077") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=Stats56_77St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_77St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_77St$FitComparison <- '056_077_St'

SolFits56_48St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_056" | Strain == "PE-rich_048") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits56_48St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_48St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_48St$FitComparison <- '056_048_St'

SolFits56_127St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_056" | Strain == "PE-rich_127")  
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits56_127St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_127St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_127St$FitComparison <- '056_127_St'

SolFits48_127St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PE-rich_048" | Strain == "PE-rich_127")  
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits48_127St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_48_127St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_48_127St$FitComparison <- '048_127_St'

SolFits77_48St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_077" | Strain == "PE-rich_048") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits77_48St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77_48St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77_48St$FitComparison <- '077_048_St'

SolFits77_127St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_077" | Strain == "PE-rich_127") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits77_127St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77_127St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77_127St$FitComparison <- '077_127_St'

modelSt<-rbind(model_56_77St, model_56_48St, model_56_127St, model_48_127St, model_77_48St, model_77_127St)
  rm(model_56_77St, model_56_48St, model_56_127St, model_48_127St, model_77_48St, model_77_127St)
```

t-test from the linear model Phase
```{r}
# Exp
Stats56_ExpSt<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential" | Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_056") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Phase + AllmeanPhycoChlaRatio:Phase,data=Stats56_ExpSt)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56ExpSt<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56ExpSt$FitComparison <- '056_Exp_St'

Stats77_ExpSt<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential" | Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_077") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Phase + AllmeanPhycoChlaRatio:Phase,data=Stats77_ExpSt)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77ExpSt<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77ExpSt$FitComparison <- '077_Exp_St'

Stats48_ExpSt<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential" | Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PE-rich_048") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Phase + AllmeanPhycoChlaRatio:Phase,data=Stats48_ExpSt)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_48ExpSt<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_48ExpSt$FitComparison <- '048_Exp_St'

Stats127_ExpSt<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential" | Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PE-rich_127") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Phase + AllmeanPhycoChlaRatio:Phase,data=Stats127_ExpSt)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_127ExpSt<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_127ExpSt$FitComparison <- '127_Exp_St'


modelExpSt<-rbind(model_56ExpSt, model_77ExpSt, model_48ExpSt, model_127ExpSt)
  rm(model_56ExpSt, model_77ExpSt, model_48ExpSt, model_127ExpSt)
```

# Merge statistic
```{r}
Anova_SigPig590_Model<-rbind(modelExp, modelSt, modelExpSt)
rm(modelExp, modelSt, modelExpSt)
```


# Save RDS that create stats and tables

```{r}
saveRDS(Anova_SigPig590_Model, file.path(TableRdsPath, paste(Project, "Anova_SigPig590_Model.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)
```





```{r unnest, preparing df to preparing final plot, echo=FALSE, warning = FALSE}
augmented445pigment<-SolFitsAllPigmentfitPhycoChlalinearStrain  %>%
  unnest(Linear_Model_Predict) %>%
  select(c(Strain, Ex_WL, meanSig_nm2psii, AllmeanPhycoChlaRatio, Phase, .fitted, facetsPhase, facetsStrain)) %>% 
  filter(Ex_WL == 445)

SolFitsAllPigmentPCPE445<-SolFitsAllPigmentPCPE %>% 
filter(Ex_WL == 445) 
#SolFitsAllPigmentPCPE590$facetsStrain <- 'Strain'
# SolFitsAllPigmentPCPE590$facetsPhase <- "Phase~of~growth"
```


```{r fig.height = 8, fig.width = 8, warning = FALSE}

data_textB <- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain  = c("Strain"), Strain  = c("PC-rich_056"), label = c('B'))

k_data056 = data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain  = c("Strain"), Strain  = c("PC-rich_056"))
k_data077 = data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain  = c("Strain"), Strain  = c("PC-rich_077"))
k_data048 = data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain  = c("Strain"), Strain  = c("PE-rich_048"))
k_data127 = data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain  = c("Strain"), Strain  = c("PE-rich_127"))

# WL.labs <- c("Excitation (nm)")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Strain")
# names(O2.labs) <- c(21)

data_text_AnovaExp56<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('a'))
data_text_AnovaExp77<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("a"))
data_text_AnovaExp48<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("b"))
data_text_AnovaExp127<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("c"))

data_text_AnovaSt56<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('a'))
data_text_AnovaSt77<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("b"))
data_text_AnovaSt48<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("b"))
data_text_AnovaSt127<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("b"))


data_text_AnovaExp56P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('A'))
data_text_AnovaExp77P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("A"))
data_text_AnovaExp48P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("A"))
data_text_AnovaExp127P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("A"))

data_text_AnovaSt56P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('B'))
data_text_AnovaSt77P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("B"))
data_text_AnovaSt48P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("B"))
data_text_AnovaSt127P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("A"))

data_text_AnovaPhase<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"),  label = c(' , \u03B1 = 0.05', ' , \u03B1 = 0.05', ' , \u03B1 = 0.05', ' , \u03B1 = 0.05'))
data_text_AnovaPhase2<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"),  label = c('italic(t)~-test', 'italic(t)~-test', 'italic(t)~-test', 'italic(t)~-test'))

scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))

  
SoliPigSupB<-SolFitsAllPigmentPCPE445 %>% 
  ggplot() +
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = AllmeanSig_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.8, show.legend = T, SolFitsAllPigmentPCPE445) + 
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = Sig_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 1, show.legend = F, SolFitsAllPigmentPCPE445) + 
  geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = AllmeanSig_nm2psii - AllsdSig_nm2psii, ymax = AllmeanSig_nm2psii + AllsdSig_nm2psii, colour = as.factor(Par_ue)), show.legend = F, width=0, size=0.3, SolFitsAllPigmentPCPE445) +
  geom_line(aes(x = AllmeanPhycoChlaRatio, y = `.fitted`), colour = "blue", linetype = "solid", size = 0.3, show.legend = F, augmented445pigment) +   
  
  geom_text(data=data_text_AnovaExp56, aes(x=3, y=3, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp77, aes(x=3.8, y=3, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp48, aes(x=4.8, y=3, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp127, aes(x=4.5, y=3, label=label), colour = "blue", size=4) +
    
  geom_text(data=data_text_AnovaSt56, aes(x=2.3, y=2.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt77, aes(x=3.5, y=2.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt48, aes(x=3.3, y=2.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt127, aes(x=3.7, y=2.5, label=label), colour = "blue", size=4) +
    
  geom_text(data=data_text_AnovaExp56P, aes(x=3, y=-0.2, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp77P, aes(x=3.8, y=0, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp48P, aes(x=4.8, y=0, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp127P, aes(x=4.5, y=0, label=label), colour = "blue", size=4) +
    
  geom_text(data=data_text_AnovaSt56P, aes(x=2.3, y=-0.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt77P, aes(x=3.5, y=-0.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt48P, aes(x=3.3, y=-0.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt127P, aes(x=3.7, y=-0.5, label=label), colour = "blue", size=4) +
  
  geom_text(data=data_text_AnovaPhase, aes(x=1.7, y=-0.4, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaPhase2, aes(x=0.5, y=-0.4, label=label), colour = "blue", size=4, parse = TRUE) +
  
  geom_text(data=data_textB, aes(x=0.5, y=10, label=label), size=6) +
  
  geom_segment(data = k_data056, aes(x =5, y = -Inf, xend = 5, yend = Inf), color = "seagreen4", size = 6, alpha = 0.7) +
  geom_segment(data = k_data077, aes(x =5, y = -Inf, xend = 5, yend = Inf), color = "palegreen3", size = 6, alpha = 0.7) +
  geom_segment(data = k_data048, aes(x =5, y = -Inf, xend = 5, yend = Inf), color = "brown1", size = 6, alpha = 0.7) +
  geom_segment(data = k_data127, aes(x =5, y = -Inf, xend = 5, yend = Inf), color = "brown4", size = 6, alpha = 0.7) +
  
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2) +
  scale_x_continuous(breaks=seq(0, 5, by = 1)) +
  scale_y_continuous(breaks=seq(0, 10, by = 2)) +
  coord_cartesian(xlim = c(0, 5), ylim = c(-2, 12)) +
  labs(y=expression(paste(sigma,""["PSII"]*"' (nm"^"2"*" quanta"^"-1"*")")), x = "Phycobiliprotein to Chl" ~italic(a)~ "ratio (µg:µg)") +
  ggh4x::facet_nested(cols = vars(facetsPhase, Phase), rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.85,0.88),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        legend.title = element_blank(),
        legend.text = element_text(size=11))
SoliPigSupB
```


# Save plot 

```{r save plot}
# ggsave(file = file.path(FigPath, paste("SFig_SigmaPig445",".png",sep = "")), height=9, width= 7,  dpi = 300, limitsize = TRUE)
```

# Calculated Anova and Tukey test from data points

```{r calculated statistics}
SigFit445Stats <-SolFitsAllPigmentPCPE %>% 
  filter(Ex_WL == 445) 

SigFit445Stats$Par_ue <- factor(SigFit445Stats$Par_ue)
SigFit445Stats$Photoperiod <- factor(SigFit445Stats$Photoperiod)
SigFit445Stats$Strain <- factor(SigFit445Stats$Strain)
SigFit445Stats$Phase <- factor(SigFit445Stats$Phase)
#SigFit445Stats$AllmeanPhycoChlaRatio <- factor(SigFit445Stats$AllmeanPhycoChlaRatio)

# Three way Anova with interactions
model<-aov(Sig_nm2psii~AllmeanPhycoChlaRatio*Phase*Strain, data=SigFit445Stats)
Anova_SigPig445<-data.frame(unclass(summary(model)), check.names = FALSE, stringsAsFactors = FALSE)
#TukeyHSDTest_SigPig<-TukeyHSD(model, which = c("AllmeanPhycoChlaRatio", "Phase", "Strain"))
```

# Save RDS that create stats and tables

```{r}
saveRDS(Anova_SigPig445, file.path(TableRdsPath, paste(Project, "Anova_SigPig445.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)
```

# Anova from the linear model 
https://stackoverflow.com/questions/24527116/write-regression-summary-to-the-csv-file-in-r

t-test from the linear model Exp
```{r}
# Exp
Stats56_77Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PC-rich_056" | Strain == "PC-rich_077") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=Stats56_77Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_77Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_77Exp$FitComparison <- '056_077_Exp'

SolFits56_48Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PC-rich_056" | Strain == "PE-rich_048") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits56_48Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_48Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_48Exp$FitComparison <- '056_048_Exp'

SolFits56_127Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PC-rich_056" | Strain == "PE-rich_127")  
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits56_127Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_127Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_127Exp$FitComparison <- '056_127_Exp'

SolFits48_127Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PE-rich_048" | Strain == "PE-rich_127")  
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits48_127Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_48_127Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_48_127Exp$FitComparison <- '048_127_Exp'

SolFits77_48Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PC-rich_077" | Strain == "PE-rich_048") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits77_48Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77_48Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77_48Exp$FitComparison <- '077_048_Exp'

SolFits77_127Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PC-rich_077" | Strain == "PE-rich_127") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits77_127Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77_127Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77_127Exp$FitComparison <- '077_127_Exp'

modelExp<-rbind(model_56_77Exp, model_56_48Exp, model_56_127Exp, model_48_127Exp, model_77_48Exp, model_77_127Exp)
  rm(model_56_77Exp, model_56_48Exp, model_56_127Exp, model_48_127Exp, model_77_48Exp, model_77_127Exp)
```

t-test from the linear model St
```{r}
# Exp
Stats56_77St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PC-rich_056" | Strain == "PC-rich_077") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=Stats56_77St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_77St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_77St$FitComparison <- '056_077_St'

SolFits56_48St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PC-rich_056" | Strain == "PE-rich_048") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits56_48St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_48St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_48St$FitComparison <- '056_048_St'

SolFits56_127St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PC-rich_056" | Strain == "PE-rich_127")  
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits56_127St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_127St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_127St$FitComparison <- '056_127_St'

SolFits48_127St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PE-rich_048" | Strain == "PE-rich_127")  
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits48_127St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_48_127St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_48_127St$FitComparison <- '048_127_St'

SolFits77_48St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PC-rich_077" | Strain == "PE-rich_048") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits77_48St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77_48St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77_48St$FitComparison <- '077_048_St'

SolFits77_127St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PC-rich_077" | Strain == "PE-rich_127") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits77_127St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77_127St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77_127St$FitComparison <- '077_127_St'

modelSt<-rbind(model_56_77St, model_56_48St, model_56_127St, model_48_127St, model_77_48St, model_77_127St)
  rm(model_56_77St, model_56_48St, model_56_127St, model_48_127St, model_77_48St, model_77_127St)
```

t-test from the linear model Phase
```{r}
# Exp
Stats56_ExpSt<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential" | Phase == "Pre-stationary") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PC-rich_056") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Phase + AllmeanPhycoChlaRatio:Phase,data=Stats56_ExpSt)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56ExpSt<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56ExpSt$FitComparison <- '056_Exp_St'

Stats77_ExpSt<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential" | Phase == "Pre-stationary") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PC-rich_077") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Phase + AllmeanPhycoChlaRatio:Phase,data=Stats77_ExpSt)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77ExpSt<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77ExpSt$FitComparison <- '077_Exp_St'

Stats48_ExpSt<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential" | Phase == "Pre-stationary") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PE-rich_048") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Phase + AllmeanPhycoChlaRatio:Phase,data=Stats48_ExpSt)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_48ExpSt<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_48ExpSt$FitComparison <- '048_Exp_St'

Stats127_ExpSt<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential" | Phase == "Pre-stationary") %>%
  filter(Ex_WL == 445) %>%
  filter(Strain == "PE-rich_127") 
  fit <- lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Phase + AllmeanPhycoChlaRatio:Phase,data=Stats127_ExpSt)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_127ExpSt<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_127ExpSt$FitComparison <- '127_Exp_St'


modelExpSt<-rbind(model_56ExpSt, model_77ExpSt, model_48ExpSt, model_127ExpSt)
  rm(model_56ExpSt, model_77ExpSt, model_48ExpSt, model_127ExpSt)
```

# Merge statistic
```{r}
Anova_SigPig445_Model<-rbind(modelExp, modelSt, modelExpSt)
rm(modelExp, modelSt, modelExpSt)
```


# Save RDS that create stats and tables

```{r}
saveRDS(Anova_SigPig445_Model, file.path(TableRdsPath, paste(Project, "Anova_SigPig445_Model.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)
```



----------------------------------------------------- Sig in the dark -----------------------------------------

```{r unnest, preparing df to preparing final plot, echo=FALSE, warning = FALSE}
augmented590pigmentdark<-SolFitsAllPigmentfitPhycoChlalineardarkStrain  %>%
  unnest(Linear_Model_Predict) %>%
  select(c(Strain, Ex_WL, meanSigdark_nm2psii, AllmeanPhycoChlaRatio, Phase, .fitted, facetsPhase, facetsStrain)) %>% 
  filter(Ex_WL == 590)

SolFitsAllPigmentPCPE590dark <- SolFitsAllPigmentPCPE %>% 
filter(Ex_WL == 590) 

#SolFitsAllPigmentPCPE590$facetsStrain <- 'Strain'
# SolFitsAllPigmentPCPE590$facetsPhase <- "Phase~of~growth"
```

```{r warning = FALSE}
# WL.labs <- c("Excitation (nm)")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Strain")
# names(O2.labs) <- c(21)

scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))


SolFitsAllPigmentPCPE590dark %>% 
  ggplot() +
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = AllmeanSigdark_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, show.legend = T, SolFitsAllPigmentPCPE590dark) + 
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = Sigdark_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 1, show.legend = F, SolFitsAllPigmentPCPE590dark) + 
  geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = AllmeanSigdark_nm2psii - AllsdSigdark_nm2psii, ymax = AllmeanSigdark_nm2psii + AllsdSigdark_nm2psii, colour = as.factor(Par_ue)), show.legend = F, width=0, size=0.3, SolFitsAllPigmentPCPE590dark) +
  geom_line(aes(x = AllmeanPhycoChlaRatio, y = `.fitted`), colour = "blue", linetype = "solid", size = 0.3, show.legend = F, augmented590pigmentdark) +   
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2) +
  scale_y_continuous(breaks=seq(0, 8, by = 2)) +
  coord_cartesian(ylim = c(0, 9)) +
  labs(y=expression(paste(sigma,""["PSII"]*" (nm"^"2"*" quanta"^"-1"*")")), x = "Total phyco/Chl" ~italic(a)~ "ratio") +
  ggh4x::facet_nested(cols = vars(facetsPhase, Phase), rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  theme_bw() 
```

```{r fig.height = 8, fig.width = 8, warning = FALSE}
# WL.labs <- c("Excitation (nm)")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Strain")
# names(O2.labs) <- c(21)


data_textA <- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain  = c("Strain"), Strain  = c("PC-rich_056"), label = c('A'))

k_data056 = data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain  = c("Strain"), Strain  = c("PC-rich_056"))
k_data077 = data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain  = c("Strain"), Strain  = c("PC-rich_077"))
k_data048 = data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain  = c("Strain"), Strain  = c("PE-rich_048"))
k_data127 = data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain  = c("Strain"), Strain  = c("PE-rich_127"))

data_text_AnovaExp56<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('a'))
data_text_AnovaExp77<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("b"))
data_text_AnovaExp48<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("c"))
data_text_AnovaExp127<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("d"))

data_text_AnovaSt56<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('a'))
data_text_AnovaSt77<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("b"))
data_text_AnovaSt48<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("a"))
data_text_AnovaSt127<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("a"))


data_text_AnovaExp56P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('A'))
data_text_AnovaExp77P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("A"))
data_text_AnovaExp48P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("A"))
data_text_AnovaExp127P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("A"))

data_text_AnovaSt56P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056"), label = c('B'))
data_text_AnovaSt77P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PC-rich_077"), label = c("B"))
data_text_AnovaSt48P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_048"), label = c("A"))
data_text_AnovaSt127P<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Pre-stationary"), facetsStrain = c("Strain"), Strain  = c("PE-rich_127"), label = c("B"))

data_text_AnovaPhase<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"),  label = c(' , \u03B1 = 0.05', ' , \u03B1 = 0.05', ' , \u03B1 = 0.05', ' , \u03B1 = 0.05'))
data_text_AnovaPhase2<- data.frame(facetsPhase = c("Phase~of~growth"), Phase = c("Exponential"), facetsStrain = c("Strain"), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"),  label = c('italic(t)~-test', 'italic(t)~-test', 'italic(t)~-test', 'italic(t)~-test'))

scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))

  
SoliPigSupA<-SolFitsAllPigmentPCPE590dark %>% 
  ggplot() +
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = AllmeanSigdark_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.8, show.legend = F, SolFitsAllPigmentPCPE590dark) + 
  geom_point(aes(x = AllmeanPhycoChlaRatio, y = Sigdark_nm2psii, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 1, show.legend = F, SolFitsAllPigmentPCPE590dark) + 
  geom_errorbar(aes(x = AllmeanPhycoChlaRatio, ymin = AllmeanSigdark_nm2psii - AllsdSigdark_nm2psii, ymax = AllmeanSigdark_nm2psii + AllsdSigdark_nm2psii, colour = as.factor(Par_ue)), show.legend = F, width=0, size=0.3, SolFitsAllPigmentPCPE590dark) +
  geom_line(aes(x = AllmeanPhycoChlaRatio, y = `.fitted`), colour = "blue", linetype = "solid", size = 0.3, show.legend = F, augmented590pigmentdark) + 

  geom_text(data=data_text_AnovaExp56, aes(x=3, y=7, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp77, aes(x=3.8, y=7, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp48, aes(x=4.8, y=9, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp127, aes(x=4.5, y=9, label=label), colour = "blue", size=4) +
    
  geom_text(data=data_text_AnovaSt56, aes(x=2.3, y=4.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt77, aes(x=3.5, y=6.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt48, aes(x=3.1, y=6.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt127, aes(x=3.7, y=6, label=label), colour = "blue", size=4) +
    
  geom_text(data=data_text_AnovaExp56P, aes(x=3, y=2, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp77P, aes(x=3.8, y=2, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp48P, aes(x=4.8, y=5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaExp127P, aes(x=4.5, y=3, label=label), colour = "blue", size=4) +
    
  geom_text(data=data_text_AnovaSt56P, aes(x=2.3, y=0.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt77P, aes(x=3.5, y=2.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt48P, aes(x=3.1, y=2.5, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaSt127P, aes(x=3.7, y=2.5, label=label), colour = "blue", size=4) +
  
  geom_text(data=data_text_AnovaPhase, aes(x=1.7, y=-0.4, label=label), colour = "blue", size=4) +
  geom_text(data=data_text_AnovaPhase2, aes(x=0.5, y=-0.4, label=label), colour = "blue", size=4, parse = TRUE) +
  
  geom_segment(data = k_data056, aes(x =5, y = -Inf, xend = 5, yend = Inf), color = "seagreen4", size = 6, alpha = 0.7) +
  geom_segment(data = k_data077, aes(x =5, y = -Inf, xend = 5, yend = Inf), color = "palegreen3", size = 6, alpha = 0.7) +
  geom_segment(data = k_data048, aes(x =5, y = -Inf, xend = 5, yend = Inf), color = "brown1", size = 6, alpha = 0.7) +
  geom_segment(data = k_data127, aes(x =5, y = -Inf, xend = 5, yend = Inf), color = "brown4", size = 6, alpha = 0.7) +
  
  geom_text(data=data_textA, aes(x=0.5, y=10, label=label), size=6) +
  
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2) +
  scale_x_continuous(breaks=seq(0, 5, by = 1)) +
  scale_y_continuous(breaks=seq(0, 10, by = 2)) +
  coord_cartesian(xlim = c(0, 5), ylim = c(-2, 12)) +
  labs(y=expression(paste(sigma,""["PSII"]*" (nm"^"2"*" quanta"^"-1"*")")), x = "Phycobiliprotein to Chl" ~italic(a)~ "ratio (µg:µg)") +
  ggh4x::facet_nested(cols = vars(facetsPhase, Phase), rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        
        strip.background.y = element_blank(),
        strip.text.y = element_blank(),
        
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.85,0.88),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        legend.title = element_blank(),
        legend.text = element_text(size=11))
SoliPigSupA
```


# Save plot 

```{r save plot}
# ggsave(file = file.path(FigPath, paste("SFig_SigmaPig590dark",".png",sep = "")), height=9, width= 7,  dpi = 300, limitsize = TRUE)
```

# Merge plots for suplement - sig vs pig ratio supl

```{r, warning = FALSE, fig.height = 9, fig.width = 12}
ggp<- SoliPigSupA+SoliPigSupB
ggp
```


```{r save plot}
ggsave(file = file.path(FigPath, paste("SFig_SigmaPigMerge",".png",sep = "")), height=9, width= 12,  dpi = 300, limitsize = TRUE)
```




# Anova from the linear model 
https://stackoverflow.com/questions/24527116/write-regression-summary-to-the-csv-file-in-r

t-test from the linear model Exp
```{r}
# Exp
Stats56_77Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_056" | Strain == "PC-rich_077") 
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=Stats56_77Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_77Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_77Exp$FitComparison <- '056_077_Exp'

SolFits56_48Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_056" | Strain == "PE-rich_048") 
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits56_48Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_48Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_48Exp$FitComparison <- '056_048_Exp'

SolFits56_127Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_056" | Strain == "PE-rich_127")  
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits56_127Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_127Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_127Exp$FitComparison <- '056_127_Exp'

SolFits48_127Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PE-rich_048" | Strain == "PE-rich_127")  
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits48_127Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_48_127Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_48_127Exp$FitComparison <- '048_127_Exp'

SolFits77_48Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_077" | Strain == "PE-rich_048") 
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits77_48Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77_48Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77_48Exp$FitComparison <- '077_048_Exp'

SolFits77_127Exp<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_077" | Strain == "PE-rich_127") 
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits77_127Exp)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77_127Exp<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77_127Exp$FitComparison <- '077_127_Exp'

modelExpdark<-rbind(model_56_77Exp, model_56_48Exp, model_56_127Exp, model_48_127Exp, model_77_48Exp, model_77_127Exp)
  rm(model_56_77Exp, model_56_48Exp, model_56_127Exp, model_48_127Exp, model_77_48Exp, model_77_127Exp)
```

t-test from the linear model St
```{r}
# Exp
Stats56_77St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_056" | Strain == "PC-rich_077") 
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=Stats56_77St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_77St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_77St$FitComparison <- '056_077_St'

SolFits56_48St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_056" | Strain == "PE-rich_048") 
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits56_48St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_48St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_48St$FitComparison <- '056_048_St'

SolFits56_127St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_056" | Strain == "PE-rich_127")  
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits56_127St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56_127St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56_127St$FitComparison <- '056_127_St'

SolFits48_127St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PE-rich_048" | Strain == "PE-rich_127")  
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits48_127St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_48_127St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_48_127St$FitComparison <- '048_127_St'

SolFits77_48St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_077" | Strain == "PE-rich_048") 
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits77_48St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77_48St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77_48St$FitComparison <- '077_048_St'

SolFits77_127St<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_077" | Strain == "PE-rich_127") 
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=SolFits77_127St)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77_127St<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77_127St$FitComparison <- '077_127_St'

modelStdark<-rbind(model_56_77St, model_56_48St, model_56_127St, model_48_127St, model_77_48St, model_77_127St)
  rm(model_56_77St, model_56_48St, model_56_127St, model_48_127St, model_77_48St, model_77_127St)
```

t-test from the linear model Phase
```{r}
# Exp
Stats56_ExpSt<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential" | Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_056") 
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Phase + AllmeanPhycoChlaRatio:Phase,data=Stats56_ExpSt)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_56ExpSt<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_56ExpSt$FitComparison <- '056_Exp_St'

Stats77_ExpSt<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential" | Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PC-rich_077") 
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Phase + AllmeanPhycoChlaRatio:Phase,data=Stats77_ExpSt)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_77ExpSt<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_77ExpSt$FitComparison <- '077_Exp_St'

Stats48_ExpSt<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential" | Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PE-rich_048") 
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Phase + AllmeanPhycoChlaRatio:Phase,data=Stats48_ExpSt)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_48ExpSt<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_48ExpSt$FitComparison <- '048_Exp_St'

Stats127_ExpSt<-SolFitsAllPigmentPCPE %>%
  filter(Phase == "Exponential" | Phase == "Pre-stationary") %>%
  filter(Ex_WL == 590) %>%
  filter(Strain == "PE-rich_127") 
  fit <- lm(Sigdark_nm2psii ~ AllmeanPhycoChlaRatio + Phase + AllmeanPhycoChlaRatio:Phase,data=Stats127_ExpSt)
x <- cbind(t(as.numeric(coefficients(fit))), t(as.numeric(summary(fit)$coefficients[4, 4])), t(as.numeric(summary(fit)$coefficients[4, 3])), t(as.numeric(summary(fit)$coefficients[4, 2])))
model_127ExpSt<-data.frame(unclass(x), check.names = FALSE, stringsAsFactors = FALSE) %>% 
  rename("Estimate" = "4", "Std.Error" = "7", "t_value" = "6", "p_value" = "5") %>% 
  select(c("Estimate", "Std.Error", "t_value", "p_value"))
  model_127ExpSt$FitComparison <- '127_Exp_St'


modelExpStdark<-rbind(model_56ExpSt, model_77ExpSt, model_48ExpSt, model_127ExpSt)
  rm(model_56ExpSt, model_77ExpSt, model_48ExpSt, model_127ExpSt)
```

# Merge statistic
```{r}
Anova_SigPig590dark_Model<-rbind(modelExpdark, modelStdark, modelExpStdark)
rm(modelExpdark, modelStdark, modelExpStdark)
```


# Save RDS that create stats and tables

```{r}
saveRDS(Anova_SigPig590dark_Model, file.path(TableRdsPath, paste(Project, "Anova_SigPig590dark_Model.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)
```



# Clean the environment

```{r}
# rm(SolFitsAllPigmentfitPhycoChlalineardarkStrain, SolFitsAllPigmentfitPhycoChlalineardarkStrainGroup, SolFitsAllPigmentfitPhycoChlalinearStrain, SolFitsAllPigmentfitPhycoChlalinearStrain1s, SolFitsAllPigmentfitPhycoChlalinearStrainGroup, SolFitsAllPigmentfitPhycoChlalinearStrainGroup1s)
```


# Create preliminary JVPSII vs Chl Turner (ug/L) plot

```{r preliminary plots, warning = FALSE}
SolFitsPigmentExp %>% 
  ggplot() +
  geom_point(aes(x = TurChl_ugL, y = JVPSII_ETRqpOxbo_aLHII_Sig, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, show.legend = T) +
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3","goldenrod2", "khaki2"), name="", labels = lab2) +
  ggh4x::facet_nested(cols = vars(Ex_WL), rows = vars(Strain), labeller = label_parsed) +
  theme_bw()

SolFitsPigmentExp %>% 
  ggplot() +
  geom_point(aes(x = meanTurChl_ugL, y = AllmeanJVPSII_ETRqpOxbo_aLHII_Sig, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, show.legend = T) +
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3","goldenrod2", "khaki2"), name="", labels = lab2) +
  ggh4x::facet_nested(cols = vars(Ex_WL), rows = vars(Strain), labeller = label_parsed) +
  theme_bw()

SolFitsPigmentExp %>%
  ggplot() +
  geom_point(aes(x = cellL_OD680, y = JVPSII_ETRqpOxbo_aLHII_Sig, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, show.legend = T) +
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3","goldenrod2", "khaki2"), name="", labels = lab2) +
  ggh4x::facet_nested(cols = vars(Ex_WL), rows = vars(Strain), labeller = label_parsed) +
  theme_bw()

SolFitsPigmentExp %>%
  ggplot() +
  geom_point(aes(x = AllmeancellL_OD680, y = AllmeanJVPSII_ETRqpOxbo_aLHII_Sig, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, show.legend = T) +
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3","goldenrod2", "khaki2"), name="", labels = lab2) +
  ggh4x::facet_nested(cols = vars(Ex_WL), rows = vars(Strain), labeller = label_parsed) +
  theme_bw()

SolFitsPigmentExp %>% 
  ggplot() +
  geom_point(aes(x = E_days, y = JVPSII_ETRqpOxbo_aLHII_Sig, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, show.legend = T) +
  scale_shape_manual(values = c(15, 16, 17,18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3","goldenrod2", "khaki2"), name="", labels = lab2) +
  ggh4x::facet_nested(cols = vars(Ex_WL), rows = vars(Strain), labeller = label_parsed) +
  theme_bw()
```

# Clean the environment

```{r warning = FALSE}
# rm(Turnercatalog, ChlData, SolFitsAllPigmentPCPE, SolFitsAllPigmentPCPE1s, data_text_AnovaExp56P, data_text_AnovaExp77P, data_text_AnovaExp48P, data_text_AnovaExp127P, data_text_AnovaExp56, data_text_AnovaExp77, data_text_AnovaExp48, data_text_AnovaExp127, data_text_AnovaSt56P, data_text_AnovaSt77P, data_text_AnovaSt48P, data_text_AnovaSt127P, data_text_AnovaSt56, data_text_AnovaSt77, data_text_AnovaSt48, data_text_AnovaSt127, augmented590Pig, augmented590pigment, augmented590pigmentdark, augmented590PUR, data_text_AnovaPhase, fit, SolFits48_127Exp, SolFits48_127Exp, SolFits56_127Exp, SolFits56_127St, SolFits56_48Exp, SolFits56_48St, SolFits77_48Exp, SolFits77_48St, SolFits77_127Exp, SolFits77_127St, Stats56_77Exp, Stats56_77St, Stats56_ExpSt, Stats56_ExpSt, Stats77_ExpSt, Stats48_ExpSt, Stats127_ExpSt, x, SolFitsExpFitAll, SolFitsExpFit590CleanPUR, SolFitsExpFit590CleanPig, model, MCPigmentAll, MCPigmentAllExpSt, PhycoChlaRatioChoosen, PhycoChlaRatioChoosenPUR, SigFit445Stats, SolFits48_127St, SolFitsAllPigmentfitPhycoChlalinear, SolFitsAllPigmentfitPhycoChlalineardark, SolFitsAllPigmentPCPE590, SolFitsAllPigmentPCPE590dark, SigFit590Stats, MCPigmentAllExp, MCPigmentAllSt, SolFits)
```

```{r}
#108 value per 1 condition - b/c mean OD
# Test<-SolFitsAllPigmentPCPETurner %>% 
#   filter(Strain == "PC-rich_077") %>% 
#   filter(Photoperiod == 12) %>% 
#   filter(Par_ue == 90) %>% 
#   filter(Ex_WL == 445)
```


# Save rds for further analysis

```{r save rds}
saveRDS(SolFitsPigmentExp, file.path(DataOut, paste(Project, "Processed_SolisensePigmentsData.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)
```

# Variable names used in Data Dictionary

```{r}
colnames(SolFitsPigmentExp)
```


The anova() function will take the model objects as arguments, and return an ANOVA testing whether the more complex model is significantly better at capturing the data than the simpler model. If the resulting p-value is sufficiently low (usually less than 0.05), we conclude that the more complex model is significantly better than the simpler model, and thus favor the more complex model. If the p-value is not sufficiently low (usually greater than 0.05), we should favor the simpler model.

# Exstracting models for each fit - models were not all fitted to the same size of dataset

```{r}
# StatsSigLM<-SolFitsAllPigmentPCPE %>% 
#   drop_na(Sig_nm2psii, AllmeanPhycoChlaRatio) 
# 
# StatsSigLM$Strain <- factor(StatsSigLM$Strain)
# StatsSigLM$Phase <- factor(StatsSigLM$Phase)  
# StatsSigLM$AllmeanPhycoChlaRatio <- factor(StatsSigLM$AllmeanPhycoChlaRatio) 
# 
# SolFitsBA56Exp<-StatsSigLM %>%
#   filter(Strain == "PC-rich_056")
#   SolFitsBA56Exp <- SolFitsBA56Exp[-c(883:990), ]
# 
# SolFitsBA77Exp<-StatsSigLM %>%
#   filter(Strain == "PC-rich_077") 
#   SolFitsBA77Exp <- SolFitsBA77Exp[-c(883:998), ]
# 
# SolFitsBA48Exp<-StatsSigLM %>%
#   filter(Strain == "PE-rich_048") 
#   SolFitsBA48Exp <- SolFitsBA48Exp[-c(883:883), ]
# 
# SolFitsBA127Exp<-StatsSigLM %>%
#   filter(Strain == "PE-rich_127") 
#   SolFitsBA127Exp <- SolFitsBA127Exp[-c(883:894), ]
# 
# model1 <- lm(Sig_nm2psii~AllmeanPhycoChlaRatio, data = SolFitsBA56Exp)
# model2 <- lm(Sig_nm2psii~AllmeanPhycoChlaRatio, data = SolFitsBA77Exp)
# ANOVA_LinModel<-anova(model1, model2, test="F")
#   
#   
# model<-aov(Sig_nm2psii~AllmeanPhycoChlaRatio*Phase*Strain, data=StatsSigLM)
# AnovaTest_SigLM<-data.frame(unclass(summary(model)), check.names = FALSE, stringsAsFactors = FALSE)
# TukeyHSDTest_Sig<-TukeyHSD(model, which = c("Phase", "Strain"))


#  diamonds.mod1 <- lm(Sig_nm2psii~PhycoChlaRatio, data = SolFitsAllExp)
#   diamonds.mod2 <- lm(Sig_nm2psii~PhycoChlaRatio, data = SolFitsAllSt)
#   anova(diamonds.mod1, diamonds.mod2, test="Chisq")

```

# Remove stats

```{r}
# rm(anova127ExpSt, anova48ExpSt, anova56ExpSt, anova77ExpSt, anova127Exp, anova48Exp, anova56Exp, anova77Exp, anova127St, anova48St, anova56St, anova77St, TukeyHSDTest_PhycoChlaRatio, TukeyHSDTest_PURPARRatio, TukeyHSDTest_Sig, AnovaTest_PhycoChlaRatio, AnovaTest_PhycoChlaRatio_Param, AnovaTest_PURPARRatio, AnovaTest_Sig, anova_PURPARRatioModelStrainSt, anova_PURPARRatioModelStrainExp, anova_PURPARRatioModelPhase, anova_SigModelStrainSt, anova_SigModelStrainExp, anova_SigModelPhase, anova_PhycoChlaRatioModelStrainSt, anova_PhycoChlaRatioModelStrainExp, 
#    data_text_yfSt, data_text_yfExp, data_text_y0St, data_text_y0Exp, data_text_lambdaSt, data_text_lambdaExp, data_text_AnovaSt, data_text_AnovaExp, fitted_Param590Pig, fitted_Param590PUR, fitted590Pig, fitted590PUR, fittedmodelPhase, fittedmodelPig, fittedmodelPUR, fittedmodelStrainExp, fittedmodelStrainSt, S22, S55, SolFitsBA127Exp, SolFitsBA48Exp, SolFitsBA56Exp, SolFitsBA77Exp, AnovaTest_PURPARRatio_Param, AnovaTest_Sig590_Param, AnovaTest_SigLM, anova_PhycoChlaRatioModelPhase, augmented590Pig, augmented590PUR,
#    SolFitsExpFit590CleanPig, SolFitsExpFit590CleanPUR)
```


dodawanie modeli zeby sprawdzic, czy sa istotne roznice pomiedzy szczepami i fazami wzrostu
https://stats.stackexchange.com/questions/435644/is-there-a-method-to-look-for-significant-difference-between-two-linear-regressi

```{r}
# set.seed(123)
# df = data.frame(Age=sample(1:100))
# df$Height[1:50] = df$Age[1:50] + rpois(50,30)
# df$Height[51:100] = 1.3*df$Age[51:100] + rpois(50,30)
# df$Fladen = rep(c("A","B"),each=50)
# 
# summary(lm(Height ~ Age + Fladen + Age:Fladen,data=df))

# So the last term, Age:FladenB shows a coefficient of 0.29, meaning the slope (Height vs Age) in Fladen B is .29 more than that in Fladen A

# StatsExp590<-SolFitsAllPigmentPCPE %>%
#   filter(Phase == "Exponential") %>%
#   filter(Ex_WL == 590) %>%
#   select(c(Strain, Sig_nm2psii, AllmeanPhycoChlaRatio))
# summary(lm(Sig_nm2psii ~ AllmeanPhycoChlaRatio + Strain + AllmeanPhycoChlaRatio:Strain,data=StatsExp590))

```

# compact letter display
```{r}
# # analysis of variance
# anova <- aov(weight ~ feed, data = chickwts)
# 
# # Tukey's test
# tukey <- TukeyHSD(anova)
# 
# # compact letter display
# cld <- multcompLetters4(anova, tukey)
# 
# # table with factors and 3rd quantile
# dt <- group_by(chickwts, feed) %>%
#   summarise(w=mean(weight), sd = sd(weight)) %>%
#   arrange(desc(w))
# 
# # extracting the compact letter display and adding to the Tk table
# cld <- as.data.frame.list(cld$feed)
# dt$cld <- cld$Letters
# 
# print(dt)
```

https://www.geeksforgeeks.org/t-test-approach-in-r-programming/




Set up R codes for Greek letters

\u0391  Α   Greek Capital Letter Alpha
\u0392  Β   Greek Capital Letter Beta
\u0393  Γ   Greek Capital Letter Gamma
\u0394  Δ   Greek Capital Letter Delta
\u0395  Ε   Greek Capital Letter Epsilon
\u0396  Ζ   Greek Capital Letter Zeta
\u0397  Η   Greek Capital Letter Eta
\u0398  Θ   Greek Capital Letter Theta
\u0399  Ι   Greek Capital Letter Iota
\u039A  Κ   Greek Capital Letter Kappa
\u039B  Λ   Greek Capital Letter Lambda
\u039C  Μ   Greek Capital Letter Mu
\u039D  Ν   Greek Capital Letter Nu
\u039E  Ξ   Greek Capital Letter Xi
\u039F  Ο   Greek Capital Letter Omicron
\u03A0  Π   Greek Capital Letter Pi
\u03A1  Ρ   Greek Capital Letter Rho
\u03A3  Σ   Greek Capital Letter Sigma
\u03A4  Τ   Greek Capital Letter Tau
\u03A5  Υ   Greek Capital Letter Upsilon
\u03A6  Φ   Greek Capital Letter Phi
\u03A7  Χ   Greek Capital Letter Chi
\u03A8  Ψ   Greek Capital Letter Psi
\u03A9  Ω   Greek Capital Letter Omega
\u03B1  α   Greek Small Letter alpha
\u03B2  β   Greek Small Letter beta
\u03B3  γ   Greek Small Letter gamma
\u03B4  δ   Greek Small Letter delta
\u03B5  ε   Greek Small Letter epsilon
\u03B6  ζ   Greek Small Letter zeta
\u03B7  η   Greek Small Letter eta
\u03B8  θ   Greek Small Letter theta
\u03B9  ι   Greek Small Letter iota
\u03BA  κ   Greek Small Letter kappa
\u03BB  λ   Greek Small Letter lambda
\u03BC  μ   Greek Small Letter mu
\u03BD  ν   Greek Small Letter nu
\u03BE  ξ   Greek Small Letter xi
\u03BF  ο   Greek Small Letter omicron
\u03C0  π   Greek Small Letter pi
\u03C1  ρ   Greek Small Letter rho
\u03C2  ς   Greek Small Letter final sigma
\u03C3  σ   Greek Small Letter sigma
\u03C4  τ   Greek Small Letter tau
\u03C5  υ   Greek Small Letter upsilon
\u03C6  φ   Greek Small Letter phi
\u03C7  χ   Greek Small Letter chi
\u03C8  ψ   Greek Small Letter psi
\u03C9  ω   Greek Small Letter omega





