---
title: "Process_GrowthRateSolisenseLRCData"
author:
- Sylwia Sliwinska-Wilczewska
- Douglas A. Campbell
date: "`r format(Sys.Date())`"
output:
bookdown::html_document2:
    code_folding: show
    keep_md: yes
    toc: TRUE
    toc_float: TRUE
    toc_depth: 6
    fig_caption: yes
bibliography: BalticPhotoperiod.bib
csl: plos-one.csl
editor_options: 
  markdown: 
    wrap: 72
---

# Set Chunk Options

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
knitr::opts_chunk$set(fig.path='Figs/')
```

# Introduction

Process_GrowthRateSolisenseLRCData.Rmd processes and combines BalticPhotoperiod_Processed_GrowthRate.Rds from Data/ProcessedData/ProcessedGrowthRateData folder and BalticPhotoperiod_Processed_SolisensePigmentsExp.Rds from Data/ProcessedData/ProcessedSolisenseData folder. This .Rmd generates xxx.Rds (stored in xxxa folder) and xxx_Plot.png (stored in Output/Plots folder).

# Load Libraries and set Project Variables

```{r load libraries, warning = FALSE, echo=FALSE} 
library(tidyverse)
library(lubridate)
library(stringr)
library(broom)
library(knitr)
library(OneR)
library(zoo)
library(ggpubr)
library(caret)
library(reshape2)
library(gcookbook)
library(scales)
library(Cairo) #for greek symbols
library(minpack.lm) #Standard 'nls' framework that uses 'nls.lm' for fitting
library(googledrive)
library(googlesheets4)
```

```{r set project variables}
Project <- "BalticPhotoperiod"
DataOut <- file.path("..", "Data", "ProcessedData", "ProcessedGrowthRateSolisenseData")

DataInGrowthRate <- file.path("..", "Data", "ProcessedData", "ProcessedGrowthRateData", fsep = .Platform$file.sep)
DataInSolisense <- file.path("..", "Data", "ProcessedData", "ProcessedSolisenseData", fsep = .Platform$file.sep)
#DataInGrowthRateRaw <- file.path("..", "Data", "CleanedData", "CleanedMCData", fsep = .Platform$file.sep)
#DataInGrowthRate_h <- file.path("..", "Data", "ProcessedData", "ProcessedMCDielLightData", fsep = .Platform$file.sep)
#DataInPigment <- file.path("..", "Data", "ImportedData", "ImportedPigmentsData", fsep = .Platform$file.sep)


FigPath <- file.path("..", "Output", "Figures")
FigRdsPath <- file.path("..", "Output", "FiguresRds")
TableRdsPath <- file.path("..", "Output", "TablesRDS")

FileEncode <- "UTF-8" 
Delimiter <- ""
HeaderRows <- 0
```

# List and read Imported_Solisense RDS

```{r Exported Rmd}
list.files(path = DataInGrowthRate, pattern = Project, full.names = TRUE)
list.files(path = DataInSolisense, pattern = Project, full.names = TRUE)
#list.files(path = DataInGrowthRateRaw, pattern = Project, full.names = TRUE)
#list.files(path = DataInGrowthRate_h, pattern = Project, full.names = TRUE)
```

```{r read ProcessFile}
GrowthRateFile <- "../Data/ProcessedData/ProcessedGrowthRateData/BalticPhotoperiod_Processed_GrowthRateAll.Rds"
GrowthRateFileName <- str_split(string = GrowthRateFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds")

GrowthRate <- readRDS(GrowthRateFile)  %>%
  ungroup()

# GrowthRate<-GrowthRate %>% 
#   select(c(SampleID, Run, Strain, Tube, MC, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, PARPhotonDose_day, FilenameMC, ExpEndDate, OD720_Lmu_se, OD720_Lmu_corr, deltaOD_Lmu_se, deltaOD_Lmu_corr)) %>% 
#   unique()

GrowthRate<-GrowthRate %>% 
  select(c(Strain, Par_ue, Photoperiod, O2, WL, LightShape, PARPhotonDose_day, OD720_Lmu_se, OD720_Lmu_corr, deltaOD_Lmu_se, deltaOD_Lmu_corr)) %>% 
  unique()

```

# Growth rate per day

```{r}
GrowthRate<-GrowthRate %>%
  mutate(OD720_Lmu_corr = OD720_Lmu_corr*24) %>% 
  mutate(OD720_Lmu_se = OD720_Lmu_se*24) %>% 
  mutate(deltaOD_Lmu_corr = deltaOD_Lmu_corr*24) %>% 
  mutate(deltaOD_Lmu_se = deltaOD_Lmu_se*24) 
  
```


```{r read ProcessFile}
# GrowthRate_hFile <- "../Data/ProcessedData/ProcessedMCDielLightData/BalticPhotoperiod_Processed_MCDielLightData.Rds"
# GrowthRate_hFileName <- str_split(string = GrowthRate_hFile, "/")[[1]][3] %>%
#   str_remove(pattern = ".Rds")
# 
# GrowthRate_h <- readRDS(GrowthRate_hFile)  %>%
#   ungroup()
# 
# GrowthRate_h <- GrowthRate_h %>% 
#   filter(Strain == "BA127R" | Strain == "BA48R" | Strain == "BA56G" | Strain == "BA77G") %>% 
#   mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
#          Strain=="BA48R"~"PE-rich_048",
#         Strain=="BA56G"~"PC-rich_056",
#          Strain=="BA77G"~"PC-rich_077")) 
```

# Merge Growth rate and Growth rate_h

```{r Joining growth rate and Solisense exp data}
# GrowthRateAll <- GrowthRate_h %>% 
#   full_join(., GrowthRate, by = c("SampleID"="SampleID", "Run"="Run", "Strain"="Strain", "Tube" = "Tube",  "Par_ue"="Par_ue","Photoperiod"="Photoperiod", "O2"="O2", "WL"="WL")) 
```

# Growth Rate - all - from Merge - to get all data points

```{r read ProcessFile}
# GrowthRateRawFile <- "../Data/CleanedData/CleanedMCData/PICO_Cleaned_MCData.Rds"
# GrowthRateRawFileName <- str_split(string = GrowthRateRawFile, "/")[[1]][3] %>%
#   str_remove(pattern = ".Rds")
# 
# GrowthRateRaw <- readRDS(GrowthRateRawFile)  %>%
#   ungroup()
# 
# GrowthRateRaw<-GrowthRateRaw %>% 
#   dplyr::select(c(Tube, ExpDate, MC, Run, SampleID, Strain, Par_ue, Photoperiod, WL, O2, LightShape, PARPhotonDose_day, OD720_Lmu_se, OD720_Lmu_corr, deltaOD_Lmu_se, deltaOD_Lmu_corr))
#   
# GrowthRateRaw<-GrowthRateRaw %>% 
#   mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
#          Strain=="BA48R"~"PE-rich_048",
#         Strain=="BA56G"~"PC-rich_056",
#          Strain=="BA77G"~"PC-rich_077"))
# 
# GrowthRateRaw1<-GrowthRateRaw %>% 
#   filter(Run==77) %>% 
#   filter(Strain =="PC-rich_077" | Strain == "PC-rich_056")
# GrowthRateRaw2<-GrowthRateRaw %>% 
#   filter(Run!=77) %>% 
#   filter(Strain !="PC-rich_077" & Strain != "PC-rich_056")
# GrowthRateRaw<-rbind(GrowthRateRaw1, GrowthRateRaw2)
# 
# GrowthRateRaw<-GrowthRateRaw %>%
#   mutate(OD720_Lmu_corr = OD720_Lmu_corr*24) %>% 
#   mutate(OD720_Lmu_se = OD720_Lmu_se*24) %>% 
#   mutate(deltaOD_Lmu_corr = deltaOD_Lmu_corr*24) %>% 
#   mutate(deltaOD_Lmu_se = deltaOD_Lmu_se*24) 
```


# Create preliminary plot 

```{r preliminary plot, warning = FALSE}
GrowthRate %>%
  ggplot() +
  geom_point(aes(x = Par_ue, y = deltaOD_Lmu_corr,colour=as.factor(Strain)), size = 3.5, alpha = 0.9, show.legend = T) +
  geom_errorbar(aes(x = Par_ue, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se), alpha = 0.5) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  ggh4x::facet_nested(rows = vars(Strain), cols = vars(Photoperiod)) +
  theme_bw()

```


```{r read ProcessFile}
SolisenseFile <- "../Data/ProcessedData/ProcessedSolisenseData/BalticPhotoperiod_Processed_SolisenseJVPSII_2.Rds"
SolisenseFileName <- str_split(string = SolisenseFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds")

Solisense <- readRDS(SolisenseFile)  %>%
  ungroup()
```

# Add proper value of JVPSII

```{r}
colnames(Solisense)
Solisense<-Solisense %>%
  mutate(meanCellL_MDPico=meanCellmL_MDPico*1000) %>% 
  select(-c(data))
```


# Create preliminary plot

```{r preliminary plot}
lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))
lab2=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab3=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))

Solisense %>%
  filter(Ex_WL == 445) %>% 
  filter(Phase == "Exponential") %>% 
  ggplot() +
  geom_point(aes(x = E_days, y = JVPSII_umol_eLs_Par_ue, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  ggh4x::facet_nested(cols = vars(Phase, Photoperiod), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() 

Solisense %>%
  filter(Ex_WL == 445) %>% 
  filter(Phase == "Exponential") %>% 
  ggplot() +
  geom_point(aes(x = meanTurChl_ugL, y = JVPSII_umol_eLs_Par_ue, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  ggh4x::facet_nested(cols = vars(Phase, Photoperiod), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() 

Solisense %>%
  filter(Ex_WL == 445) %>% 
  filter(Phase == "Exponential") %>% 
  ggplot() +
  geom_point(aes(x = meanCellL_MDPico, y = JVPSII_umol_eLs_Par_ue, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  ggh4x::facet_nested(cols = vars(Phase, Photoperiod), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() 
```


```{r Joining growth rate and Solisense exp data}
GrowthRateSol <- GrowthRate %>% 
  full_join(., Solisense, by = c("Strain"="Strain", "Par_ue"="Par_ue","Photoperiod"="Photoperiod",  "LightShape"="LightShape", "O2"="O2", "WL"="WL", "PARPhotonDose_day"="PARPhotonDose_day")) 
```


# Growth rate vs JVPSII

```{r warning = FALSE}

lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }

GrowthRateSol %>% 
  filter(Ex_WL==445) %>% 
  filter(Phase == "Exponential") %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue, deltaOD_Lmu_corr, colour=as.factor(Strain)), alpha = 0.9, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  #scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  #labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = ""~italic(JV)~""["PSII"]*" ( µmol"~e^-~""~L^-1~""~s^-1~")") +
    ggh4x::facet_nested(cols = vars(Photoperiod), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() 

GrowthRateSol %>% 
  filter(Ex_WL==445) %>% 
  filter(Phase == "Exponential") %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_HalfPar_ue, deltaOD_Lmu_corr, colour=as.factor(Strain)), alpha = 0.9, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  #scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  #labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = ""~italic(JV)~""["PSII"]*" ( µmol"~e^-~""~L^-1~""~s^-1~")") +
    ggh4x::facet_nested(cols = vars(Photoperiod), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() 

```
# Delete a few unrelevant columns 

```{r}
GrowthRateSol<-GrowthRateSol %>% 
  select(-c(CellmL_MDPico, TurChl_ugL)) %>% 
  unique()
```

# Calculate umol chl a

```{r}
GrowthRateSol<-GrowthRateSol %>% 
  mutate(meanTurChl_umolL=meanTurChl_ugL*0.00112)
```


# Choosen only 445 and exp phase of growth

```{r}
GrowthRateSol445<-GrowthRateSol %>% 
  filter(Ex_WL==445) %>% 
  filter(Phase == "Exponential") %>% 
  filter(E_days >1)
```

# Filter Time of Day when was night (no measurements)

```{r}
# GrowthRateSol445<-GrowthRateSol445 %>% 
#   filter(ToD != 21 & ToD != 22 & ToD != 23 & ToD != 0 & ToD !=1 & ToD !=2 & ToD != 3 & ToD != 4 & ToD != 5 & ToD != 6) 
```


JVPSII per Turner Chl ug/L and per cell/L (meanCellmL_MDPico; meanTurChl_ugL)

```{r}
# JVPSII_ETRqpOxbo_FoSig = JVPSII_Par_ue

GrowthRateSoliExp<-GrowthRateSol445 %>% 
  #Turner
  mutate(JVPSII_umol_eLs_Par_ue_ugChl = JVPSII_umol_eLs_Par_ue/meanTurChl_ugL) %>% #umol e/ug ch/s
  mutate(JVPSII_umol_eLs_HalfPar_ue_ugChl = JVPSII_umol_eLs_HalfPar_ue/meanTurChl_ugL) %>% 
  
  mutate(JVPSII_umol_eLs_Par_ue_umolChl = JVPSII_umol_eLs_Par_ue/meanTurChl_umolL) %>% #umol e/umol ch/s
  mutate(JVPSII_umol_eLs_HalfPar_ue_umolChl = JVPSII_umol_eLs_HalfPar_ue/meanTurChl_umolL) %>% 
  
  #cell per L based on MC OD680 and pamas corr
  mutate(JVPSII_umol_eLs_Par_ue_cell = JVPSII_umol_eLs_Par_ue/meanCellL_MDPico) %>% 
  mutate(JVPSII_umol_eLs_HalfPar_ue_cell = JVPSII_umol_eLs_HalfPar_ue/meanCellL_MDPico)  
```

# Filter 4 data points - outliers
```{r}
GrowthRateSoliExp127<-GrowthRateSoliExp %>%
  filter(Photoperiod == 12) %>%
  filter(Par_ue != 900) %>% 
  filter(Strain == "PE-rich_127") %>% 
  filter(E_days == 14)

GrowthRateSoliExp127rest<-GrowthRateSoliExp %>%
  filter(Photoperiod == 12) %>%
  filter(Par_ue == 900) %>%
  filter(Strain == "PE-rich_127")

GrowthRateSoliExp127rest2<-GrowthRateSoliExp %>%
  filter(Photoperiod != 12) %>%
  filter(Strain == "PE-rich_127")

GrowthRateSoliExpRest<-GrowthRateSoliExp %>%
  filter(Strain != "PE-rich_127") 

GrowthRateSoliExp2<-rbind(GrowthRateSoliExp127, GrowthRateSoliExp127rest, GrowthRateSoliExp127rest2, GrowthRateSoliExpRest)

```



Growth rate vs JVPSII per Chl Turner and cell_L - taken from the same day as JVPSII

```{r warning = FALSE}

lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }

GrowthRateSoliExp2 %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_ugChl, deltaOD_Lmu_corr, colour=as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.9, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  scale_linetype_manual(values=c("equal900" = "dotted", "less900" = "solid"), breaks=c('8', '12', '16', "24", "", "")) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600", "900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
    ggh4x::facet_nested(cols = vars(Photoperiod), rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

GrowthRateSoliExp2 %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_umolChl, deltaOD_Lmu_corr, colour=as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.9, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  scale_linetype_manual(values=c("equal900" = "dotted", "less900" = "solid"), breaks=c('8', '12', '16', "24", "", "")) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600", "900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
    ggh4x::facet_nested(cols = vars(Photoperiod), rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

GrowthRateSoliExp2 %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_cell, deltaOD_Lmu_corr, colour=as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.9, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  scale_linetype_manual(values=c("equal900" = "dotted", "less900" = "solid"), breaks=c('8', '12', '16', "24", "", "")) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600", "900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
    ggh4x::facet_nested(cols = vars(Photoperiod), rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

```

calculate JVPSII per day
```{r}

# JVPSII_ETRqpOxbo_FoSig

SolFitsAllPigmentTurnerDay81216<-GrowthRateSoliExp2 %>% 
  filter(Photoperiod !=24) %>% 
  mutate(JVPSII_umol_eLs_Par_ue_ugChl_day = JVPSII_umol_eLs_Par_ue_ugChl*3600*Photoperiod/2) %>%
  mutate(JVPSII_umol_eLs_HalfPar_ue_ugChl_day = JVPSII_umol_eLs_HalfPar_ue_ugChl*3600*Photoperiod/2) %>%
  mutate(JVPSII_umol_eLs_Par_ue_umolChl_day = JVPSII_umol_eLs_Par_ue_umolChl*3600*Photoperiod/2) %>% 
  mutate(JVPSII_umol_eLs_HalfPar_ue_umolChl_day = JVPSII_umol_eLs_HalfPar_ue_umolChl*3600*Photoperiod/2) %>% 
  mutate(JVPSII_umol_eLs_Par_ue_cell_day = JVPSII_umol_eLs_Par_ue_cell*3600*Photoperiod/2) %>% 
  mutate(JVPSII_umol_eLs_HalfPar_ue_cell_day = JVPSII_umol_eLs_HalfPar_ue_cell*3600*Photoperiod/2) 

SolFitsAllPigmentTurnerDay900<-GrowthRateSoliExp2 %>% 
  filter(Photoperiod ==24) %>% 
  mutate(JVPSII_umol_eLs_Par_ue_ugChl_day = JVPSII_umol_eLs_Par_ue_ugChl*3600*Photoperiod) %>%
  mutate(JVPSII_umol_eLs_HalfPar_ue_ugChl_day = JVPSII_umol_eLs_HalfPar_ue_ugChl*3600*Photoperiod) %>%
  mutate(JVPSII_umol_eLs_Par_ue_umolChl_day = JVPSII_umol_eLs_Par_ue_umolChl*3600*Photoperiod) %>% 
  mutate(JVPSII_umol_eLs_HalfPar_ue_umolChl_day = JVPSII_umol_eLs_HalfPar_ue_umolChl*3600*Photoperiod) %>% 
  mutate(JVPSII_umol_eLs_Par_ue_cell_day = JVPSII_umol_eLs_Par_ue_cell*3600*Photoperiod) %>% 
  mutate(JVPSII_umol_eLs_HalfPar_ue_cell_day = JVPSII_umol_eLs_HalfPar_ue_cell*3600*Photoperiod) 
  
GrowthRateSoliExpDay<-rbind(SolFitsAllPigmentTurnerDay81216, SolFitsAllPigmentTurnerDay900)
  rm(SolFitsAllPigmentTurnerDay81216, SolFitsAllPigmentTurnerDay900)
```



Growth rate vs JVPSII per day
```{r warning = FALSE}

lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }

GrowthRateSoliExpDay %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_ugChl_day, deltaOD_Lmu_corr, colour=as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.9, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  #scale_linetype_manual(values=c("equal900" = "dotted", "less900" = "solid"), breaks=c('8', '12', '16', "24", "", "")) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600", "900")) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

GrowthRateSoliExpDay %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_HalfPar_ue_ugChl_day, deltaOD_Lmu_corr, colour=as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.9, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  #scale_linetype_manual(values=c("equal900" = "dotted", "less900" = "solid"), breaks=c('8', '12', '16', "24", "", "")) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600", "900")) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

GrowthRateSoliExpDay %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, deltaOD_Lmu_corr, colour=as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.9, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  #scale_linetype_manual(values=c("equal900" = "dotted", "less900" = "solid"), breaks=c('8', '12', '16', "24", "", "")) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600", "900")) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

GrowthRateSoliExpDay %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_HalfPar_ue_umolChl_day, deltaOD_Lmu_corr, colour=as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.9, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  #scale_linetype_manual(values=c("equal900" = "dotted", "less900" = "solid"), breaks=c('8', '12', '16', "24", "", "")) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600", "900")) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

GrowthRateSoliExpDay %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_cell_day, deltaOD_Lmu_corr, colour=as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.9, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600", "900")) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

GrowthRateSoliExpDay %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_HalfPar_ue_cell_day, deltaOD_Lmu_corr, colour=as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.9, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600", "900")) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 
```

# Creating mean JVPSII only for plot

```{r}
#colnames(MCGrowthJVPSIISP)

MCGrowthJVPSIISPmean<-GrowthRateSoliExpDay %>% 
  drop_na(JVPSII_umol_eLs_Par_ue_ugChl_day) %>%
  drop_na(JVPSII_umol_eLs_Par_ue_cell_day) %>%
  select(c(Strain, Par_ue, Photoperiod, O2, WL, deltaOD_Lmu_se, deltaOD_Lmu_corr, JVPSII_umol_eLs_Par_ue_ugChl_day, JVPSII_umol_eLs_HalfPar_ue_ugChl_day, JVPSII_umol_eLs_Par_ue_umolChl_day, JVPSII_umol_eLs_HalfPar_ue_umolChl_day, JVPSII_umol_eLs_Par_ue_cell_day, JVPSII_umol_eLs_HalfPar_ue_cell_day)) %>% 
  
  group_by(Strain, Par_ue, Photoperiod, O2, WL) %>%
  summarize(Strain, Par_ue, Photoperiod, O2, WL, deltaOD_Lmu_se, deltaOD_Lmu_corr, JVPSII_umol_eLs_Par_ue_ugChl_day, JVPSII_umol_eLs_HalfPar_ue_ugChl_day, JVPSII_umol_eLs_Par_ue_umolChl_day, JVPSII_umol_eLs_HalfPar_ue_umolChl_day, JVPSII_umol_eLs_Par_ue_cell_day, JVPSII_umol_eLs_HalfPar_ue_cell_day,
    
            meanJVPSII_umol_eLs_Par_ue_ugChl_day = mean(JVPSII_umol_eLs_Par_ue_ugChl_day),
            sdJVPSII_umol_eLs_Par_ue_ugChl_day = sd(JVPSII_umol_eLs_Par_ue_ugChl_day),
            
            meanJVPSII_umol_eLs_Par_ue_umolChl_day = mean(JVPSII_umol_eLs_Par_ue_umolChl_day),
            sdJVPSII_umol_eLs_Par_ue_umolChl_day = sd(JVPSII_umol_eLs_Par_ue_umolChl_day),
            
            meanJVPSII_umol_eLs_Par_ue_cell_day = mean(JVPSII_umol_eLs_Par_ue_cell_day),
            sdJVPSII_umol_eLs_Par_ue_cell_day = sd(JVPSII_umol_eLs_Par_ue_cell_day)) %>%
  ungroup()
  

MCGrowthJVPSIISPmean$facetsStrain <- 'Strain'
```
# Preliminary plot

```{r warning = FALSE}
lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))
lab4=c(expression(""), expression(""), expression(""), expression(""))
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }

MCGrowthJVPSIISPmean %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_ugChl_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600","900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  #labs(y = "Logistic growth rate " ~ "("~d^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  #labs(y = "Chlorophyll specific exponential growth rate " ~ "("~d^-1~")") +
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

MCGrowthJVPSIISPmean %>% 
ggplot() +
  geom_point(aes(meanJVPSII_umol_eLs_Par_ue_ugChl_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600","900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  #labs(y = "Logistic growth rate " ~ "("~d^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  #labs(y = "Chlorophyll specific exponential growth rate " ~ "("~d^-1~")") +
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

MCGrowthJVPSIISPmean %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600","900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  #labs(y = "Logistic growth rate " ~ "("~d^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  #labs(y = "Chlorophyll specific exponential growth rate " ~ "("~d^-1~")") +
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

MCGrowthJVPSIISPmean %>% 
ggplot() +
  geom_point(aes(meanJVPSII_umol_eLs_Par_ue_umolChl_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600","900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  #labs(y = "Logistic growth rate " ~ "("~d^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  #labs(y = "Chlorophyll specific exponential growth rate " ~ "("~d^-1~")") +
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

MCGrowthJVPSIISPmean %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_cell_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600","900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  #labs(y = "Logistic growth rate " ~ "("~d^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  #labs(y = "Chlorophyll specific exponential growth rate " ~ "("~d^-1~")") +
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 

MCGrowthJVPSIISPmean %>% 
ggplot() +
  geom_point(aes(meanJVPSII_umol_eLs_Par_ue_cell_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600","900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  #labs(y = "Logistic growth rate " ~ "("~d^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  #labs(y = "Chlorophyll specific exponential growth rate " ~ "("~d^-1~")") +
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 
```


# Added a Starting Point (SP) at 0 

```{r added starting point}
gs4_deauth()
# this is the URL or ID of a Sheet readable by anyone (with a link)
StartingPointsJVPSII <- read_sheet("https://docs.google.com/spreadsheets/d/1GnGMT-DT_n0Z1wZPWY9suwyY3T5ZPn-dISjcIjpvzFU/edit#gid=0") 

GrowthRateSoliExpDay$facetsStrain <- 'Strain'


GrowthRateSoliExpDaySmallSP<-GrowthRateSoliExpDay %>% 
  dplyr::select(c(Strain, Par_ue, Photoperiod, O2, WL, deltaOD_Lmu_se, deltaOD_Lmu_corr, facetsStrain, JVPSII_umol_eLs_Par_ue_ugChl_day, JVPSII_umol_eLs_HalfPar_ue_ugChl_day, JVPSII_umol_eLs_Par_ue_umolChl_day, JVPSII_umol_eLs_HalfPar_ue_umolChl_day, JVPSII_umol_eLs_Par_ue_cell_day, JVPSII_umol_eLs_HalfPar_ue_cell_day)) 

MCGrowthJVPSIISP<-rbind(GrowthRateSoliExpDaySmallSP, StartingPointsJVPSII)
  
MCGrowthJVPSIISP<-MCGrowthJVPSIISP %>% 
  unique() %>% 
  drop_na(deltaOD_Lmu_corr)

```





------------------------------------------------# per umol chl ------------------------------------------------------

# Estimated Harrison & Platt, 1986 fit - for all uE and each uE separately 

```{r platt fit}
#Harrison & Platt, 1986
grcplatt <- function(I, a, b, Pmax){Pmax * (1-exp(-a*I/Pmax)) * exp(-b*I/Pmax)}

MCGrowthJVPSIIAllFit <- MCGrowthJVPSIISP %>% 
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_umolChl_day, a, b, Pmax), data = .x, start = list(a =0.01/10, b = 10/10000, Pmax = 5), lower = c(0, 0, 0)))) %>%  
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSIIAll <- MCGrowthJVPSIIAllFit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


MCGrowthJVPSII30Fit <- MCGrowthJVPSIISP %>% 
  filter(Par_ue ==30) %>% 
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_umolChl_day, a, b, Pmax), data = .x, start = list(a =0.01/100, b = 10/10000, Pmax = 5), lower = c(0, 0, 0)))) %>%    
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII30 <- MCGrowthJVPSII30Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


MCGrowthJVPSII90Fit <- MCGrowthJVPSIISP %>% 
  filter(Par_ue ==90) %>%  
  nest(data = -c("Strain", "facetsStrain")) %>% 
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_umolChl_day, a, b, Pmax), data = .x, start = list(a =0.01/100, b = 10/10000, Pmax = 5), lower = c(0, 0, 0)))) %>%      
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII90 <- MCGrowthJVPSII90Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


MCGrowthJVPSII180Fit <- MCGrowthJVPSIISP %>% 
  filter(Par_ue ==180) %>%  
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_umolChl_day, a, b, Pmax), data = .x, start = list(a =0.01/100, b = 10/10000, Pmax = 5), lower = c(0, 0, 0)))) %>%    
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII180 <- MCGrowthJVPSII180Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


MCGrowthJVPSII300Fit <- MCGrowthJVPSIISP %>% 
  filter(Par_ue ==300) %>% 
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_umolChl_day, a, b, Pmax), data = .x, start = list(a =0.01/100, b = 10/10000, Pmax = 5), lower = c(0, 0, 0)))) %>%     
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII300 <- MCGrowthJVPSII300Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


# MCGrowthSP600Fit <- MCGrowthSP %>%
#   filter(Par_ue ==600) %>%
#   nest(data = -c("Strain", "facetsStrain")) %>%
#   mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = PARPhotonDose_day, a, b, Pmax),
#          data = .x,start = list(a = 0.1/2e7, b = 0.01/2e7, Pmax = 0.2),lower = c(0, 0, 0)))) %>%
#   mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),
#          GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),
#          GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
# GRCplatt_PredictGrowth600 <- MCGrowthSP600Fit %>%
#   unnest(GRCplatt_Predict)%>%
#   unnest(GRCplatt_Param)


MCGrowthJVPSII900Fit <- MCGrowthJVPSIISP %>% 
  filter(Par_ue ==900 | Par_ue == 600) %>% 
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_umolChl_day, a, b, Pmax), data = .x, start = list(a =0.01/100, b = 10/100000, Pmax = 5), lower = c(0, 0, 0)))) %>%      
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII900 <- MCGrowthJVPSII900Fit %>% 
  unnest(GRCplatt_Predict) %>% 
  unnest(GRCplatt_Param)

rm(MCGrowthJVPSIIAllFit, MCGrowthJVPSII30Fit, MCGrowthJVPSII90Fit, MCGrowthJVPSII180Fit, MCGrowthJVPSII300Fit, MCGrowthJVPSII900Fit)
```

# Estimated Harrison & Platt, 1986 fit - for all Photoperiod and each Photoperiod separately

```{r platt fit, warning = FALSE}
#Harrison & Platt, 1986
grcplatt <- function(I, a, b, Pmax){Pmax * (1-exp(-a*I/Pmax)) * exp(-b*I/Pmax)}

# MCGrowthJVPSIIAllFit <- MCGrowthJVPSIISP %>% 
#   nest(data = -c("Strain", "facetsStrain")) %>%  
#   mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_Par_ue_cell_day, a, b, Pmax), data = .x, start = list(a =0.01/1, b = 1/5, Pmax = 5), lower = c(0, 0, 0)))) %>%  
#   mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
#          GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
#          GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
# GRCplatt_PredictGrowthJVPSIIAll <- MCGrowthJVPSIIAllFit %>% 
#   unnest(GRCplatt_Predict)%>% 
#   unnest(GRCplatt_Param)


MCGrowthJVPSII8Fit <- MCGrowthJVPSIISP %>% 
  filter(Photoperiod ==8) %>% 
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_umolChl_day, a, b, Pmax), data = .x, start = list(a =0.01/100, b = 10/100000, Pmax = 5), lower = c(0, 0, 0)))) %>%    
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII8 <- MCGrowthJVPSII8Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


MCGrowthJVPSII12Fit <- MCGrowthJVPSIISP %>% 
  filter(Photoperiod ==12) %>%  
  nest(data = -c("Strain", "facetsStrain")) %>% 
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_umolChl_day, a, b, Pmax), data = .x, start = list(a =0.01/100, b = 10/100000, Pmax = 5), lower = c(0, 0, 0)))) %>%  
  # mutate(GRCplatt_Model = map(data, possibly(~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_umolChl_day, a, b, Pmax), data = .x, control = list(maxiter = 100), start = list(a =0.01/10, b = 1/100, Pmax = 5), lower = c(0, 0, 0))))) %>%      
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII12 <- MCGrowthJVPSII12Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


MCGrowthJVPSII16Fit <- MCGrowthJVPSIISP %>% 
  filter(Photoperiod ==16) %>%  
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_umolChl_day, a, b, Pmax), data = .x, start = list(a =0.01/100, b = 10/100000, Pmax = 5), lower = c(0, 0, 0)))) %>%    
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII16 <- MCGrowthJVPSII16Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


MCGrowthJVPSII24Fit <- MCGrowthJVPSIISP %>% 
  filter(Photoperiod ==24) %>% 
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_umolChl_day, a, b, Pmax), data = .x, start = list(a =0.01/100, b = 1/100000, Pmax = 5), lower = c(0, 0, 0)))) %>%     
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII24 <- MCGrowthJVPSII24Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)

```


# Preliminary plot

```{r warning = FALSE}
lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))
lab4=c(expression(""), expression(""), expression(""), expression(""))
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }

MCGrowthJVPSIISP %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "blue", size = 0.3, linetype = "solid", show.legend = F, GRCplatt_PredictGrowthJVPSIIAll) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "darkslategray", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowthJVPSII30) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "lightblue4", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowthJVPSII90) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "hotpink4", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowthJVPSII180) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "indianred3", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowthJVPSII300) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "goldenrod2", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowthJVPSII900) +
  scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600","900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  #labs(y = "Logistic growth rate " ~ "("~d^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  #labs(y = "Chlorophyll specific exponential growth rate " ~ "("~d^-1~")") +
  ggh4x::facet_nested(rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  theme_bw() 

MCGrowthJVPSIISP %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "blue", size = 0.3, linetype = "solid", show.legend = F, GRCplatt_PredictGrowthJVPSIIAll) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "black", linetype = "dotted", show.legend = F, GRCplatt_PredictGrowthJVPSII8) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "black", linetype = "longdash", show.legend = F,  GRCplatt_PredictGrowthJVPSII12) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "black", linetype = "dashed", show.legend = F,  GRCplatt_PredictGrowthJVPSII16) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "black", linetype = "dotdash", show.legend = F, GRCplatt_PredictGrowthJVPSII24) +
  scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600","900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  #labs(y = "Logistic growth rate " ~ "("~d^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  #labs(y = "Chlorophyll specific exponential growth rate " ~ "("~d^-1~")") +
  ggh4x::facet_nested(rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  theme_bw() 
```


# Exstracting models for each fit (for each light and all light together)

```{r}
MCGrowthSPAllModel<-GRCplatt_PredictGrowthJVPSIIAll %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSPAllModel$Fit <- 'All'

MCGrowthSP30Model<-GRCplatt_PredictGrowthJVPSII30 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP30Model$Fit <- '30'

MCGrowthSP90Model<-GRCplatt_PredictGrowthJVPSII90 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP90Model$Fit <- '90'
  
MCGrowthSP180Model<-GRCplatt_PredictGrowthJVPSII180 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP180Model$Fit <- '180'
  
MCGrowthSP300Model<-GRCplatt_PredictGrowthJVPSII300 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP300Model$Fit <- '300'
  
MCGrowthSP900Model<-GRCplatt_PredictGrowthJVPSII900 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP900Model$Fit <- '900'
  
MCModelAll_Light<-rbind(MCGrowthSPAllModel, MCGrowthSP30Model, MCGrowthSP90Model, MCGrowthSP180Model, MCGrowthSP300Model, MCGrowthSP900Model)
MCModelAll_Light<-MCModelAll_Light %>% 
  unique()
```

# Exstracting models for each fit (for each photoperiod and all photoperiod together)

```{r}
MCGrowthSPAllModel<-GRCplatt_PredictGrowthJVPSIIAll %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSPAllModel$Fit <- 'All'

MCGrowthSP8Model<-GRCplatt_PredictGrowthJVPSII8 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP8Model$Fit <- '8'

MCGrowthSP12Model<-GRCplatt_PredictGrowthJVPSII12 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP12Model$Fit <- '12'
  
MCGrowthSP16Model<-GRCplatt_PredictGrowthJVPSII16 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP16Model$Fit <- '16'
  
MCGrowthSP24Model<-GRCplatt_PredictGrowthJVPSII24 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP24Model$Fit <- '24'
  

MCModelAll_Photoperiod<-rbind(MCGrowthSPAllModel, MCGrowthSP30Model, MCGrowthSP90Model, MCGrowthSP180Model, MCGrowthSP300Model, MCGrowthSP900Model)
MCModelAll_Photoperiod<-MCModelAll_Photoperiod %>% 
  unique()
```


# Anova from the model - compare fit from all light to selected one light

```{r}
#1->All
#2->30
#3->90
#4->180
#5->300
#6->900
MCModelAll_BA56<-MCModelAll_Light %>% 
  filter(Strain == "PC-rich_056") 
  anova056_30<-anova(MCModelAll_BA56[[2]][[2]], MCModelAll_BA56[[2]][[1]])
  anova056_30$FitComparison <- '30_All'
  anova056_90<-anova(MCModelAll_BA56[[2]][[3]], MCModelAll_BA56[[2]][[1]])
  anova056_90$FitComparison <- '90_All'
  anova056_180<-anova(MCModelAll_BA56[[2]][[4]], MCModelAll_BA56[[2]][[1]])
  anova056_180$FitComparison <- '180_All'
  anova056_300<-anova(MCModelAll_BA56[[2]][[5]], MCModelAll_BA56[[2]][[1]])
  anova056_300$FitComparison <- '300_All'
  anova056_900<-anova(MCModelAll_BA56[[2]][[6]], MCModelAll_BA56[[2]][[1]])
  anova056_900$FitComparison <- '900_All'
  anova056<-rbind(anova056_30, anova056_90, anova056_180, anova056_300, anova056_900)
  rm(anova056_30, anova056_90, anova056_180, anova056_300, anova056_900)
  anova056$Strain <- 'PC-rich_056'
# 30, 300, 900 different

MCModelAll_BA77<-MCModelAll_Light %>% 
  filter(Strain == "PC-rich_077") 
  anova077_30<-anova(MCModelAll_BA77[[2]][[2]], MCModelAll_BA77[[2]][[1]])
  anova077_30$FitComparison <- '30_All'
  anova077_90<-anova(MCModelAll_BA77[[2]][[3]], MCModelAll_BA77[[2]][[1]])
  anova077_90$FitComparison <- '90_All'
  anova077_180<-anova(MCModelAll_BA77[[2]][[4]], MCModelAll_BA77[[2]][[1]])
  anova077_180$FitComparison <- '180_All'
  anova077_300<-anova(MCModelAll_BA77[[2]][[5]], MCModelAll_BA77[[2]][[1]])
  anova077_300$FitComparison <- '300_All'
  anova077_900<-anova(MCModelAll_BA77[[2]][[6]], MCModelAll_BA77[[2]][[1]])
  anova077_900$FitComparison <- '900_All'
  anova077<-rbind(anova077_30, anova077_90, anova077_180, anova077_300, anova077_900)
  rm(anova077_30, anova077_90, anova077_180, anova077_300, anova077_900)
  anova077$Strain <- 'PC-rich_077'
# no different at all

MCModelAll_BA48<-MCModelAll_Light %>% 
  filter(Strain == "PE-rich_048") 
  anova048_30<-anova(MCModelAll_BA48[[2]][[2]], MCModelAll_BA48[[2]][[1]])
  anova048_30$FitComparison <- '30_All'
  anova048_90<-anova(MCModelAll_BA48[[2]][[3]], MCModelAll_BA48[[2]][[1]])
  anova048_90$FitComparison <- '90_All'
  anova048_180<-anova(MCModelAll_BA48[[2]][[4]], MCModelAll_BA48[[2]][[1]])
  anova048_180$FitComparison <- '180_All'
  anova048_300<-anova(MCModelAll_BA48[[2]][[5]], MCModelAll_BA48[[2]][[1]])
  anova048_300$FitComparison <- '300_All'
  anova048_900<-anova(MCModelAll_BA48[[2]][[6]], MCModelAll_BA48[[2]][[1]])
  anova048_900$FitComparison <- '900_All'
  anova048<-rbind(anova048_30, anova048_90, anova048_180, anova048_300, anova048_900)
  rm(anova048_30, anova048_90, anova048_180, anova048_300, anova048_900)
  anova048$Strain <- 'PE-rich_048'
# 900 different 

MCModelAll_BA127<-MCModelAll_Light %>% 
  filter(Strain == "PE-rich_127") 
  anova127_30<-anova(MCModelAll_BA127[[2]][[2]], MCModelAll_BA127[[2]][[1]])
  anova127_30$FitComparison <- '30_All'
  anova127_90<-anova(MCModelAll_BA127[[2]][[3]], MCModelAll_BA127[[2]][[1]])
  anova127_90$FitComparison <- '90_All'
  anova127_180<-anova(MCModelAll_BA127[[2]][[4]], MCModelAll_BA127[[2]][[1]])
  anova127_180$FitComparison <- '180_All'
  anova127_300<-anova(MCModelAll_BA127[[2]][[5]], MCModelAll_BA127[[2]][[1]])
  anova127_300$FitComparison <- '300_All'
  anova127_900<-anova(MCModelAll_BA127[[2]][[6]], MCModelAll_BA127[[2]][[1]])
  anova127_900$FitComparison <- '900_All'
  anova127<-rbind(anova127_30, anova127_90, anova127_180, anova127_300, anova127_900)
  rm(anova127_30, anova127_90, anova127_180, anova127_300, anova127_900)
  anova127$Strain <- 'PE-rich_127'
# 30, 900 different
  
AnovaTest_GrowthRateModel_Light_Chla<-rbind(anova056, anova077, anova048, anova127)

AnovaTest_GrowthRateModel_Light_Chla <-AnovaTest_GrowthRateModel_Light_Chla %>% 
  drop_na(Df) 
rm(anova056, anova077, anova048, anova127, MCModelAll_BA56, MCModelAll_BA77, MCModelAll_BA48, MCModelAll_BA127)
```




# Separate fits per strain - for plots only - based on statistics - Light

```{r}
GRCplatt_PredictGrowth30_BA56<-GRCplatt_PredictGrowthJVPSII30 %>% 
    filter(Strain == "PC-rich_056")
GRCplatt_PredictGrowth300_BA56<-GRCplatt_PredictGrowthJVPSII300 %>% 
    filter(Strain == "PC-rich_056")
GRCplatt_PredictGrowth900_BA56<-GRCplatt_PredictGrowthJVPSII900 %>% 
    filter(Strain == "PC-rich_056")

# GRCplatt_PredictGrowth30_BA77<-GRCplatt_PredictGrowthJVPSII30 %>% 
#     filter(Strain == "PC-rich_077")

GRCplatt_PredictGrowth900_BA48<-GRCplatt_PredictGrowthJVPSII900 %>%
    filter(Strain == "PE-rich_048")

GRCplatt_PredictGrowth30_BA127<-GRCplatt_PredictGrowthJVPSII30 %>% 
    filter(Strain == "PE-rich_127")
GRCplatt_PredictGrowth900_BA127<-GRCplatt_PredictGrowthJVPSII900 %>% 
    filter(Strain == "PE-rich_127")
```

# Anova from the model - compare fit from all photoperiod to selected one photoperiod

```{r}
#1->All
#2->8
#3->12
#4->16
#5->24

MCModelAll_BA56<-MCModelAll_Photoperiod %>% 
  filter(Strain == "PC-rich_056") 
  anova056_8<-anova(MCModelAll_BA56[[2]][[2]], MCModelAll_BA56[[2]][[1]])
  anova056_8$FitComparison <- '8_All'
  anova056_12<-anova(MCModelAll_BA56[[2]][[3]], MCModelAll_BA56[[2]][[1]])
  anova056_12$FitComparison <- '12_All'
  anova056_16<-anova(MCModelAll_BA56[[2]][[4]], MCModelAll_BA56[[2]][[1]])
  anova056_16$FitComparison <- '16_All'
  anova056_24<-anova(MCModelAll_BA56[[2]][[5]], MCModelAll_BA56[[2]][[1]])
  anova056_24$FitComparison <- '24_All'
  anova056_Photoperiod<-rbind(anova056_8, anova056_12, anova056_16, anova056_24)
  rm(anova056_8, anova056_12, anova056_16, anova056_24)
  anova056_Photoperiod$Strain <- 'PC-rich_056'
# 8 and 24 - different

MCModelAll_BA77<-MCModelAll_Photoperiod %>% 
  filter(Strain == "PC-rich_077") 
  anova077_8<-anova(MCModelAll_BA77[[2]][[2]], MCModelAll_BA77[[2]][[1]])
  anova077_8$FitComparison <- '8_All'
  anova077_12<-anova(MCModelAll_BA77[[2]][[3]], MCModelAll_BA77[[2]][[1]])
  anova077_12$FitComparison <- '12_All'
  anova077_16<-anova(MCModelAll_BA77[[2]][[4]], MCModelAll_BA77[[2]][[1]])
  anova077_16$FitComparison <- '16_All'
  anova077_24<-anova(MCModelAll_BA77[[2]][[5]], MCModelAll_BA77[[2]][[1]])
  anova077_24$FitComparison <- '24_All'
  anova077_Photoperiod<-rbind(anova077_8, anova077_12, anova077_16, anova077_24)
  rm(anova077_8, anova077_12, anova077_16, anova077_24)
  anova077_Photoperiod$Strain <- 'PC-rich_077'
# no different

MCModelAll_BA48<-MCModelAll_Photoperiod %>% 
  filter(Strain == "PE-rich_048") 
  anova048_8<-anova(MCModelAll_BA48[[2]][[2]], MCModelAll_BA48[[2]][[1]])
  anova048_8$FitComparison <- '8_All'
  anova048_12<-anova(MCModelAll_BA48[[2]][[3]], MCModelAll_BA48[[2]][[1]])
  anova048_12$FitComparison <- '12_All'
  anova048_16<-anova(MCModelAll_BA48[[2]][[4]], MCModelAll_BA48[[2]][[1]])
  anova048_16$FitComparison <- '16_All'
  anova048_24<-anova(MCModelAll_BA48[[2]][[5]], MCModelAll_BA48[[2]][[1]])
  anova048_24$FitComparison <- '24_All'
  anova048_Photoperiod<-rbind(anova048_8, anova048_12, anova048_16, anova048_24)
  rm(anova048_8, anova048_12, anova048_16, anova048_24)
  anova048_Photoperiod$Strain <- 'PE-rich_048'
# no different 

MCModelAll_BA127<-MCModelAll_Photoperiod %>% 
  filter(Strain == "PE-rich_127") 
  anova127_8<-anova(MCModelAll_BA127[[2]][[2]], MCModelAll_BA127[[2]][[1]])
  anova127_8$FitComparison <- '8_All'
  anova127_12<-anova(MCModelAll_BA127[[2]][[3]], MCModelAll_BA127[[2]][[1]])
  anova127_12$FitComparison <- '12_All'
  anova127_16<-anova(MCModelAll_BA127[[2]][[4]], MCModelAll_BA127[[2]][[1]])
  anova127_16$FitComparison <- '16_All'
  anova127_24<-anova(MCModelAll_BA127[[2]][[5]], MCModelAll_BA127[[2]][[1]])
  anova127_24$FitComparison <- '24_All'
  anova127_Photoperiod<-rbind(anova127_8, anova127_12, anova127_16, anova127_24)
  rm(anova127_8, anova127_12, anova127_16, anova127_24)
  anova127_Photoperiod$Strain <- 'PE-rich_127'
# 8 different
  
AnovaTest_GrowthRateModel_Photoperiod_Chla<-rbind(anova056_Photoperiod, anova077_Photoperiod, anova048_Photoperiod, anova127_Photoperiod)

AnovaTest_GrowthRateModel_Photoperiod_Chla <-AnovaTest_GrowthRateModel_Photoperiod_Chla %>% 
  drop_na(Df) 

rm(anova056_Photoperiod, anova077_Photoperiod, anova048_Photoperiod, anova127_Photoperiod, MCModelAll_BA56, MCModelAll_BA77, MCModelAll_BA48, MCModelAll_BA127)
```

# Save RDS that create stats and tables


```{r}
saveRDS(AnovaTest_GrowthRateModel_Light_Chla, file.path(TableRdsPath, paste(Project, "Anova_GrowthRateJVPSII_Model_Light_Chla.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)

saveRDS(AnovaTest_GrowthRateModel_Photoperiod_Chla, file.path(TableRdsPath, paste(Project, "Anova_GrowthRateJVPSII_Model_Photoperiod_Chla.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)

```

# Separate fits per strain - for plots only - based on statistics - Photoperiod

```{r}
GRCplatt_PredictGrowth8_BA56<-GRCplatt_PredictGrowthJVPSII8 %>% 
    filter(Strain == "PC-rich_056")
GRCplatt_PredictGrowth24_BA56<-GRCplatt_PredictGrowthJVPSII24 %>% 
    filter(Strain == "PC-rich_056")

# GRCplatt_PredictGrowth8_BA77<-GRCplatt_PredictGrowthJVPSII8 %>% 
#     filter(Strain == "PC-rich_077")

# GRCplatt_PredictGrowth900_BA48<-GRCplatt_PredictGrowthJVPSII900 %>% 
#     filter(Strain == "PE-rich_048")

GRCplatt_PredictGrowth8_BA127<-GRCplatt_PredictGrowthJVPSII8 %>% 
    filter(Strain == "PE-rich_127")
```

# Create plot and change the unit of JVPSII - umol

```{r fig.height = 8, fig.width = 8, warning = FALSE, warning = FALSE}
data_textA <- data.frame(facetsStrain  = c("Strain"), Strain  = c("PC-rich_056"), label = c('A'))

k_data056 = data.frame(facetsStrain  = c("Strain"), Strain  = c("PC-rich_056"))
k_data077 = data.frame(facetsStrain  = c("Strain"), Strain  = c("PC-rich_077"))
k_data048 = data.frame(facetsStrain  = c("Strain"), Strain  = c("PE-rich_048"))
k_data127 = data.frame(facetsStrain  = c("Strain"), Strain  = c("PE-rich_127"))


lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))
lab4=c(expression(""), expression(""), expression(""), expression(""))
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }

PlotALightJVPSII<-MCGrowthJVPSIISP %>% 
ggplot() +
  # geom_point(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "blue", size = 0.3, linetype = "solid", show.legend = F, GRCplatt_PredictGrowthJVPSIIAll) +
  
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "darkslategray", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowth30_BA56) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "indianred3", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowth300_BA56) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "goldenrod2", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowth900_BA56) +
  
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "goldenrod2", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowth900_BA48) +
  
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "darkslategray", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowth30_BA127) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "goldenrod2", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowth900_BA127) +
  geom_text(data=data_textA, aes(x=0, y=4, label=label), size=6) +
  
  geom_segment(data = k_data056, aes(x =2e05, y = -Inf, xend = 2e05, yend = Inf), color = "seagreen4", size = 6, alpha = 0.7) +
  geom_segment(data = k_data077, aes(x =2e05, y = -Inf, xend = 2e05, yend = Inf), color = "palegreen3", size = 6, alpha = 0.7) +
  geom_segment(data = k_data048, aes(x =2e05, y = -Inf, xend = 2e05, yend = Inf), color = "brown1", size = 6, alpha = 0.7) +
  geom_segment(data = k_data127, aes(x =2e05, y = -Inf, xend = 2e05, yend = Inf), color = "brown4", size = 6, alpha = 0.7) +
  
  #scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600","900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  
  scale_x_continuous(breaks=seq(0, 1.94e05, by = 0.5e05), label=scientific_10) +
  coord_cartesian(xlim = c(0, 1.94e05)) +
  
  # labs(y = "Chlorophyll specific exponential growth rate " ~ "("~d^-1~")", x = ""~italic(JV)~""["PSII"]*" ("~e^-~""~Chla^-1~""~d^-1~")") +
  # labs(y = "Chlorophyll specific exponential growth rate " ~ "("~d^-1~")", x = ""~italic(JV)~""["PSII"]*" (µmol"~e^-~""~µg~Chla^-1~""~d^-1~")") +
  labs(y = "Chlorophyll-specific exponential growth rate " ~ "("~d^-1~")", x = ""~italic(JV)~""["PSII"]*" (µmol"~e^-~""~µmol~Chl~italic(a)~""^-1~""~d^-1~")") +
  ggh4x::facet_nested(rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        # strip.background = element_rect(fill="white"),
        strip.background = element_blank(),
        #strip.text = element_text(size=12),
        strip.text = element_blank(),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.85,0.88),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        legend.spacing.x = unit(-0.1, 'cm'),
        legend.title = element_blank(),
        legend.text = element_text(size=11))
PlotALightJVPSII

# g <- ggplot_gtable(ggplot_build(PlotALightJVPSII))
# stripr <- which(grepl('strip-r', g$layout$name))
# fills <- c("seagreen4","palegreen3","brown1", "brown4")
# k <- 1
# for (i in stripr) {
# j <- which(grepl('rect', g$grobs[[i]]$grobs[[1]]$childrenOrder))
# g$grobs[[i]]$grobs[[1]]$children[[j]]$gp$fill <- fills[k]
# k <- k+1
# }
# grid.draw(g)
```

# Save plot 

```{r save plot}
# ggsave(file = file.path(FigPath, paste("Fig_GrowthRate_JVPSII_Light_Chla",".png",sep = "")), height=9, width= 7,  dpi = 300, limitsize = TRUE)
```




```{r fig.height = 8, fig.width = 8, warning = FALSE, warning = FALSE}
scientific_10 <- function(y) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(y))) }
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }

data_textA <- data.frame(facetsStrain  = c("Strain"), Strain  = c("PC-rich_056"), label = c('A'))

PlotAPhotoperiodJVPSII<-MCGrowthJVPSIISP %>% 
ggplot() +
  # geom_point(aes(meanJVPSII_umol_eLs_Par_ue_umolChl_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T, MCGrowthJVPSIISPmean) +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "blue", size = 0.3, linetype = "solid", show.legend = F, GRCplatt_PredictGrowthJVPSIIAll) +
  
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "black", linetype = "dotted", size = 0.6, show.legend = F, GRCplatt_PredictGrowth8_BA56) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "black", linetype = "dotdash", size = 0.6, show.legend = F,  GRCplatt_PredictGrowth24_BA56) +
  
  geom_line(aes(JVPSII_umol_eLs_Par_ue_umolChl_day, .fitted), colour = "black", linetype = "dotted", size = 0.6, show.legend = F, GRCplatt_PredictGrowth8_BA127) +
  geom_text(data=data_textA, aes(x=0, y=4, label=label), size=6) +

  geom_segment(data = k_data056, aes(x =2e05, y = -Inf, xend = 2e05, yend = Inf), color = "seagreen4", size = 6, alpha = 0.7) +
  geom_segment(data = k_data077, aes(x =2e05, y = -Inf, xend = 2e05, yend = Inf), color = "palegreen3", size = 6, alpha = 0.7) +
  geom_segment(data = k_data048, aes(x =2e05, y = -Inf, xend = 2e05, yend = Inf), color = "brown1", size = 6, alpha = 0.7) +
  geom_segment(data = k_data127, aes(x =2e05, y = -Inf, xend = 2e05, yend = Inf), color = "brown4", size = 6, alpha = 0.7) +
  
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600","900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  

  
  # labs(y = "Chlorophyll specific exponential growth rate " ~ "("~d^-1~")", x = ""~italic(JV)~""["PSII"]*" ("~e^-~""~Chla^-1~""~d^-1~")") +
    # labs(y = "Chlorophyll specific exponential growth rate " ~ "("~d^-1~")", x = ""~italic(JV)~""["PSII"]*" ("~e^-~""~Chl~italic(a)~""^-1~""~d^-1~")") +
    labs(y = "Chlorophyll-specific exponential growth rate " ~ "("~d^-1~")", x = ""~italic(JV)~""["PSII"]*" (µmol"~e^-~""~µmol~Chl~italic(a)~""^-1~""~d^-1~")") +
  #scale_x_continuous(label=scientific_10) +
  # scale_y_continuous(breaks=seq(0, 4.5, by = 1)) +
  # coord_cartesian(ylim = c(0, 4.5)) +
  
  scale_x_continuous(breaks=seq(0, 1.94e05, by = 0.5e05), label=scientific_10) +
  coord_cartesian(xlim = c(0, 1.94e05)) +
  
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        #strip.background = element_rect(fill="white"),
        strip.background = element_blank(),
        #strip.text = element_text(size=12),
        strip.text = element_blank(),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.85,0.88),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        legend.spacing.x = unit(-0.1, 'cm'),
        legend.title = element_blank(),
        #panel.spacing.y = unit(0.4, 'cm'),
        legend.text = element_text(size=11))
PlotAPhotoperiodJVPSII

# g <- ggplot_gtable(ggplot_build(PlotAPhotoperiodJVPSII))
# stripr <- which(grepl('strip-r', g$layout$name))
# fills <- c("seagreen4","palegreen3","brown1", "brown4")
# k <- 1
# for (i in stripr) {
# j <- which(grepl('rect', g$grobs[[i]]$grobs[[1]]$childrenOrder))
# g$grobs[[i]]$grobs[[1]]$children[[j]]$gp$fill <- fills[k]
# k <- k+1
# }
# grid.draw(g)
```
# Save plot 

```{r save plot}
# ggsave(file = file.path(FigPath, paste("Fig_GrowthRate_JVPSII_Photoperiod_Chla",".png",sep = "")), height=9, width= 7,  dpi = 300, limitsize = TRUE)
```


# Exstracting parameters from each fit (for each light and all light together)

```{r}
GrowthRateAllParam<-GRCplatt_PredictGrowthJVPSIIAll %>%
  dplyr::select(c(Strain, term, estimate, std.error, statistic, p.value)) %>%
  unique()
  GrowthRateAllParam$Fit <- 'All'

GrowthRate30Param<-GRCplatt_PredictGrowthJVPSII30 %>%
  dplyr::select(c(Strain, term, estimate, std.error, statistic, p.value)) %>%
  unique()
  GrowthRate30Param$Fit <- '30'

GrowthRate90Param<-GRCplatt_PredictGrowthJVPSII90 %>%
  dplyr::select(c(Strain, term, estimate, std.error, statistic, p.value)) %>%
  unique()
  GrowthRate90Param$Fit <- '90'

GrowthRate180Param<-GRCplatt_PredictGrowthJVPSII180 %>%
  dplyr::select(c(Strain, term, estimate, std.error, statistic, p.value)) %>%
  unique()
  GrowthRate180Param$Fit <- '180'

GrowthRate300Param<-GRCplatt_PredictGrowthJVPSII300 %>%
  dplyr::select(c(Strain, term, estimate, std.error, statistic, p.value)) %>%
  unique()
  GrowthRate300Param$Fit <- '300'

GrowthRate900Param<-GRCplatt_PredictGrowthJVPSII900 %>%
  dplyr::select(c(Strain, term, estimate, std.error, statistic, p.value)) %>%
  unique()
  GrowthRate900Param$Fit <- '900'

JVPSIIParamAll_Light<-rbind(GrowthRateAllParam, GrowthRate30Param, GrowthRate90Param, GrowthRate180Param, GrowthRate300Param, GrowthRate900Param)

JVPSIIParamAll_Light<-JVPSIIParamAll_Light %>%
  unique()

rm(GrowthRate30Param, GrowthRate90Param, GrowthRate180Param, GrowthRate300Param, GrowthRate900Param)
```

# Exstracting parameters from each fit (for each photoperiod and all photoperiod together)

```{r}
# GrowthRateAllParam<-GRCplatt_PredictGrowthJVPSIIAll %>%
#   dplyr::select(c(Strain, term, estimate, std.error, statistic, p.value)) %>%
#   unique()
#   GrowthRateAllParam$Fit <- 'All'

GrowthRate8Param<-GRCplatt_PredictGrowthJVPSII8 %>%
  dplyr::select(c(Strain, term, estimate, std.error, statistic, p.value)) %>%
  unique()
  GrowthRate8Param$Fit <- '8'

GrowthRate12Param<-GRCplatt_PredictGrowthJVPSII12 %>%
  dplyr::select(c(Strain, term, estimate, std.error, statistic, p.value)) %>%
  unique()
  GrowthRate12Param$Fit <- '12'

GrowthRate16Param<-GRCplatt_PredictGrowthJVPSII16 %>%
  dplyr::select(c(Strain, term, estimate, std.error, statistic, p.value)) %>%
  unique()
  GrowthRate16Param$Fit <- '16'

GrowthRate24Param<-GRCplatt_PredictGrowthJVPSII24 %>%
  dplyr::select(c(Strain, term, estimate, std.error, statistic, p.value)) %>%
  unique()
  GrowthRate24Param$Fit <- '24'


JVPSIIParamAll_Photoperiod<-rbind(GrowthRateAllParam, GrowthRate8Param, GrowthRate12Param, GrowthRate16Param, GrowthRate24Param)

JVPSIIParamAll_Photoperiod<-JVPSIIParamAll_Photoperiod %>%
  unique()

rm(GrowthRate8Param, GrowthRate12Param, GrowthRate16Param, GrowthRate24Param)
```

# Create preliminary plot from parameters

```{r preliminary plot}

JVPSIIParamAll_Light %>% 
  filter(term == "a") %>% 
  filter(Fit!= "All") %>% 
  ggplot() +
  geom_point(aes(x = as.numeric(Fit), y = estimate, color = Strain)) +
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed, scales = "free") +
  theme_bw()

JVPSIIParamAll_Photoperiod %>% 
  filter(term == "a") %>% 
  filter(Fit!= "All") %>% 
  ggplot() +
  geom_point(aes(x = as.numeric(Fit), y = estimate, color = Strain)) +
  ggh4x::facet_nested(rows = vars(Strain), labeller = label_parsed, scales = "free") +
  theme_bw()

```
```{r preliminary plot, fig.height = 8, fig.width = 8, warning = FALSE}
scientific_10 <- function(y) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(y))) }
data_textB <- data.frame(facetsStrain  = c("Strain"), Strain  = c("PC-rich_056"), label = c('B'))

JVPSIIParamAll_Photoperiod$facetsStrain <- 'Strain'

JVPSIIParamAll_PhotoperiodAll<-JVPSIIParamAll_Photoperiod %>% 
  filter(term == "a") %>% 
  filter(Fit== "All") %>% 
  rename(SE="std.error") 


PlotBPhotoperiodJVPSII<-JVPSIIParamAll_Photoperiod %>% 
  filter(term == "a") %>% 
  filter(Fit!= "All") %>% 
  rename(SE="std.error") %>% 
  ggplot() +
  geom_point(aes(x = as.numeric(Fit), y = estimate), data = . %>% filter(estimate<0.02), size = 2.5, alpha = 0.8, show.legend = F) +
  geom_line(aes(x = as.numeric(Fit), y = estimate), data = . %>% filter(estimate<0.02), linetype = "dashed", size = 0.5, alpha = 0.8, show.legend = F) +
  geom_errorbar(aes(x = as.numeric(Fit), ymin = estimate - SE, ymax = estimate + SE), width=0, size=0.3, data = . %>% filter(SE<0.02), show.legend = F) +
  #geom_ribbon(aes(x = as.numeric(Fit), ymin = estimate - SE, ymax = estimate + SE), show.legend = F, alpha = 0.1) +
  
  
  geom_hline(data = JVPSIIParamAll_PhotoperiodAll, aes(yintercept = estimate), linetype="solid", colour = "blue", size=0.4) +
  
  # geom_errorbar(aes(x = as.numeric(Fit), ymin = estimate - SE, ymax = estimate + SE), width=0, size=0.3, show.legend = F, data = JVPSIIParamAll_PhotoperiodAll) +
  
  geom_rect(xmin=-Inf, xmax=Inf, aes(ymin = estimate - SE, ymax = estimate + SE), show.legend = F, data = JVPSIIParamAll_PhotoperiodAll, fill = "blue", alpha = 0.1) +
  
  geom_text(data=data_textB, aes(x=8, y=0.0017, label=label), size=6) +
  
  geom_segment(data = k_data056, aes(x =25, y = -Inf, xend = 25, yend = Inf), color = "seagreen4", size = 6, alpha = 0.7) +
  geom_segment(data = k_data077, aes(x =25, y = -Inf, xend = 25, yend = Inf), color = "palegreen3", size = 6, alpha = 0.7) +
  geom_segment(data = k_data048, aes(x =25, y = -Inf, xend = 25, yend = Inf), color = "brown1", size = 6, alpha = 0.7) +
  geom_segment(data = k_data127, aes(x =25, y = -Inf, xend = 25, yend = Inf), color = "brown4", size = 6, alpha = 0.7) +
  
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="") +
  scale_y_continuous(breaks=seq(0, 0.0020, by = 0.0005), label=scientific_10) +
  scale_x_continuous(limits = c(8, 25), breaks = c(8, 12, 16, 24)) +
  coord_cartesian(ylim = c(0, 0.0020), xlim = c(8, 24.5)) +
  labs(y = "\u03B1", x = "Photoperiod (h)") +
  ggh4x::facet_nested(rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="white"),
        legend.position = c(0.8,0.9),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        legend.spacing.x = unit(-0.1, 'cm'),
        legend.title = element_blank(),
        #panel.spacing.y = unit(0.4, 'cm'),
        legend.text = element_text(size=11))
PlotBPhotoperiodJVPSII

# g <- ggplot_gtable(ggplot_build(PlotB))
# stripr <- which(grepl('strip-r', g$layout$name))
# fills <- c("white","seagreen4","palegreen3","brown1", "brown4")
# k <- 1
# for (i in stripr) {
# j <- which(grepl('rect', g$grobs[[i]]$grobs[[1]]$childrenOrder))
# g$grobs[[i]]$grobs[[1]]$children[[j]]$gp$fill <- fills[k]
# k <- k+1
# }
# grid.draw(g)
```

```{r, warning = FALSE, fig.height = 9, fig.width = 12}
ggp<- (PlotAPhotoperiodJVPSII+PlotBPhotoperiodJVPSII) 
ggp                           
```

# Save plot 

```{r save plot}
ggsave(file = file.path(FigPath, paste("Fig_GrowthRate_JVPSII_Photoperiod_Chla",".png",sep = "")), height=9, width= 12,  dpi = 300, limitsize = TRUE)
```



```{r preliminary plot, fig.height = 8, fig.width = 8, warning = FALSE}
scientific_10 <- function(y) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(y))) }
data_textB <- data.frame(facetsStrain  = c("Strain"), Strain  = c("PC-rich_056"), label = c('B'))

JVPSIIParamAll_Light$facetsStrain <- 'Strain'

JVPSIIParamAll_LightAll<-JVPSIIParamAll_Light %>% 
  filter(term == "a") %>% 
  filter(Fit== "All") %>% 
  rename(SE="std.error") 


PlotBLightJVPSII<-JVPSIIParamAll_Light %>% 
  filter(term == "a") %>% 
  filter(Fit!= "All") %>% 
  rename(SE="std.error") %>% 
  ggplot() +
  geom_point(aes(x = as.numeric(Fit), y = estimate), size = 2.5, alpha = 0.8, show.legend = F) +
  geom_line(aes(x = as.numeric(Fit), y = estimate), linetype = "dotted", size = 0.5, alpha = 0.8, show.legend = F) +
  geom_errorbar(aes(x = as.numeric(Fit), ymin = estimate - SE, ymax = estimate + SE), width=0, size=0.3, data = . %>% filter(SE<0.02), show.legend = F) +
  
  geom_hline(data = JVPSIIParamAll_PhotoperiodAll, aes(yintercept = estimate), linetype="solid", colour = "blue", size=0.4) +
  geom_rect(xmin=-Inf, xmax=Inf, aes(ymin = estimate - SE, ymax = estimate + SE), show.legend = F, data = JVPSIIParamAll_LightAll, fill = "blue", alpha = 0.1) +
  
  geom_segment(data = k_data056, aes(x =930, y = -Inf, xend = 930, yend = Inf), color = "seagreen4", size = 6, alpha = 0.7) +
  geom_segment(data = k_data077, aes(x =930, y = -Inf, xend = 930, yend = Inf), color = "palegreen3", size = 6, alpha = 0.7) +
  geom_segment(data = k_data048, aes(x =930, y = -Inf, xend = 930, yend = Inf), color = "brown1", size = 6, alpha = 0.7) +
  geom_segment(data = k_data127, aes(x =930, y = -Inf, xend = 930, yend = Inf), color = "brown4", size = 6, alpha = 0.7) +
  
  geom_text(data=data_textB, aes(x=30, y=0.035, label=label), size=6) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="") +
  scale_y_continuous(breaks=seq(0, 0.040, by = 0.01), label=scientific_10) +
  scale_x_continuous(limits = c(30, 930), breaks = c(30, 90, 180, 300, 600, 900)) +
  coord_cartesian(ylim = c(0, 0.040), xlim = c(30, 905)) +
  labs(y = "\u03B1", x = "PAR ( µmol photons "~m^-2~""~s^-1~")") +
  ggh4x::facet_nested(rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="transparent"),
        strip.text = element_text(size=14),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.8,0.9),
        legend.text = element_text(size=11))
PlotBLightJVPSII


# g <- ggplot_gtable(ggplot_build(PlotB))
# stripr <- which(grepl('strip-r', g$layout$name))
# fills <- c("white","seagreen4","palegreen3","brown1", "brown4")
# k <- 1
# for (i in stripr) {
# j <- which(grepl('rect', g$grobs[[i]]$grobs[[1]]$childrenOrder))
# g$grobs[[i]]$grobs[[1]]$children[[j]]$gp$fill <- fills[k]
# k <- k+1
# }
# grid.draw(g)
```


```{r, warning = FALSE, fig.height = 9, fig.width = 12}
ggp<- PlotALightJVPSII+PlotBLightJVPSII  
ggp                           
```


# Save plot 

```{r save plot}
ggsave(file = file.path(FigPath, paste("SFig_GrowthRate_JVPSII_Light_Chla",".png",sep = "")), height=9, width= 12,  dpi = 300, limitsize = TRUE)
```



# Save RDS that create stats and tables

```{r}
saveRDS(JVPSIIParamAll_Light, file.path(TableRdsPath, paste(Project, "Tab_GrowthRateJVPSII_FitParam_Light.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)

saveRDS(JVPSIIParamAll_Photoperiod, file.path(TableRdsPath, paste(Project, "Tab_GrowthRateJVPSII_FitParam_Photoperiod.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)
```

# Save RDS that create stats and tables

```{r}
# saveRDS(JVPSIIParamAll_Photoperiod, file.path(DataOut, paste(Project, "Tab_Param_GrowthJVPSII_Photoperiod.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)
# 
# saveRDS(JVPSIIParamAll_Light, file.path(DataOut, paste(Project, "Tab_Param_GrowthJVPSII_Light.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)
```





------------------------------------------------# per cell ------------------------------------------------------

# Estimated Harrison & Platt, 1986 fit - for all uE and each uE separately 

```{r platt fit}
#Harrison & Platt, 1986
grcplatt <- function(I, a, b, Pmax){Pmax * (1-exp(-a*I/Pmax)) * exp(-b*I/Pmax)}

MCGrowthJVPSIIAllFit <- MCGrowthJVPSIISP %>% 
  #drop_na(JVPSII_umol_eLs_Par_ue_cell_day) %>% 
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_cell_day, a, b, Pmax), data = .x, start = list(a =0.01/1e-06, b = 1/1e-07, Pmax = 5), lower = c(0, 0, 0)))) %>%  
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSIIAll <- MCGrowthJVPSIIAllFit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


MCGrowthJVPSII30Fit <- MCGrowthJVPSIISP %>% 
  drop_na(JVPSII_umol_eLs_Par_ue_cell_day) %>% 
  filter(Par_ue ==30) %>% 
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_cell_day, a, b, Pmax), data = .x, start = list(a =0.01/1e-08, b = 1/7e-09, Pmax = 5), lower = c(0, 0, 0)))) %>%    
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII30 <- MCGrowthJVPSII30Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


MCGrowthJVPSII90Fit <- MCGrowthJVPSIISP %>% 
  filter(Par_ue ==90) %>%  
  nest(data = -c("Strain", "facetsStrain")) %>% 
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_cell_day, a, b, Pmax), data = .x, start = list(a =0.01/1e-09, b = 1/5e-09, Pmax = 5), lower = c(0, 0, 0)))) %>%      
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII90 <- MCGrowthJVPSII90Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


MCGrowthJVPSII180Fit <- MCGrowthJVPSIISP %>% 
  filter(Par_ue ==180) %>%  
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_cell_day, a, b, Pmax), data = .x, start = list(a =0.01/1e-09, b = 1/5e-09, Pmax = 5), lower = c(0, 0, 0)))) %>%    
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII180 <- MCGrowthJVPSII180Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


MCGrowthJVPSII300Fit <- MCGrowthJVPSIISP %>% 
  filter(Par_ue ==300) %>% 
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_cell_day, a, b, Pmax), data = .x, start = list(a =0.01/1e-06, b = 1/1e-07, Pmax = 5), lower = c(0, 0, 0)))) %>%     
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII300 <- MCGrowthJVPSII300Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


# MCGrowthSP600Fit <- MCGrowthSP %>%
#   filter(Par_ue ==600) %>%
#   nest(data = -c("Strain", "facetsStrain")) %>%
#   mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = PARPhotonDose_day, a, b, Pmax),
#          data = .x,start = list(a = 0.1/2e7, b = 0.01/2e7, Pmax = 0.2),lower = c(0, 0, 0)))) %>%
#   mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),
#          GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),
#          GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
# GRCplatt_PredictGrowth600 <- MCGrowthSP600Fit %>%
#   unnest(GRCplatt_Predict)%>%
#   unnest(GRCplatt_Param)


MCGrowthJVPSII900Fit <- MCGrowthJVPSIISP %>% 
  #drop_na(JVPSII_umol_eLs_Par_ue_cell_day) %>% 
  filter(Par_ue ==900 | Par_ue == 600) %>% 
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_cell_day, a, b, Pmax), data = .x, start = list(a =0.01/1e-06, b = 1/1e-07, Pmax = 5), lower = c(0, 0, 0)))) %>%      
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII900 <- MCGrowthJVPSII900Fit %>% 
  unnest(GRCplatt_Predict) %>% 
  unnest(GRCplatt_Param)

rm(MCGrowthJVPSIIAllFit, MCGrowthJVPSII30Fit, MCGrowthJVPSII90Fit, MCGrowthJVPSII180Fit, MCGrowthJVPSII300Fit, MCGrowthJVPSII900Fit)
```

# Estimated Harrison & Platt, 1986 fit - for all Photoperiod and each Photoperiod separately

```{r platt fit, warning = FALSE}
#Harrison & Platt, 1986
grcplatt <- function(I, a, b, Pmax){Pmax * (1-exp(-a*I/Pmax)) * exp(-b*I/Pmax)}

# MCGrowthJVPSIIAllFit <- MCGrowthJVPSIISP %>%
#   nest(data = -c("Strain", "facetsStrain")) %>%
#   mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_Par_ue_cell_day, a, b, Pmax), data = .x, start = list(a =0.01/1, b = 1/5, Pmax = 5), lower = c(0, 0, 0)))) %>%
#   mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),
#          GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),
#          GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
# GRCplatt_PredictGrowthJVPSIIAll <- MCGrowthJVPSIIAllFit %>%
#   unnest(GRCplatt_Predict)%>%
#   unnest(GRCplatt_Param)


MCGrowthJVPSII8Fit <- MCGrowthJVPSIISP %>% 
  filter(Photoperiod ==8) %>% 
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_cell_day, a, b, Pmax), data = .x, start = list(a =0.01/1e-08, b = 1/7e-09, Pmax = 5), lower = c(0, 0, 0)))) %>%
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII8 <- MCGrowthJVPSII8Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


MCGrowthJVPSII12Fit <- MCGrowthJVPSIISP %>% 
  filter(Photoperiod ==12) %>%  
  nest(data = -c("Strain", "facetsStrain")) %>% 
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_cell_day, a, b, Pmax), data = .x, start = list(a =0.01/1e-08, b = 1/7e-09, Pmax = 5), lower = c(0, 0, 0)))) %>%
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII12 <- MCGrowthJVPSII12Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


MCGrowthJVPSII16Fit <- MCGrowthJVPSIISP %>% 
  filter(Photoperiod ==16) %>%  
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_cell_day, a, b, Pmax), data = .x, start = list(a =0.01/1e-08, b = 1/7e-09, Pmax = 5), lower = c(0, 0, 0)))) %>%
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII16 <- MCGrowthJVPSII16Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)


MCGrowthJVPSII24Fit <- MCGrowthJVPSIISP %>% 
  filter(Photoperiod ==24) %>% 
  nest(data = -c("Strain", "facetsStrain")) %>%  
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = JVPSII_umol_eLs_Par_ue_cell_day, a, b, Pmax), data = .x, start = list(a =0.01/1e-08, b = 1/7e-09, Pmax = 5), lower = c(0, 0, 0)))) %>%
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance)))
GRCplatt_PredictGrowthJVPSII24 <- MCGrowthJVPSII24Fit %>% 
  unnest(GRCplatt_Predict)%>% 
  unnest(GRCplatt_Param)

rm(MCGrowthJVPSII8Fit, MCGrowthJVPSII16Fit, MCGrowthJVPSII24Fit)
```


# Preliminary plot

```{r warning = FALSE}
lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))
lab4=c(expression(""), expression(""), expression(""), expression(""))
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }

MCGrowthJVPSIISP %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_cell_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "blue", size = 0.3, linetype = "solid", show.legend = F, GRCplatt_PredictGrowthJVPSIIAll) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "darkslategray", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowthJVPSII30) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "lightblue4", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowthJVPSII90) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "hotpink4", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowthJVPSII180) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "indianred3", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowthJVPSII300) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "goldenrod2", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowthJVPSII900) +
  scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600","900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  #labs(y = "Logistic growth rate " ~ "("~d^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  #labs(y = "Chlorophyll specific exponential growth rate " ~ "("~d^-1~")") +
  ggh4x::facet_nested(rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  theme_bw() 

MCGrowthJVPSIISP %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_cell_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "blue", size = 0.3, linetype = "solid", show.legend = F, GRCplatt_PredictGrowthJVPSIIAll) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "black", linetype = "dotted", show.legend = F, GRCplatt_PredictGrowthJVPSII8) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "black", linetype = "longdash", show.legend = F,  GRCplatt_PredictGrowthJVPSII12) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "black", linetype = "dashed", show.legend = F,  GRCplatt_PredictGrowthJVPSII16) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "black", linetype = "dotdash", show.legend = F, GRCplatt_PredictGrowthJVPSII24) +
  scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600","900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  #labs(y = "Logistic growth rate " ~ "("~d^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  #labs(y = "Chlorophyll specific exponential growth rate " ~ "("~d^-1~")") +
  ggh4x::facet_nested(rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  theme_bw() 
```

# Exstracting models for each fit (for each light and all light together)

```{r}
MCGrowthSPAllModel<-GRCplatt_PredictGrowthJVPSIIAll %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSPAllModel$Fit <- 'All'

MCGrowthSP30Model<-GRCplatt_PredictGrowthJVPSII30 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP30Model$Fit <- '30'

MCGrowthSP90Model<-GRCplatt_PredictGrowthJVPSII90 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP90Model$Fit <- '90'
  
MCGrowthSP180Model<-GRCplatt_PredictGrowthJVPSII180 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP180Model$Fit <- '180'
  
MCGrowthSP300Model<-GRCplatt_PredictGrowthJVPSII300 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP300Model$Fit <- '300'
  
MCGrowthSP900Model<-GRCplatt_PredictGrowthJVPSII900 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP900Model$Fit <- '900'
  
MCModelAll_Light<-rbind(MCGrowthSPAllModel, MCGrowthSP30Model, MCGrowthSP90Model, MCGrowthSP180Model, MCGrowthSP300Model, MCGrowthSP900Model)
MCModelAll_Light_cell<-MCModelAll_Light %>% 
  unique()
```

# Exstracting models for each fit (for each photoperiod and all photoperiod together)

```{r}
MCGrowthSPAllModel<-GRCplatt_PredictGrowthJVPSIIAll %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSPAllModel$Fit <- 'All'

MCGrowthSP8Model<-GRCplatt_PredictGrowthJVPSII8 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP8Model$Fit <- '8'

MCGrowthSP12Model<-GRCplatt_PredictGrowthJVPSII12 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP12Model$Fit <- '12'
  
MCGrowthSP16Model<-GRCplatt_PredictGrowthJVPSII16 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP16Model$Fit <- '16'
  
MCGrowthSP24Model<-GRCplatt_PredictGrowthJVPSII24 %>% 
  dplyr::select(c(Strain, GRCplatt_Model))
  MCGrowthSP24Model$Fit <- '24'
  

MCModelAll_Photoperiod<-rbind(MCGrowthSPAllModel, MCGrowthSP30Model, MCGrowthSP90Model, MCGrowthSP180Model, MCGrowthSP300Model, MCGrowthSP900Model)
MCModelAll_Photoperiod_cell<-MCModelAll_Photoperiod %>% 
  unique()
```


# Anova from the model - compare fit from all light to selected one light

```{r}
#1->All
#2->30
#3->90
#4->180
#5->300
#6->900
MCModelAll_BA56<-MCModelAll_Light_cell %>% 
  filter(Strain == "PC-rich_056") 
  anova056_30<-anova(MCModelAll_BA56[[2]][[2]], MCModelAll_BA56[[2]][[1]])
  anova056_30$FitComparison <- '30_All'
  anova056_90<-anova(MCModelAll_BA56[[2]][[3]], MCModelAll_BA56[[2]][[1]])
  anova056_90$FitComparison <- '90_All'
  anova056_180<-anova(MCModelAll_BA56[[2]][[4]], MCModelAll_BA56[[2]][[1]])
  anova056_180$FitComparison <- '180_All'
  anova056_300<-anova(MCModelAll_BA56[[2]][[5]], MCModelAll_BA56[[2]][[1]])
  anova056_300$FitComparison <- '300_All'
  anova056_900<-anova(MCModelAll_BA56[[2]][[6]], MCModelAll_BA56[[2]][[1]])
  anova056_900$FitComparison <- '900_All'
  anova056<-rbind(anova056_30, anova056_90, anova056_180, anova056_300, anova056_900)
  rm(anova056_30, anova056_90, anova056_180, anova056_300, anova056_900)
  anova056$Strain <- 'PC-rich_056'
# 180, 900 no different

MCModelAll_BA77<-MCModelAll_Light_cell %>% 
  filter(Strain == "PC-rich_077") 
  anova077_30<-anova(MCModelAll_BA77[[2]][[2]], MCModelAll_BA77[[2]][[1]])
  anova077_30$FitComparison <- '30_All'
  anova077_90<-anova(MCModelAll_BA77[[2]][[3]], MCModelAll_BA77[[2]][[1]])
  anova077_90$FitComparison <- '90_All'
  anova077_180<-anova(MCModelAll_BA77[[2]][[4]], MCModelAll_BA77[[2]][[1]])
  anova077_180$FitComparison <- '180_All'
  anova077_300<-anova(MCModelAll_BA77[[2]][[5]], MCModelAll_BA77[[2]][[1]])
  anova077_300$FitComparison <- '300_All'
  anova077_900<-anova(MCModelAll_BA77[[2]][[6]], MCModelAll_BA77[[2]][[1]])
  anova077_900$FitComparison <- '900_All'
  anova077<-rbind(anova077_30, anova077_90, anova077_180, anova077_300, anova077_900)
  rm(anova077_30, anova077_90, anova077_180, anova077_300, anova077_900)
  anova077$Strain <- 'PC-rich_077'
# no different at all

MCModelAll_BA48<-MCModelAll_Light_cell %>% 
  filter(Strain == "PE-rich_048") 
  anova048_30<-anova(MCModelAll_BA48[[2]][[2]], MCModelAll_BA48[[2]][[1]])
  anova048_30$FitComparison <- '30_All'
  anova048_90<-anova(MCModelAll_BA48[[2]][[3]], MCModelAll_BA48[[2]][[1]])
  anova048_90$FitComparison <- '90_All'
  anova048_180<-anova(MCModelAll_BA48[[2]][[4]], MCModelAll_BA48[[2]][[1]])
  anova048_180$FitComparison <- '180_All'
  anova048_300<-anova(MCModelAll_BA48[[2]][[5]], MCModelAll_BA48[[2]][[1]])
  anova048_300$FitComparison <- '300_All'
  anova048_900<-anova(MCModelAll_BA48[[2]][[6]], MCModelAll_BA48[[2]][[1]])
  anova048_900$FitComparison <- '900_All'
  anova048<-rbind(anova048_30, anova048_90, anova048_180, anova048_300, anova048_900)
  rm(anova048_30, anova048_90, anova048_180, anova048_300, anova048_900)
  anova048$Strain <- 'PE-rich_048'
# no different at all

MCModelAll_BA127<-MCModelAll_Light_cell %>% 
  filter(Strain == "PE-rich_127") 
  anova127_30<-anova(MCModelAll_BA127[[2]][[2]], MCModelAll_BA127[[2]][[1]])
  anova127_30$FitComparison <- '30_All'
  anova127_90<-anova(MCModelAll_BA127[[2]][[3]], MCModelAll_BA127[[2]][[1]])
  anova127_90$FitComparison <- '90_All'
  anova127_180<-anova(MCModelAll_BA127[[2]][[4]], MCModelAll_BA127[[2]][[1]])
  anova127_180$FitComparison <- '180_All'
  anova127_300<-anova(MCModelAll_BA127[[2]][[5]], MCModelAll_BA127[[2]][[1]])
  anova127_300$FitComparison <- '300_All'
  anova127_900<-anova(MCModelAll_BA127[[2]][[6]], MCModelAll_BA127[[2]][[1]])
  anova127_900$FitComparison <- '900_All'
  anova127<-rbind(anova127_30, anova127_90, anova127_180, anova127_300, anova127_900)
  rm(anova127_30, anova127_90, anova127_180, anova127_300, anova127_900)
  anova127$Strain <- 'PE-rich_127'
# 300 no different
  
AnovaTest_GrowthRateModel_Light_cell<-rbind(anova056, anova077, anova048, anova127)

AnovaTest_GrowthRateModel_Light_cell <-AnovaTest_GrowthRateModel_Light_cell %>% 
  drop_na(Df) 
rm(anova056, anova077, anova048, anova127, MCModelAll_BA56, MCModelAll_BA77, MCModelAll_BA48, MCModelAll_BA127)
```

# Separate fits per strain - for plots only - based on statistics - Light

```{r}
GRCplatt_PredictGrowth30_BA56<-GRCplatt_PredictGrowthJVPSII30 %>% 
    filter(Strain == "PC-rich_056")
GRCplatt_PredictGrowth90_BA56<-GRCplatt_PredictGrowthJVPSII90 %>% 
    filter(Strain == "PC-rich_056")
GRCplatt_PredictGrowth300_BA56<-GRCplatt_PredictGrowthJVPSII300 %>% 
    filter(Strain == "PC-rich_056")

# GRCplatt_PredictGrowth30_BA77<-GRCplatt_PredictGrowthJVPSII30 %>% 
#     filter(Strain == "PC-rich_077")

# GRCplatt_PredictGrowth900_BA48<-GRCplatt_PredictGrowthJVPSII900 %>%
#     filter(Strain == "PE-rich_048")

GRCplatt_PredictGrowth30_BA127<-GRCplatt_PredictGrowthJVPSII30 %>% 
    filter(Strain == "PE-rich_127")
GRCplatt_PredictGrowth90_BA127<-GRCplatt_PredictGrowthJVPSII90 %>% 
    filter(Strain == "PE-rich_127")
GRCplatt_PredictGrowth180_BA127<-GRCplatt_PredictGrowthJVPSII180 %>% 
    filter(Strain == "PE-rich_127")
GRCplatt_PredictGrowth900_BA127<-GRCplatt_PredictGrowthJVPSII900 %>% 
    filter(Strain == "PE-rich_127")
```

# Anova from the model - compare fit from all photoperiod to selected one photoperiod

```{r}
#1->All
#2->8
#3->12
#4->16
#5->24

MCModelAll_BA56<-MCModelAll_Photoperiod_cell%>% 
  filter(Strain == "PC-rich_056") 
  anova056_8<-anova(MCModelAll_BA56[[2]][[2]], MCModelAll_BA56[[2]][[1]])
  anova056_8$FitComparison <- '8_All'
  anova056_12<-anova(MCModelAll_BA56[[2]][[3]], MCModelAll_BA56[[2]][[1]])
  anova056_12$FitComparison <- '12_All'
  anova056_16<-anova(MCModelAll_BA56[[2]][[4]], MCModelAll_BA56[[2]][[1]])
  anova056_16$FitComparison <- '16_All'
  anova056_24<-anova(MCModelAll_BA56[[2]][[5]], MCModelAll_BA56[[2]][[1]])
  anova056_24$FitComparison <- '24_All'
  anova056_Photoperiod<-rbind(anova056_8, anova056_12, anova056_16, anova056_24)
  rm(anova056_8, anova056_12, anova056_16, anova056_24)
  anova056_Photoperiod$Strain <- 'PC-rich_056'
# 16 - no different

MCModelAll_BA77<-MCModelAll_Photoperiod_cell %>% 
  filter(Strain == "PC-rich_077") 
  anova077_8<-anova(MCModelAll_BA77[[2]][[2]], MCModelAll_BA77[[2]][[1]])
  anova077_8$FitComparison <- '8_All'
  anova077_12<-anova(MCModelAll_BA77[[2]][[3]], MCModelAll_BA77[[2]][[1]])
  anova077_12$FitComparison <- '12_All'
  anova077_16<-anova(MCModelAll_BA77[[2]][[4]], MCModelAll_BA77[[2]][[1]])
  anova077_16$FitComparison <- '16_All'
  anova077_24<-anova(MCModelAll_BA77[[2]][[5]], MCModelAll_BA77[[2]][[1]])
  anova077_24$FitComparison <- '24_All'
  anova077_Photoperiod<-rbind(anova077_8, anova077_12, anova077_16, anova077_24)
  rm(anova077_8, anova077_12, anova077_16, anova077_24)
  anova077_Photoperiod$Strain <- 'PC-rich_077'
# 12 different

MCModelAll_BA48<-MCModelAll_Photoperiod_cell %>% 
  filter(Strain == "PE-rich_048") 
  anova048_8<-anova(MCModelAll_BA48[[2]][[2]], MCModelAll_BA48[[2]][[1]])
  anova048_8$FitComparison <- '8_All'
  anova048_12<-anova(MCModelAll_BA48[[2]][[3]], MCModelAll_BA48[[2]][[1]])
  anova048_12$FitComparison <- '12_All'
  anova048_16<-anova(MCModelAll_BA48[[2]][[4]], MCModelAll_BA48[[2]][[1]])
  anova048_16$FitComparison <- '16_All'
  anova048_24<-anova(MCModelAll_BA48[[2]][[5]], MCModelAll_BA48[[2]][[1]])
  anova048_24$FitComparison <- '24_All'
  anova048_Photoperiod<-rbind(anova048_8, anova048_12, anova048_16, anova048_24)
  rm(anova048_8, anova048_12, anova048_16, anova048_24)
  anova048_Photoperiod$Strain <- 'PE-rich_048'
# no different 

MCModelAll_BA127<-MCModelAll_Photoperiod_cell %>% 
  filter(Strain == "PE-rich_127") 
  anova127_8<-anova(MCModelAll_BA127[[2]][[2]], MCModelAll_BA127[[2]][[1]])
  anova127_8$FitComparison <- '8_All'
  anova127_12<-anova(MCModelAll_BA127[[2]][[3]], MCModelAll_BA127[[2]][[1]])
  anova127_12$FitComparison <- '12_All'
  anova127_16<-anova(MCModelAll_BA127[[2]][[4]], MCModelAll_BA127[[2]][[1]])
  anova127_16$FitComparison <- '16_All'
  anova127_24<-anova(MCModelAll_BA127[[2]][[5]], MCModelAll_BA127[[2]][[1]])
  anova127_24$FitComparison <- '24_All'
  anova127_Photoperiod<-rbind(anova127_8, anova127_12, anova127_16, anova127_24)
  rm(anova127_8, anova127_12, anova127_16, anova127_24)
  anova127_Photoperiod$Strain <- 'PE-rich_127'
# 24 no different
  
AnovaTest_GrowthRateModel_Photoperiod_cell<-rbind(anova056_Photoperiod, anova077_Photoperiod, anova048_Photoperiod, anova127_Photoperiod)

AnovaTest_GrowthRateModel_Photoperiod_cell <-AnovaTest_GrowthRateModel_Photoperiod_cell %>% 
  drop_na(Df) 

rm(anova056_Photoperiod, anova077_Photoperiod, anova048_Photoperiod, anova127_Photoperiod, MCModelAll_BA56, MCModelAll_BA77, MCModelAll_BA48, MCModelAll_BA127)
```


# Separate fits per strain - for plots only - based on statistics - Photoperiod

```{r}
GRCplatt_PredictGrowth8_BA56<-GRCplatt_PredictGrowthJVPSII8 %>% 
    filter(Strain == "PC-rich_056")
GRCplatt_PredictGrowth12_BA56<-GRCplatt_PredictGrowthJVPSII12 %>% 
    filter(Strain == "PC-rich_056")
GRCplatt_PredictGrowth24_BA56<-GRCplatt_PredictGrowthJVPSII24 %>% 
    filter(Strain == "PC-rich_056")

GRCplatt_PredictGrowth12_BA77<-GRCplatt_PredictGrowthJVPSII12 %>%
    filter(Strain == "PC-rich_077")

# GRCplatt_PredictGrowth900_BA48<-GRCplatt_PredictGrowthJVPSII900 %>% 
#     filter(Strain == "PE-rich_048")

GRCplatt_PredictGrowth8_BA127<-GRCplatt_PredictGrowthJVPSII8 %>% 
    filter(Strain == "PE-rich_127")
GRCplatt_PredictGrowth12_BA127<-GRCplatt_PredictGrowthJVPSII12 %>% 
    filter(Strain == "PE-rich_127")
GRCplatt_PredictGrowth16_BA127<-GRCplatt_PredictGrowthJVPSII16 %>% 
    filter(Strain == "PE-rich_127")
```




# Create plot and change the unit of JVPSII - umol

```{r fig.height = 8, fig.width = 8, warning = FALSE, warning = FALSE}
lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))
lab4=c(expression(""), expression(""), expression(""), expression(""))
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }

MCGrowthJVPSIISP %>% 
ggplot() +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_cell_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "blue", size = 0.3, linetype = "solid", show.legend = F, GRCplatt_PredictGrowthJVPSIIAll) +
  
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "darkslategray", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowth30_BA56) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "lightblue4", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowth90_BA56) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "indianred3", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowth300_BA56) +
  
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "darkslategray", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowth30_BA127) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "lightblue4", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowth90_BA127) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "hotpink4", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowth180_BA127) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "goldenrod2", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowth900_BA127) +
  
  scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600","900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  labs(y = "Chlorophyll-specific exponential growth rate " ~ "("~d^-1~")", x = ""~italic(JV)~""["PSII"]*" (µmol"~e^-~""~cell^-1~""~d^-1~")") +
  
  ggh4x::facet_nested(rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="white"),
        legend.position = c(0.90,0.88),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        legend.spacing.x = unit(-0.1, 'cm'),
        legend.title = element_blank(),
        legend.text = element_text(size=11))
```

# Save plot 

```{r save plot}
# ggsave(file = file.path(FigPath, paste("SFig_GrowthRate_JVPSII_Light_cell",".png",sep = "")), height=9, width= 7,  dpi = 300, limitsize = TRUE)
```


```{r fig.height = 8, fig.width = 8, warning = FALSE, warning = FALSE}
MCGrowthJVPSIISP %>% 
ggplot() +
  # geom_point(aes(meanJVPSII_umol_eLs_Par_ue_cell_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T, MCGrowthJVPSIISPmean) +
  geom_point(aes(JVPSII_umol_eLs_Par_ue_cell_day, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.8, size = 3.5, show.legend = T) +
  
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "blue", size = 0.3, linetype = "solid", show.legend = F, GRCplatt_PredictGrowthJVPSIIAll) +
  
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "black", linetype = "dotted", show.legend = F, GRCplatt_PredictGrowth8_BA56) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "black", linetype = "longdash", show.legend = F, GRCplatt_PredictGrowth12_BA56) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "black", linetype = "dotdash", show.legend = F,  GRCplatt_PredictGrowth24_BA56) +
  
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "black", linetype = "longdash", show.legend = F, GRCplatt_PredictGrowth12_BA77) +
  
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "black", linetype = "dotted", show.legend = F, GRCplatt_PredictGrowth8_BA127) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "black", linetype = "longdash", show.legend = F, GRCplatt_PredictGrowth12_BA127) +
  geom_line(aes(JVPSII_umol_eLs_Par_ue_cell_day, .fitted), colour = "black", linetype = "dashed", show.legend = F, GRCplatt_PredictGrowth16_BA127) +

  scale_x_continuous(label=scientific_10) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "goldenrod2", "khaki2"), name="", labels = lab2, breaks=c('30', "90", "180", "300", "600","900")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +

  labs(y = "Chlorophyll-specific exponential growth rate " ~ "("~d^-1~")", x = ""~italic(JV)~""["PSII"]*" (µmol"~e^-~""~cell^-1~""~d^-1~")") +
  ggh4x::facet_nested(rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="white"),
        legend.position = c(0.90,0.88),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        legend.spacing.x = unit(-0.1, 'cm'),
        legend.title = element_blank(),
        legend.text = element_text(size=11))
```


# Save plot 

```{r save plot}
# ggsave(file = file.path(FigPath, paste("SFig_GrowthRate_JVPSII_Photoperiod_cell",".png",sep = "")), height=9, width= 7,  dpi = 300, limitsize = TRUE)
```





# Save Rds for further analysis

```{r save rds}
saveRDS(MCGrowthJVPSIISP, file.path(DataOut, paste(Project, "Processed_GrowthJVPSII.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)
```

```{r}
colnames(MCGrowthJVPSIISP)
```




6.02 x 10^23 electrons per mole

6.02*10e23 = 6.02e+24
6.02e+24/1000000 = 6.02e+18 ->umol e



# Save assembled spectra data set
```{r save Olis}

saveRDS(SolFitsAllPigmentTurnerDay, file.path(DataOut, paste(Project, "Processed_GrowthRateSolisense.Rds", sep = "_"), fsep = .Platform$file.sep))

```

# Variable names used in Data Dictionary

```{r}
# colnames(SolFitsAllPigmentTurnerDay)
```




Set up R codes for Greek letters

\u0391  Α   Greek Capital Letter Alpha
\u0392  Β   Greek Capital Letter Beta
\u0393  Γ   Greek Capital Letter Gamma
\u0394  Δ   Greek Capital Letter Delta
\u0395  Ε   Greek Capital Letter Epsilon
\u0396  Ζ   Greek Capital Letter Zeta
\u0397  Η   Greek Capital Letter Eta
\u0398  Θ   Greek Capital Letter Theta
\u0399  Ι   Greek Capital Letter Iota
\u039A  Κ   Greek Capital Letter Kappa
\u039B  Λ   Greek Capital Letter Lambda
\u039C  Μ   Greek Capital Letter Mu
\u039D  Ν   Greek Capital Letter Nu
\u039E  Ξ   Greek Capital Letter Xi
\u039F  Ο   Greek Capital Letter Omicron
\u03A0  Π   Greek Capital Letter Pi
\u03A1  Ρ   Greek Capital Letter Rho
\u03A3  Σ   Greek Capital Letter Sigma
\u03A4  Τ   Greek Capital Letter Tau
\u03A5  Υ   Greek Capital Letter Upsilon
\u03A6  Φ   Greek Capital Letter Phi
\u03A7  Χ   Greek Capital Letter Chi
\u03A8  Ψ   Greek Capital Letter Psi
\u03A9  Ω   Greek Capital Letter Omega
\u03B1  α   Greek Small Letter alpha
\u03B2  β   Greek Small Letter beta
\u03B3  γ   Greek Small Letter gamma
\u03B4  δ   Greek Small Letter delta
\u03B5  ε   Greek Small Letter epsilon
\u03B6  ζ   Greek Small Letter zeta
\u03B7  η   Greek Small Letter eta
\u03B8  θ   Greek Small Letter theta
\u03B9  ι   Greek Small Letter iota
\u03BA  κ   Greek Small Letter kappa
\u03BB  λ   Greek Small Letter lambda
\u03BC  μ   Greek Small Letter mu
\u03BD  ν   Greek Small Letter nu
\u03BE  ξ   Greek Small Letter xi
\u03BF  ο   Greek Small Letter omicron
\u03C0  π   Greek Small Letter pi
\u03C1  ρ   Greek Small Letter rho
\u03C2  ς   Greek Small Letter final sigma
\u03C3  σ   Greek Small Letter sigma
\u03C4  τ   Greek Small Letter tau
\u03C5  υ   Greek Small Letter upsilon
\u03C6  φ   Greek Small Letter phi
\u03C7  χ   Greek Small Letter chi
\u03C8  ψ   Greek Small Letter psi
\u03C9  ω   Greek Small Letter omega

```{r}

p <- ggplot(mpg, aes(displ, cty)) + geom_point() + facet_grid(drv ~ cyl)
p
g <- ggplot_gtable(ggplot_build(p))
stripr <- which(grepl('strip-r', g$layout$name))
fills <- c("red","green","blue","yellow")
k <- 1
for (i in stripr) {
j <- which(grepl('rect', g$grobs[[i]]$grobs[[1]]$childrenOrder))
g$grobs[[i]]$grobs[[1]]$children[[j]]$gp$fill <- fills[k]
k <- k+1
}
grid.draw(g)



# library(grid)
# p <- ggplot(mpg, aes(displ, cty)) + geom_point() + facet_grid(drv ~ cyl)
# p
# g <- ggplot_gtable(ggplot_build(p))
# strip_both <- which(grepl('strip-', g$layout$name))
# fills <- c("red","green","blue","yellow","red","green","blue","yellow")
# k <- 1
# for (i in strip_both) {
# j <- which(grepl('rect', g$grobs[[i]]$grobs[[1]]$childrenOrder))
# g$grobs[[i]]$grobs[[1]]$children[[j]]$gp$fill <- fills[k]
# k <- k+1
# }
# grid.draw(g)
```




